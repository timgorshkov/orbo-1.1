
# üîß –°–∏—Å—Ç–µ–º–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å –∫–æ–º–∞–Ω–¥–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏

## üéØ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª—è–µ–º

### ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è 062: Telegram creator ‚â† owner –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, —è–≤–ª—è—é—â–∏–µ—Å—è creator –≤ Telegram –≥—Ä—É–ø–ø–∞—Ö, –æ—à–∏–±–æ—á–Ω–æ —Å—Ç–∞–Ω–æ–≤–∏–ª–∏—Å—å owner –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- –§—É–Ω–∫—Ü–∏—è `sync_telegram_admins` –±–æ–ª—å—à–µ –ù–ï –ø–æ–≤—ã—à–∞–µ—Ç –¥–æ owner
- Telegram creator ‚Üí –≤—Å–µ–≥–¥–∞ `admin` –≤ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
- Metadata —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç `is_owner_in_groups: true` –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è "üëë –≤–ª–∞–¥–µ–ª–µ—Ü –≤ –≥—Ä—É–ø–ø–∞—Ö"

**–ó–∞—â–∏—Ç–∞:**
- –ù–∞—Å—Ç–æ—è—â–∏–π owner (role_source ‚â† 'telegram_admin') –Ω–µ –±—É–¥–µ—Ç –ø–æ–Ω–∏–∂–µ–Ω
- Owner –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ = —Ç–æ–ª—å–∫–æ —Ç–æ—Ç, –∫—Ç–æ —Å–æ–∑–¥–∞–ª –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é

---

### ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è 063: –û—á–∏—Å—Ç–∫–∞ –ª–æ–∂–Ω—ã—Ö owner'–æ–≤
**–ü—Ä–æ–±–ª–µ–º–∞:** –í –ë–î –µ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å `role='owner'` –∏ `role_source='telegram_admin'` (–ø–æ–ª—É—á–µ–Ω—ã —á–µ—Ä–µ–∑ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é).

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- –ü–æ–Ω–∏–∂–∞–µ—Ç –≤—Å–µ—Ö —Ç–∞–∫–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–æ `admin`
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ —É –∫–∞–∂–¥–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Ä–æ–≤–Ω–æ 1 owner
- –í—ã–≤–æ–¥–∏—Ç –æ—Ç—á—ë—Ç –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏

---

### ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è 064: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ has_verified_telegram
**–ü—Ä–æ–±–ª–µ–º–∞:** `has_verified_telegram` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç `false`, –¥–∞–∂–µ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω –≤ –¥—Ä—É–≥–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- VIEW `organization_admins` —Ç–µ–ø–µ—Ä—å –∏—â–µ—Ç –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é –≥–ª–æ–±–∞–ª—å–Ω–æ
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: —Ç–µ–∫—É—â–∞—è org ‚Üí –ª—é–±–∞—è –¥—Ä—É–≥–∞—è org ‚Üí false
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç LATERAL JOIN –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–∏

---

## üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é

### –®–∞–≥ 1: –ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é 062 ‚úÖ
```bash
# –í Supabase SQL Editor:
db/migrations/062_fix_telegram_creator_not_org_owner.sql
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
NOTICE: Migration 062 completed successfully!
NOTICE: Telegram group creators will NO LONGER become organization owners.
```

---

### –®–∞–≥ 2: –ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é 063 ‚úÖ
```bash
# –í Supabase SQL Editor:
db/migrations/063_cleanup_false_owners.sql
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –¢–∞–±–ª–∏—Ü–∞ —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º owner'–æ–≤ –Ω–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é
- –í—Å–µ —Å—Ç—Ä–æ–∫–∏ –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å status: "‚úÖ OK"

**–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ "‚ö†Ô∏è MULTIPLE OWNERS!":**
–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ - –º–∏–≥—Ä–∞—Ü–∏—è –∏—Å–ø—Ä–∞–≤–∏—Ç —ç—Ç–æ!

---

### –®–∞–≥ 3: –ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é 064 ‚úÖ
```bash
# –í Supabase SQL Editor:
db/migrations/064_fix_has_verified_telegram_in_view.sql
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
NOTICE: Migration 064 completed successfully!
NOTICE: has_verified_telegram will now show correct status...
```

---

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ–±–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ üìä

**Org 1:** `a3e8bc8f-8171-472c-a955-2f7878aed6f1`
```sql
SELECT role, full_name, email, has_verified_telegram
FROM organization_admins
WHERE org_id = 'a3e8bc8f-8171-472c-a955-2f7878aed6f1'
ORDER BY CASE role WHEN 'owner' THEN 1 ELSE 2 END;
```

**–û–∂–∏–¥–∞–µ—Ç—Å—è:**
- 1 owner (–¢–∏–º–æ—Ñ–µ–π –ì–æ—Ä—à–∫–æ–≤)
- 0-1 admin (–¢–∏–º—É—Ä –ì–æ–ª–∏—Ü—ã–Ω, –µ—Å–ª–∏ –æ–Ω –∞–¥–º–∏–Ω)
- has_verified_telegram = true –¥–ª—è –æ–±–æ–∏—Ö

**Org 2:** `7363155c-5070-4560-aa3d-89b1bef7df7b`
```sql
SELECT role, full_name, email, has_verified_telegram
FROM organization_admins
WHERE org_id = '7363155c-5070-4560-aa3d-89b1bef7df7b'
ORDER BY CASE role WHEN 'owner' THEN 1 ELSE 2 END;
```

**–û–∂–∏–¥–∞–µ—Ç—Å—è:**
- 1 owner (–¢–∏–º—É—Ä –ì–æ–ª–∏—Ü—ã–Ω)
- 1 admin (–¢–∏–º–æ—Ñ–µ–π –ì–æ—Ä—à–∫–æ–≤)
- has_verified_telegram = true –¥–ª—è –æ–±–æ–∏—Ö

---

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ UI üñ•Ô∏è

**Org 1:** `/app/a3e8bc8f-8171-472c-a955-2f7878aed6f1/settings`
- **–í–ª–∞–¥–µ–ª–µ—Ü:** –¢–∏–º–æ—Ñ–µ–π –ì–æ—Ä—à–∫–æ–≤ ‚úÖ
- **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã:** (–µ—Å–ª–∏ –µ—Å—Ç—å) ‚úÖ
- **–ë–ï–ó –¥—É–±–ª–µ–π** ‚úÖ

**Org 2:** `/app/7363155c-5070-4560-aa3d-89b1bef7df7b/settings`
- **–í–ª–∞–¥–µ–ª–µ—Ü:** –¢–∏–º—É—Ä –ì–æ–ª–∏—Ü—ã–Ω ‚úÖ
- **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã (1):** –¢–∏–º–æ—Ñ–µ–π –ì–æ—Ä—à–∫–æ–≤ ‚úÖ (–¥–æ–ª–∂–µ–Ω –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è!)
- **Telegram —Å—Ç–∞—Ç—É—Å—ã:** ‚úÖ –í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω (–æ–±–∞)

---

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ owner'–æ–≤ (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 1 –Ω–∞ org)
```sql
SELECT org_id, COUNT(*) as owners_count
FROM memberships
WHERE role = 'owner'
GROUP BY org_id
HAVING COUNT(*) > 1;
```
**–û–∂–∏–¥–∞–µ—Ç—Å—è:** –ü—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–Ω–µ—Ç –¥—É–±–ª–µ–π)

---

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: –ù–µ—Ç –ª–æ–∂–Ω—ã—Ö owner'–æ–≤ –æ—Ç Telegram
```sql
SELECT 
  m.org_id,
  m.user_id,
  m.role,
  m.role_source,
  u.email
FROM memberships m
LEFT JOIN auth.users u ON u.id = m.user_id
WHERE m.role = 'owner' AND m.role_source = 'telegram_admin';
```
**–û–∂–∏–¥–∞–µ—Ç—Å—è:** –ü—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–≤—Å–µ owner'—ã —Å–æ–∑–¥–∞–Ω—ã –≤—Ä—É—á–Ω—É—é)

---

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 3: has_verified_telegram –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω
```sql
SELECT 
  oa.full_name,
  oa.has_verified_telegram as view_value,
  EXISTS(
    SELECT 1 FROM user_telegram_accounts uta 
    WHERE uta.user_id = oa.user_id AND uta.is_verified = true
  ) as should_be
FROM organization_admins oa
WHERE oa.has_verified_telegram != EXISTS(
  SELECT 1 FROM user_telegram_accounts uta 
  WHERE uta.user_id = oa.user_id AND uta.is_verified = true
);
```
**–û–∂–∏–¥–∞–µ—Ç—Å—è:** –ü—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–≤—Å–µ —Å—Ç–∞—Ç—É—Å—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã)

---

## ‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞: "No function matches the given name find_user_id_by_telegram"
**–ü—Ä–∏—á–∏–Ω–∞:** –ú–∏–≥—Ä–∞—Ü–∏—è 061 –Ω–µ –±—ã–ª–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞.

**–†–µ—à–µ–Ω–∏–µ:**
```sql
-- –°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é 061:
db/migrations/061_fix_sync_telegram_admins_global_search.sql
```

---

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏ 063 org –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "NO OWNER"
**–ü—Ä–∏—á–∏–Ω–∞:** –í org –Ω–µ –±—ã–ª–æ –Ω–∏ –æ–¥–Ω–æ–≥–æ owner'–∞ (–≤—Å–µ –±—ã–ª–∏ —Å role_source='telegram_admin').

**–†–µ—à–µ–Ω–∏–µ:**
```sql
-- –í—Ä—É—á–Ω—É—é –Ω–∞–∑–Ω–∞—á—å—Ç–µ owner'–∞ –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏:
UPDATE memberships
SET role = 'owner', role_source = 'manual'
WHERE org_id = 'YOUR_ORG_ID'
  AND user_id = 'CORRECT_OWNER_USER_ID';
```

---

### –ü—Ä–æ–±–ª–µ–º–∞: has_verified_telegram –≤—Å—ë –µ—â—ë false
**–ü—Ä–∏—á–∏–Ω–∞:** –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç –∑–∞–ø–∏—Å–∏ –≤ user_telegram_accounts –Ω–∏ –¥–ª—è –æ–¥–Ω–æ–π org.

**–†–µ—à–µ–Ω–∏–µ:**
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ Telegram —Ö–æ—Ç—è –±—ã –≤ –æ–¥–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏:
1. –û—Ç–∫—Ä—ã—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª/—Å–æ–±—ã—Ç–∏–µ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º –¥–æ—Å—Ç—É–ø–æ–º
2. –í–≤–µ—Å—Ç–∏ –∫–æ–¥ –æ—Ç –±–æ—Ç–∞
3. –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –∑–∞–ø–∏—Å—å –ø–æ—è–≤–∏—Ç—Å—è –∏ —Å—Ç–∞—Ç—É—Å —Å—Ç–∞–Ω–µ—Ç true.

---

## ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫

- [ ] –ú–∏–≥—Ä–∞—Ü–∏—è 062 –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ
- [ ] –ú–∏–≥—Ä–∞—Ü–∏—è 063 –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ
- [ ] –ú–∏–≥—Ä–∞—Ü–∏—è 064 –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ 1 (–¥—É–±–ª–∏ owner'–æ–≤) = –ø—É—Å—Ç–æ
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ 2 (–ª–æ–∂–Ω—ã–µ owner'—ã) = –ø—É—Å—Ç–æ
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ 3 (has_verified_telegram) = –ø—É—Å—Ç–æ
- [ ] UI org1: owner –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω, –Ω–µ—Ç –¥—É–±–ª–µ–π
- [ ] UI org2: owner + admin –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã, —Å—Ç–∞—Ç—É—Å—ã –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: –¥–æ–±–∞–≤–∏—Ç—å –±–æ—Ç–∞ –≤ –Ω–æ–≤—É—é –≥—Ä—É–ø–ø—É ‚Üí —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å ‚Üí creator —Å—Ç–∞–ª admin (–ù–ï owner)

---

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –º–∏–≥—Ä–∞—Ü–∏–π:

‚úÖ **Telegram creator'—ã –±–æ–ª—å—à–µ –ù–ï —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è owner'–∞–º–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏**  
‚úÖ **–ö–∞–∂–¥–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –∏–º–µ–µ—Ç —Ä–æ–≤–Ω–æ 1 owner'–∞**  
‚úÖ **has_verified_telegram –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**  
‚úÖ **–î—É–±–ª–∏ –≤ –∫–æ–º–∞–Ω–¥–µ –∏—Å—á–µ–∑–ª–∏**  
‚úÖ **UI –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É –ø—Ä–∞–≤–∏–ª—å–Ω–æ**

---

**–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã, –ø—Ä–∏—à–ª–∏—Ç–µ:**
1. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ü—Ä–æ–≤–µ—Ä–æ–∫ 1-3
2. –°–∫—Ä–∏–Ω—à–æ—Ç UI —Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–∞—Å—Ç—Ä–æ–µ–∫
3. –†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è org_id –∏–∑ –®–∞–≥–∞ 4

–Ø –ø–æ–º–æ–≥—É —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è! üöÄ


