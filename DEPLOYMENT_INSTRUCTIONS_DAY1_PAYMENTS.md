# Deployment Instructions: Day 1 - Event Payments

## ğŸ“‹ Ğ§Ñ‚Ğ¾ ÑĞ´ĞµĞ»Ğ°Ğ½Ğ¾

### 1. Database Schema (Migration 114)
- âœ… Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ñ‹ Ğ¿Ğ¾Ğ»Ñ Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ñ‹ Ğº Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğµ `events`:
  - `requires_payment` (boolean)
  - `default_price` (decimal)
  - `currency` (varchar)
  - `payment_deadline_days` (integer)
  - `payment_instructions` (text)

- âœ… Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ñ‹ Ğ¿Ğ¾Ğ»Ñ Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ñ‹ Ğº Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğµ `event_registrations`:
  - `price` (decimal) - Ğ¸Ğ½Ğ´Ğ¸Ğ²Ğ¸Ğ´ÑƒĞ°Ğ»ÑŒĞ½Ğ°Ñ Ñ†ĞµĞ½Ğ° Ğ´Ğ»Ñ ÑƒÑ‡Ğ°ÑÑ‚Ğ½Ğ¸ĞºĞ°
  - `payment_status` (enum: pending, paid, partially_paid, overdue, cancelled, refunded)
  - `payment_method` (varchar)
  - `paid_at` (timestamptz)
  - `paid_amount` (decimal)
  - `payment_notes` (text)
  - `payment_updated_by` (uuid)
  - `payment_updated_at` (timestamptz)

- âœ… Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½ Ñ‚Ñ€Ğ¸Ğ³Ğ³ĞµÑ€ Ğ´Ğ»Ñ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ¹ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸ Ñ†ĞµĞ½Ñ‹ Ğ¿Ñ€Ğ¸ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸
- âœ… Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ° Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ `get_event_payment_stats()` Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¸ Ğ¿Ğ¾ Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ğ°Ğ¼
- âœ… Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ° Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ `mark_overdue_payments()` Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¼ĞµÑ‚ĞºĞ¸ Ğ¿Ñ€Ğ¾ÑÑ€Ğ¾Ñ‡ĞµĞ½Ğ½Ñ‹Ñ… Ğ¾Ğ¿Ğ»Ğ°Ñ‚
- âœ… Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ñ‹ Ğ¸Ğ½Ğ´ĞµĞºÑÑ‹ Ğ´Ğ»Ñ Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²

### 2. API Updates
- âœ… ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ `POST /api/events` - Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° Ğ½Ğ¾Ğ²Ñ‹Ñ… payment Ğ¿Ğ¾Ğ»ĞµĞ¹
- âœ… ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ `PUT /api/events/[id]` - Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° Ğ½Ğ¾Ğ²Ñ‹Ñ… payment Ğ¿Ğ¾Ğ»ĞµĞ¹
- âœ… Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ° Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ½Ğ°Ñ ÑĞ¾Ğ²Ğ¼ĞµÑÑ‚Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ ÑĞ¾ ÑÑ‚Ğ°Ñ€Ñ‹Ğ¼Ğ¸ Ğ¿Ğ¾Ğ»ÑĞ¼Ğ¸ `is_paid` Ğ¸ `price_info`

### 3. UI Updates
- âœ… ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ° Ñ„Ğ¾Ñ€Ğ¼Ğ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ/Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ (`event-form.tsx`)
- âœ… ĞĞ¾Ğ²Ğ°Ñ ÑĞµĞºÑ†Ğ¸Ñ "Ğ¡Ñ‚Ğ¾Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ Ğ¸ Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ğ°" Ñ Ğ¿Ğ¾Ğ»ÑĞ¼Ğ¸:
  - Ğ§ĞµĞºĞ±Ğ¾ĞºÑ "ĞŸĞ»Ğ°Ñ‚Ğ½Ğ¾Ğµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ"
  - Ğ¦ĞµĞ½Ğ° Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ
  - Ğ’Ğ°Ğ»ÑÑ‚Ğ° (RUB, USD, EUR, KZT, BYN)
  - ĞšÑ€Ğ°Ğ¹Ğ½Ğ¸Ğ¹ ÑÑ€Ğ¾Ğº Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ñ‹ (Ğ´Ğ½ĞµĞ¹ Ğ´Ğ¾ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ)
  - Ğ˜Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ğ¸ Ğ¿Ğ¾ Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ğµ

## ğŸš€ Deployment Steps

### Step 1: Apply Database Migration

1. ĞÑ‚ĞºÑ€Ğ¾Ğ¹ Supabase SQL Editor Ğ´Ğ»Ñ ÑĞ²Ğ¾ĞµĞ³Ğ¾ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°:
   https://supabase.com/dashboard/project/YOUR_PROJECT/sql/new

2. Ğ¡ĞºĞ¾Ğ¿Ğ¸Ñ€ÑƒĞ¹ Ğ¸ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğµ Ñ„Ğ°Ğ¹Ğ»Ğ°:
   `db/migrations/114_event_payments.sql`

3. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒ, Ñ‡Ñ‚Ğ¾ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ° ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾:
   ```sql
   SELECT column_name, data_type 
   FROM information_schema.columns 
   WHERE table_name = 'events' AND column_name LIKE '%payment%';
   
   SELECT column_name, data_type 
   FROM information_schema.columns 
   WHERE table_name = 'event_registrations' AND column_name LIKE '%pa%';
   ```

### Step 2: Deploy Code Changes

```bash
# Commit changes
git add .
git commit -m "feat: Day 1 Event Payments - DB schema + payment fields UI"

# Push to production
git push origin master
```

### Step 3: Verify Deployment

1. **ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ»Ğ°Ñ‚Ğ½Ğ¾Ğ³Ğ¾ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ:**
   - ĞŸĞµÑ€ĞµĞ¹Ğ´Ğ¸ Ğ² Ñ€Ğ°Ğ·Ğ´ĞµĞ» "Ğ¡Ğ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ" â†’ "Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ"
   - ĞŸĞ¾ÑÑ‚Ğ°Ğ²ÑŒ Ğ³Ğ°Ğ»Ğ¾Ñ‡ĞºÑƒ "ĞŸĞ»Ğ°Ñ‚Ğ½Ğ¾Ğµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ"
   - Ğ—Ğ°Ğ¿Ğ¾Ğ»Ğ½Ğ¸ Ğ¿Ğ¾Ğ»Ñ: Ğ¦ĞµĞ½Ğ°, Ğ’Ğ°Ğ»ÑÑ‚Ğ°, Ğ¡Ñ€Ğ¾Ğº Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ñ‹, Ğ˜Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ğ¸
   - Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ

2. **ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ:**
   - ĞÑ‚ĞºÑ€Ğ¾Ğ¹ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰ĞµĞµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ
   - ĞĞ°Ğ¶Ğ¼Ğ¸ "Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ"
   - Ğ˜Ğ·Ğ¼ĞµĞ½Ğ¸ payment Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸
   - Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸

3. **ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒ Ğ±Ğ°Ğ·Ñƒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…:**
   ```sql
   -- Ğ”Ğ¾Ğ»Ğ¶Ğ½Ñ‹ ÑƒĞ²Ğ¸Ğ´ĞµÑ‚ÑŒ Ğ½Ğ¾Ğ²Ñ‹Ğµ Ğ¿Ğ¾Ğ»Ñ
   SELECT 
     id, 
     title, 
     requires_payment, 
     default_price, 
     currency,
     payment_deadline_days
   FROM events 
   WHERE requires_payment = true
   LIMIT 5;
   ```

## ğŸ”„ What's Next (Day 2)

ĞŸĞ¾ÑĞ»Ğµ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾Ğ³Ğ¾ Ğ´ĞµĞ¿Ğ»Ğ¾Ñ Day 1, Ğ¼Ñ‹ Ğ¿ĞµÑ€ĞµĞ¹Ğ´ĞµĞ¼ Ğº:
- API endpoints Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ğ°Ğ¼Ğ¸
- Endpoint Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ ÑĞ¿Ğ¸ÑĞºĞ° ÑƒÑ‡Ğ°ÑÑ‚Ğ½Ğ¸ĞºĞ¾Ğ² Ñ payment ÑÑ‚Ğ°Ñ‚ÑƒÑĞ°Ğ¼Ğ¸
- Endpoint Ğ´Ğ»Ñ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ payment ÑÑ‚Ğ°Ñ‚ÑƒÑĞ°
- Endpoint Ğ´Ğ»Ñ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¸ Ğ¿Ğ¾ Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ğ°Ğ¼

## ğŸ› Troubleshooting

### ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°: "column event_registrations.org_id does not exist"
- âœ… **Ğ˜Ğ¡ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞ** Ğ² Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞ¹ Ğ²ĞµÑ€ÑĞ¸Ğ¸ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸
- Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½ JOIN Ñ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†ĞµĞ¹ `events` Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ `org_id`
- Ğ•ÑĞ»Ğ¸ Ğ²Ğ¸Ğ´Ğ¸ÑˆÑŒ ÑÑ‚Ñƒ Ğ¾ÑˆĞ¸Ğ±ĞºÑƒ - Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ¸ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ¸Ğ· Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ñ

### ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°: ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ½Ğµ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ÑĞµÑ‚ÑÑ
- ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒ, Ñ‡Ñ‚Ğ¾ Ñƒ Ñ‚ĞµĞ±Ñ ĞµÑÑ‚ÑŒ Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ½Ğ° Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ ÑÑ…ĞµĞ¼Ñ‹ Ğ‘Ğ”
- ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒ Ğ²ĞµÑ€ÑĞ¸Ñ PostgreSQL (Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ° Ğ±Ñ‹Ñ‚ÑŒ 14+)

### ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°: ĞĞµ Ğ²Ğ¸Ğ´Ğ½Ğ¾ Ğ½Ğ¾Ğ²Ñ‹Ñ… Ğ¿Ğ¾Ğ»ĞµĞ¹ Ğ² UI
- ĞÑ‡Ğ¸ÑÑ‚Ğ¸ ĞºĞµÑˆ Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğ° (Ctrl+Shift+R)
- ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒ, Ñ‡Ñ‚Ğ¾ ĞºĞ¾Ğ´ Ğ·Ğ°Ğ´ĞµĞ¿Ğ»Ğ¾ĞµĞ½ Ğ½Ğ° Vercel
- ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒ Ğ»Ğ¾Ğ³Ğ¸ Vercel Ğ½Ğ° Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ğµ Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº Ğ±Ğ¸Ğ»Ğ´Ğ°

### ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°: ĞÑˆĞ¸Ğ±ĞºĞ° "column does not exist"
- Ğ£Ğ±ĞµĞ´Ğ¸ÑÑŒ, Ñ‡Ñ‚Ğ¾ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ° ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾
- ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒ Ğ¸Ğ¼ĞµĞ½Ğ° Ğ¿Ğ¾Ğ»ĞµĞ¹ Ğ² Ğ‘Ğ” (snake_case vs camelCase)

## ğŸ“Š Expected Database Schema After Migration

### Table: events
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Column                  â”‚ Type         â”‚ Default  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ requires_payment        â”‚ boolean      â”‚ false    â”‚
â”‚ default_price           â”‚ decimal(10,2)â”‚ null     â”‚
â”‚ currency                â”‚ varchar(3)   â”‚ 'RUB'    â”‚
â”‚ payment_deadline_days   â”‚ integer      â”‚ 3        â”‚
â”‚ payment_instructions    â”‚ text         â”‚ null     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Table: event_registrations
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Column                  â”‚ Type         â”‚ Default  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ price                   â”‚ decimal(10,2)â”‚ null     â”‚
â”‚ payment_status          â”‚ varchar(20)  â”‚ 'pending'â”‚
â”‚ payment_method          â”‚ varchar(50)  â”‚ null     â”‚
â”‚ paid_at                 â”‚ timestamptz  â”‚ null     â”‚
â”‚ paid_amount             â”‚ decimal(10,2)â”‚ 0        â”‚
â”‚ payment_notes           â”‚ text         â”‚ null     â”‚
â”‚ payment_updated_by      â”‚ uuid         â”‚ null     â”‚
â”‚ payment_updated_at      â”‚ timestamptz  â”‚ null     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Status:** âœ… Ready for deployment  
**Migration:** 114_event_payments.sql (note: 113 was used by engagement_breakdown)  
**Tested:** Locally (schema + API + UI)  
**Backward Compatible:** Yes (ÑÑ‚Ğ°Ñ€Ñ‹Ğµ Ğ¿Ğ¾Ğ»Ñ `is_paid`, `price_info` Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ÑÑ‚ÑÑ)

