# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è

## –ü—Ä–æ–±–ª–µ–º–∞

–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ (`custom_attributes`) –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ –ø—Ä–æ—Ñ–∏–ª—å —É—á–∞—Å—Ç–Ω–∏–∫–∞ –∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è, –Ω–æ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏—Å—á–µ–∑–∞—é—Ç.

### –ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ:

1. ‚úÖ Frontend –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ API
2. ‚úÖ API –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `custom_attributes` –≤ `allowedFields`
3. ‚úÖ API –ø—ã—Ç–∞–µ—Ç—Å—è —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –ë–î
4. ‚ùå **–í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–ª–µ `custom_attributes`!**

### –°–∏–º–ø—Ç–æ–º—ã:

- –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (–æ–±–Ω–æ–≤–∏–ª—Å—è frontend state)
- –ü–æ—Å–ª–µ —É—Ö–æ–¥–∞ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ –≤–æ–∑–≤—Ä–∞—Ç–∞ - –∏—Å—á–µ–∑–∞–µ—Ç (–≤ –ë–î –Ω–µ —Å–æ—Ö—Ä–∞–Ω–∏–ª–æ—Å—å)
- –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 200 OK)
- Supabase –º–æ–ª—á–∞ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç –ø–æ–ª–µ, –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–µ—Ç –≤ —Å—Ö–µ–º–µ

## –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞

–í –∏—Å—Ö–æ–¥–Ω–æ–π —Å—Ö–µ–º–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (`01_initial_schema.sql`) —Ç–∞–±–ª–∏—Ü–∞ `participants` —Å–æ–∑–¥–∞–Ω–∞ –±–µ–∑ –ø–æ–ª—è `custom_attributes`:

```sql
-- –ë—ã–ª–æ (01_initial_schema.sql):
create table public.participants (
  id uuid primary key default gen_random_uuid(),
  org_id uuid references public.organizations(id) on delete cascade,
  tg_user_id bigint,
  username text,
  full_name text,
  phone text,
  email text,
  interests text[],
  created_at timestamptz default now()
  -- ‚ùå –ù–µ—Ç custom_attributes!
);
```

## –†–µ—à–µ–Ω–∏–µ

### –ú–∏–≥—Ä–∞—Ü–∏—è 27: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ custom_attributes

**–§–∞–π–ª**: `db/migrations/27_add_custom_attributes.sql`

```sql
-- –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª–µ custom_attributes –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ —É—á–∞—Å—Ç–Ω–∏–∫–∞
ALTER TABLE public.participants
ADD COLUMN IF NOT EXISTS custom_attributes jsonb DEFAULT '{}'::jsonb;

-- –°–æ–∑–¥–∞–µ–º –∏–Ω–¥–µ–∫—Å –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ custom_attributes
CREATE INDEX IF NOT EXISTS idx_participants_custom_attributes 
ON public.participants USING gin (custom_attributes);

-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
COMMENT ON COLUMN public.participants.custom_attributes IS 
'JSON –ø–æ–ª–µ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ —É—á–∞—Å—Ç–Ω–∏–∫–∞ (–¥–æ–ª–∂–Ω–æ—Å—Ç—å, –≥–æ—Ä–æ–¥, –∏–Ω—Ç–µ—Ä–µ—Å—ã –∏ —Ç.–¥.)';
```

### –ü–æ—á–µ–º—É JSONB?

- **JSONB**: –ë–∏–Ω–∞—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç JSON —Å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–µ–π
- –ü–æ–∑–≤–æ–ª—è–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –±–µ–∑ –∑–∞—Ä–∞–Ω–µ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π —Å—Ö–µ–º—ã
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç GIN –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
- –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è key-value —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫: `{ "–î–æ–ª–∂–Ω–æ—Å—Ç—å": "–ú–µ–Ω–µ–¥–∂–µ—Ä", "–ì–æ—Ä–æ–¥": "–ú–æ—Å–∫–≤–∞" }`

## –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏

### –®–∞–≥ 1: –ü—Ä–∏–º–µ–Ω–∏—Ç—å SQL –≤ Supabase

1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard ‚Üí SQL Editor
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `db/migrations/27_add_custom_attributes.sql`
3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—Å–ø–µ—à–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ SQL Editor:

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø–æ–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ
SELECT column_name, data_type, column_default
FROM information_schema.columns
WHERE table_name = 'participants' 
  AND column_name = 'custom_attributes';

-- –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
-- column_name       | data_type | column_default
-- custom_attributes | jsonb     | '{}'::jsonb
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω–¥–µ–∫—Å

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∏–Ω–¥–µ–∫—Å —Å–æ–∑–¥–∞–Ω
SELECT indexname, indexdef
FROM pg_indexes
WHERE tablename = 'participants' 
  AND indexname = 'idx_participants_custom_attributes';

-- –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
-- indexname                              | indexdef
-- idx_participants_custom_attributes     | CREATE INDEX ...
```

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (—É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ)

–í API —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:

**–§–∞–π–ª**: `app/api/participants/[participantId]/route.ts`

```typescript
// –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º
console.log('PUT /api/participants/[participantId]', {
  participantId,
  canonicalId,
  updatePayload,
  hasCustomAttributes: 'custom_attributes' in updatePayload,
  customAttributesValue: updatePayload.custom_attributes
});

// –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
console.log('Participant updated successfully:', {
  canonicalId,
  updatedCustomAttributes: updatedParticipant?.custom_attributes
});
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ Vercel Logs**:

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—ã —É–≤–∏–¥–∏—Ç–µ:
```
PUT /api/participants/[participantId] {
  participantId: "...",
  canonicalId: "...",
  hasCustomAttributes: true,
  customAttributesValue: { "–î–æ–ª–∂–Ω–æ—Å—Ç—å": "–ú–µ–Ω–µ–¥–∂–µ—Ä" }
}

Participant updated successfully: {
  canonicalId: "...",
  updatedCustomAttributes: { "–î–æ–ª–∂–Ω–æ—Å—Ç—å": "–ú–µ–Ω–µ–¥–∂–µ—Ä" }
}
```

## Workflow –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –î–æ –º–∏–≥—Ä–∞—Ü–∏–∏ (–Ω–µ —Ä–∞–±–æ—Ç–∞–ª–æ):

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–±–∞–≤–ª—è–µ—Ç —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫—É "–î–æ–ª–∂–Ω–æ—Å—Ç—å" = "–ú–µ–Ω–µ–¥–∂–µ—Ä"
2. Frontend –æ–±–Ω–æ–≤–ª—è–µ—Ç state ‚Üí —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è ‚úÖ
3. Frontend –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç PUT /api/participants/[id]
4. API –ø—ã—Ç–∞–µ—Ç—Å—è UPDATE participants SET custom_attributes = '{"–î–æ–ª–∂–Ω–æ—Å—Ç—å":"–ú–µ–Ω–µ–¥–∂–µ—Ä"}'
5. ‚ùå PostgreSQL: "column custom_attributes does not exist" (–º–æ–ª—á–∞ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è)
6. API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 200 OK (–±–µ–∑ –æ—à–∏–±–∫–∏)
7. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Ö–æ–¥–∏—Ç —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
8. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è ‚Üí –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ –ë–î
9. ‚ùå custom_attributes = null ‚Üí —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ –∏—Å—á–µ–∑–ª–∞
```

### –ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏ (—Ä–∞–±–æ—Ç–∞–µ—Ç):

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–±–∞–≤–ª—è–µ—Ç —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫—É "–î–æ–ª–∂–Ω–æ—Å—Ç—å" = "–ú–µ–Ω–µ–¥–∂–µ—Ä"
2. Frontend –æ–±–Ω–æ–≤–ª—è–µ—Ç state ‚Üí —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è ‚úÖ
3. Frontend –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç PUT /api/participants/[id]
4. API –≤—ã–ø–æ–ª–Ω—è–µ—Ç UPDATE participants SET custom_attributes = '{"–î–æ–ª–∂–Ω–æ—Å—Ç—å":"–ú–µ–Ω–µ–¥–∂–µ—Ä"}'
5. ‚úÖ PostgreSQL: –ø–æ–ª–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
6. API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 200 OK —Å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
7. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Ö–æ–¥–∏—Ç —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
8. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è ‚Üí –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ –ë–î
9. ‚úÖ custom_attributes = {"–î–æ–ª–∂–Ω–æ—Å—Ç—å":"–ú–µ–Ω–µ–¥–∂–µ—Ä"} ‚Üí —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è!
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏

```
1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é 27
2. –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–æ—Ñ–∏–ª—å —É—á–∞—Å—Ç–Ω–∏–∫–∞
3. –ù–∞–∂–∞—Ç—å "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"
4. –î–æ–±–∞–≤–∏—Ç—å: "–î–æ–ª–∂–Ω–æ—Å—Ç—å" = "–ú–µ–Ω–µ–¥–∂–µ—Ä"
5. –ù–∞–∂–∞—Ç—å "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"
6. ‚úÖ –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
7. –£–π—Ç–∏ –Ω–∞ –¥—Ä—É–≥—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
8. –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –ø—Ä–æ—Ñ–∏–ª—å
9. ‚úÖ –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ –≤—Å–µ –µ—â–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
```

### –¢–µ—Å—Ç 2: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏

```
1. –î–æ–±–∞–≤–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫:
   - "–î–æ–ª–∂–Ω–æ—Å—Ç—å" = "–ú–µ–Ω–µ–¥–∂–µ—Ä"
   - "–ì–æ—Ä–æ–¥" = "–ú–æ—Å–∫–≤–∞"
   - "–û–ø—ã—Ç" = "5 –ª–µ—Ç"
2. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
3. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
4. ‚úÖ –í—Å–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è
```

### –¢–µ—Å—Ç 3: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏

```
1. –ò–∑–º–µ–Ω–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫—É
2. "–î–æ–ª–∂–Ω–æ—Å—Ç—å" = "–ú–µ–Ω–µ–¥–∂–µ—Ä" ‚Üí "–î–∏—Ä–µ–∫—Ç–æ—Ä"
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
4. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å
5. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–∏–ª–æ—Å—å
```

### –¢–µ—Å—Ç 4: –£–¥–∞–ª–µ–Ω–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏

```
1. –£–¥–∞–ª–∏—Ç—å —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫—É (–∫–Ω–æ–ø–∫–∞ —Å –∫–æ—Ä–∑–∏–Ω–æ–π)
2. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
3. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å
4. ‚úÖ –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ —É–¥–∞–ª–µ–Ω–∞ –Ω–∞–≤—Å–µ–≥–¥–∞
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–î

–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ Supabase SQL Editor:

```sql
-- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å custom_attributes –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞
SELECT 
  id, 
  full_name, 
  custom_attributes
FROM participants
WHERE id = 'YOUR_PARTICIPANT_ID';

-- –ù–∞–π—Ç–∏ –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —Å –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º–∏
SELECT 
  id, 
  full_name, 
  custom_attributes
FROM participants
WHERE custom_attributes IS NOT NULL 
  AND custom_attributes != '{}'::jsonb
LIMIT 10;

-- –ü–æ–∏—Å–∫ –ø–æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º (—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º GIN –∏–Ω–¥–µ–∫—Å–∞)
SELECT 
  id, 
  full_name, 
  custom_attributes->>'–î–æ–ª–∂–Ω–æ—Å—Ç—å' as position
FROM participants
WHERE custom_attributes ? '–î–æ–ª–∂–Ω–æ—Å—Ç—å';
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ JSONB

### 1. –ì–∏–±–∫–æ—Å—Ç—å —Å—Ö–µ–º—ã

```sql
-- –ú–æ–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –ª—é–±—ã–µ –∫–ª—é—á–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ö–µ–º—ã
custom_attributes = {
  "–î–æ–ª–∂–Ω–æ—Å—Ç—å": "–ú–µ–Ω–µ–¥–∂–µ—Ä",
  "–ì–æ—Ä–æ–¥": "–ú–æ—Å–∫–≤–∞",
  "–•–æ–±–±–∏": "–§—É—Ç–±–æ–ª",
  "–õ—é–±–æ–µ –ø–æ–ª–µ": "–õ—é–±–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ"
}
```

### 2. –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –∏ –ø–æ–∏—Å–∫

```sql
-- –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –ø–æ –∫–ª—é—á–∞–º
WHERE custom_attributes ? '–î–æ–ª–∂–Ω–æ—Å—Ç—å'

-- –ü–æ–∏—Å–∫ –ø–æ –∑–Ω–∞—á–µ–Ω–∏—è–º
WHERE custom_attributes->>'–ì–æ—Ä–æ–¥' = '–ú–æ—Å–∫–≤–∞'

-- –ü–æ–∏—Å–∫ –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º —É—Å–ª–æ–≤–∏—è–º
WHERE custom_attributes @> '{"–î–æ–ª–∂–Ω–æ—Å—Ç—å": "–ú–µ–Ω–µ–¥–∂–µ—Ä"}'::jsonb
```

### 3. –ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

```sql
-- –î–æ–±–∞–≤–∏—Ç—å –æ–¥–Ω–æ –ø–æ–ª–µ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏ –≤—Å–µ–≥–æ JSON
UPDATE participants
SET custom_attributes = custom_attributes || '{"–ù–æ–≤–æ–µ –ø–æ–ª–µ": "–ó–Ω–∞—á–µ–Ω–∏–µ"}'::jsonb
WHERE id = '...';

-- –£–¥–∞–ª–∏—Ç—å –æ–¥–Ω–æ –ø–æ–ª–µ
UPDATE participants
SET custom_attributes = custom_attributes - '–ù–µ–Ω—É–∂–Ω–æ–µ –ø–æ–ª–µ'
WHERE id = '...';
```

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã (–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É—é—Ç—Å—è)

### –í–∞—Ä–∏–∞–Ω—Ç 1: participant_traits —Ç–∞–±–ª–∏—Ü–∞ (—É–∂–µ –µ—Å—Ç—å)

**–£–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è**:
- –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ –∏–∑ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
- –ê—É–¥–∏—Ç –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

**–ù–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ä—É—á–Ω—ã—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫**, —Ç–∞–∫ –∫–∞–∫:
- –¢—Ä–µ–±—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –∫–∞–∂–¥–æ–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
- –°–ª–æ–∂–Ω–µ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ä–∞–∑—É –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–Ω–∞—á–µ–Ω–∏–π
- –ò–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç—å –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö key-value –ø–∞—Ä

### –í–∞—Ä–∏–∞–Ω—Ç 2: –û—Ç–¥–µ–ª—å–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏

```sql
ALTER TABLE participants
ADD COLUMN position text,
ADD COLUMN city text,
ADD COLUMN hobby text;
```

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏**:
- –ù—É–∂–Ω–æ –∑–∞—Ä–∞–Ω–µ–µ –∑–Ω–∞—Ç—å –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø–æ–ª—è
- –ú–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –Ω–æ–≤–æ–º –ø–æ–ª–µ
- –ù–µ–≥–∏–±–∫–æ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π

**JSONB –∏–¥–µ–∞–ª–µ–Ω –¥–ª—è –Ω–∞—à–µ–≥–æ —Å–ª—É—á–∞—è!**

## –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. ‚úÖ `db/migrations/27_add_custom_attributes.sql` - –Ω–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è
2. ‚úÖ `app/api/participants/[participantId]/route.ts` - –¥–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
3. üìÑ `CUSTOM_ATTRIBUTES_FIX.md` - —ç—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –≤ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø–æ–ª—è `custom_attributes` –≤ —Å—Ö–µ–º–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö. –ü–æ–ª–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª–æ –≤ TypeScript —Ç–∏–ø–∞—Ö –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–æ—Å—å –≤ –∫–æ–¥–µ, –Ω–æ —Ñ–∏–∑–∏—á–µ—Å–∫–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–æ –≤ PostgreSQL.

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏ 27:
- ‚úÖ –ü–æ–ª–µ `custom_attributes` –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ —Ç–∞–±–ª–∏—Ü—É `participants`
- ‚úÖ –°–æ–∑–¥–∞–Ω GIN –∏–Ω–¥–µ–∫—Å –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
- ‚úÖ –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î
- ‚úÖ –î–∞–Ω–Ω—ã–µ –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

**–¢–µ–ø–µ—Ä—å –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ!** üéâ

