# ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –±–æ—Ç–æ–≤ –∏–∑ –∞–¥–º–∏–Ω–æ–≤

## üéØ –ü—Ä–æ–±–ª–µ–º–∞

–ë–æ—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, `orbo_community_bot`) —Å–æ—Ö—Ä–∞–Ω—è–ª–∏—Å—å –∫–∞–∫ –∞–¥–º–∏–Ω—ã –∏ –ø–æ—è–≤–ª—è–ª–∏—Å—å –≤ "–ö–æ–º–∞–Ω–¥–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏" –∫–∞–∫ "User 8355772450".

**–ü—Ä–∏—á–∏–Ω–∞:**
- API `update-admin-rights` –Ω–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–ª –±–æ—Ç–æ–≤
- `sync_telegram_admins` —Å–æ–∑–¥–∞–≤–∞–ª –¥–ª—è –Ω–∏—Ö participants –∏ memberships

---

## ‚úÖ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1Ô∏è‚É£ –§–∏–ª—å—Ç—Ä –Ω–∞ —É—Ä–æ–≤–Ω–µ API

**–§–∞–π–ª:** `app/api/telegram/groups/update-admin-rights/route.ts`

**–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `is_bot`:**
```typescript
const isBot = admin?.user?.is_bot;

// ‚úÖ –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –±–æ—Ç–æ–≤ (–≤–∫–ª—é—á–∞—è orbo_community_bot)
if (isBot) {
  console.log(`‚è≠Ô∏è  Skipping bot ${userId} (${admin.user?.username}) in chat ${chatId}`);
  continue;
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ë–æ—Ç—ã –±–æ–ª—å—à–µ **–Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è** –≤ `telegram_group_admins`

---

### 2Ô∏è‚É£ –§–∏–ª—å—Ç—Ä –≤ sync_telegram_admins

**–§–∞–π–ª:** `db/migrations/065_fix_sync_telegram_admins_create_participant.sql`

**–î–æ–±–∞–≤–ª–µ–Ω —Ñ–∏–ª—å—Ç—Ä –≤ WHERE:**
```sql
WHERE 
  otg.org_id = p_org_id
  AND tga.is_admin = true
  AND tga.expires_at > NOW()
  -- ‚úÖ –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –±–æ—Ç–æ–≤
  AND tga.tg_user_id NOT IN (
    8355772450,  -- orbo_community_bot
    777000       -- Telegram Service Notifications
  )
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –î–∞–∂–µ –µ—Å–ª–∏ –±–æ—Ç—ã –µ—Å—Ç—å –≤ `telegram_group_admins`, –æ–Ω–∏ **–Ω–µ –±—É–¥—É—Ç** –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ memberships

---

### 3Ô∏è‚É£ –°–∫—Ä–∏–ø—Ç –æ—á–∏—Å—Ç–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö

**–§–∞–π–ª:** `db/cleanup_bot_admins.sql`

**–£–¥–∞–ª—è–µ—Ç:**
1. Memberships –¥–ª—è –±–æ—Ç–æ–≤
2. Participants –¥–ª—è –±–æ—Ç–æ–≤
3. –ó–∞–ø–∏—Å–∏ –∏–∑ `telegram_group_admins`
4. Shadow users –¥–ª—è –±–æ—Ç–æ–≤

---

## üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é

### –®–∞–≥ 1: –û—á–∏—Å—Ç–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ ‚úÖ
```sql
-- –í Supabase SQL Editor:
db/cleanup_bot_admins.sql
```

**–û–∂–∏–¥–∞–µ—Ç—Å—è:**
- –£–¥–∞–ª–µ–Ω–æ memberships: N
- –£–¥–∞–ª–µ–Ω–æ participants: N
- –£–¥–∞–ª–µ–Ω–æ –∏–∑ telegram_group_admins: N
- –ü—Ä–æ–≤–µ—Ä–∫–∞: 0 –±–æ—Ç–æ–≤ –≤ –∞–¥–º–∏–Ω–∞—Ö

---

### –®–∞–≥ 2: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é 065 (–æ–±–Ω–æ–≤–ª—ë–Ω–Ω—É—é) ‚úÖ
```sql
-- –í Supabase SQL Editor:
db/migrations/065_fix_sync_telegram_admins_create_participant.sql
```

–ú–∏–≥—Ä–∞—Ü–∏—è —Ç–µ–ø–µ—Ä—å –≤–∫–ª—é—á–∞–µ—Ç —Ñ–∏–ª—å—Ç—Ä –±–æ—Ç–æ–≤.

---

### –®–∞–≥ 3: –î–µ–ø–ª–æ–π –∫–æ–¥–∞ ‚úÖ

**–ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- `app/api/telegram/groups/update-admin-rights/route.ts`

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –±–æ—Ç—ã –±–æ–ª—å—à–µ –Ω–µ –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–æ–≤.

---

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞

### –¢–µ—Å—Ç 1: –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
1. –û—Ç–∫—Ä–æ–π—Ç–µ `/app/{org}/telegram`
2. –ù–∞–∂–º–∏—Ç–µ "–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤"
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Vercel

**–û–∂–∏–¥–∞–µ—Ç—Å—è –≤ –ª–æ–≥–∞—Ö:**
```
‚è≠Ô∏è  Skipping bot 8355772450 (orbo_community_bot) in chat -1002994446785
```

---

### –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–º–∞–Ω–¥—É –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
1. –û—Ç–∫—Ä–æ–π—Ç–µ `/app/{org}/settings`
2. –†–∞–∑–¥–µ–ª "–ö–æ–º–∞–Ω–¥–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏"

**–û–∂–∏–¥–∞–µ—Ç—Å—è:**
- ‚úÖ –ù–ï–¢ "User 8355772450" –≤ —Å–ø–∏—Å–∫–µ –∞–¥–º–∏–Ω–æ–≤
- ‚úÖ –¢–æ–ª—å–∫–æ –Ω–∞—Å—Ç–æ—è—â–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏

---

### –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
```sql
-- –ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –±–æ—Ç–æ–≤ –≤ organization_admins
SELECT * FROM organization_admins
WHERE full_name LIKE 'User 835577%' 
   OR full_name LIKE 'User 777000%';
```

**–û–∂–∏–¥–∞–µ—Ç—Å—è:** –ü—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç ‚úÖ

---

## üìä –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –±–æ—Ç—ã

**–§–∏–ª—å—Ç—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:**
- `8355772450` - orbo_community_bot (–≤–∞—à –±–æ—Ç)
- `777000` - Telegram Service Notifications (—Å–∏—Å—Ç–µ–º–Ω—ã–π –±–æ—Ç)

**–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ API:**
- –õ—é–±–æ–π –±–æ—Ç —Å `is_bot: true` (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä)

---

## üéØ –ò—Ç–æ–≥

‚úÖ **–ë–æ—Ç—ã —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ API** - –Ω–µ –ø–æ–ø–∞–¥–∞—é—Ç –≤ `telegram_group_admins`  
‚úÖ **–ë–æ—Ç—ã —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è –≤ sync_telegram_admins** - –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è memberships  
‚úÖ **–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –±–æ—Ç—ã —É–¥–∞–ª–µ–Ω—ã** - —Å–∫—Ä–∏–ø—Ç –æ—á–∏—Å—Ç–∫–∏  
‚úÖ **–ë—É–¥—É—â–∏–µ –±–æ—Ç—ã** - –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å—Å—è  

---

**–ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é!** üöÄ  
–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤ –±–æ—Ç—ã –±–æ–ª—å—à–µ –Ω–µ –±—É–¥—É—Ç –ø–æ—è–≤–ª—è—Ç—å—Å—è –≤ –∫–æ–º–∞–Ω–¥–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏.

