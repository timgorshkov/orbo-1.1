# ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≥—Ä—É–ø–ø

## üéØ –ü—Ä–æ–±–ª–µ–º–∞

–í —Ä–∞–∑–¥–µ–ª–µ "–î–æ—Å—Ç—É–ø–Ω—ã–µ –≥—Ä—É–ø–ø—ã" –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏—Å—å **–í–°–ï** –≥—Ä—É–ø–ø—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–º –±–æ—Ç–æ–º, –¥–∞–∂–µ —Ç–µ, –∫ –∫–æ—Ç–æ—Ä—ã–º –≤–ª–∞–¥–µ–ª–µ—Ü –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –Ω–µ –∏–º–µ–µ—Ç –æ—Ç–Ω–æ—à–µ–Ω–∏—è.

**–ü—Ä–∏–º–µ—Ä:**
–í–ª–∞–¥–µ–ª–µ—Ü –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ (–¢–∏–º—É—Ä –ì–æ–ª–∏—Ü—ã–Ω) –≤–∏–¥–µ–ª –≥—Ä—É–ø–ø—ã, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –æ–Ω –Ω–µ —Å–æ—Å—Ç–æ–∏—Ç –∏ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∞–¥–º–∏–Ω–æ–º.

---

## ‚úÖ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `/api/telegram/groups/for-user`

**–§–∞–π–ª:** `app/api/telegram/groups/for-user/route.ts`

#### 1Ô∏è‚É£ –£–±—Ä–∞–Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –≥—Ä—É–ø–ø

**–ë—ã–ª–æ (—Å—Ç—Ä–æ–∫–∏ 124-143):**
```typescript
// ‚ùå –ü–æ–ª—É—á–∞–µ–º –í–°–ï –≥—Ä—É–ø–ø—ã —Å bot_status='connected'
const { data: connectedGroups } = await supabaseService
  .from('telegram_groups')
  .select('tg_chat_id')
  .eq('bot_status', 'connected');

// –û–±—ä–µ–¥–∏–Ω—è–µ–º —Å –≥—Ä—É–ø–ø–∞–º–∏, –≥–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–¥–º–∏–Ω
const allChatIds = new Set([
  ...Array.from(chatIdsFromAdminRights), 
  ...Array.from(chatIdsFromConnected)
]);
```

**–°—Ç–∞–ª–æ:**
```typescript
// ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¢–û–õ–¨–ö–û –≥—Ä—É–ø–ø—ã, –≥–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∞–¥–º–∏–Ω
if (!adminRights || adminRights.length === 0) {
  return NextResponse.json({
    groups: [],
    availableGroups: [],
    message: 'You are not an admin in any Telegram groups'
  });
}

const allChatIds = new Set(adminRights.map(right => String(right.tg_chat_id)));
```

#### 2Ô∏è‚É£ –£–ø—Ä–æ—â–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

**–ë—ã–ª–æ (—Å—Ç—Ä–æ–∫–∏ 415-425):**
```typescript
// ‚ùå –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≥—Ä—É–ø–ø—É, –¥–∞–∂–µ –µ—Å–ª–∏ –Ω–µ—Ç –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∞
if (isLinkedToOrg && botHasAdminRights) {
  existingGroups.push(normalizedGroup);
} else if (!isLinkedToOrg && (botHasAdminRights || groupAny.bot_status === 'connected')) {
  availableGroups.push(normalizedGroup);
  if (!hasAdminRights) {
    console.log(`‚ö†Ô∏è Group will be shown with "grant admin rights" warning`);
  }
}
```

**–°—Ç–∞–ª–æ:**
```typescript
// ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –≥—Ä—É–ø–ø—ã, –≥–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–µ–∞–ª—å–Ω–æ –∞–¥–º–∏–Ω
if (isLinkedToOrg) {
  // –ì—Ä—É–ø–ø–∞ —É–∂–µ –ø—Ä–∏–≤—è–∑–∞–Ω–∞ –∫ —ç—Ç–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
  existingGroups.push(normalizedGroup);
} else if (hasAdminRights && botHasAdminRights) {
  // –ì—Ä—É–ø–ø–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–¥–º–∏–Ω –ò –±–æ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω
  availableGroups.push(normalizedGroup);
}
```

---

## üìã –ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞

**–ì—Ä—É–ø–ø–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ "–î–æ—Å—Ç—É–ø–Ω—ã–µ –≥—Ä—É–ø–ø—ã", –¢–û–õ–¨–ö–û –µ—Å–ª–∏:**
1. ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å **–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∞–¥–º–∏–Ω** –≤ —ç—Ç–æ–π –≥—Ä—É–ø–ø–µ
2. ‚úÖ –ë–æ—Ç **–ø–æ–¥–∫–ª—é—á–µ–Ω** –∫ –≥—Ä—É–ø–ø–µ (`bot_status: 'connected'`)
3. ‚úÖ –ì—Ä—É–ø–ø–∞ **–µ—â—ë –ù–ï –¥–æ–±–∞–≤–ª–µ–Ω–∞** –≤ —ç—Ç—É –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é

**–ì—Ä—É–ø–ø–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ "–ü–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–µ –≥—Ä—É–ø–ø—ã", –µ—Å–ª–∏:**
1. ‚úÖ –ì—Ä—É–ø–ø–∞ **—É–∂–µ –ø—Ä–∏–≤—è–∑–∞–Ω–∞** –∫ —ç—Ç–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏

---

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞

### –¢–µ—Å—Ç 1: –í–ª–∞–¥–µ–ª–µ—Ü –±–µ–∑ –∞–¥–º–∏–Ω-–ø—Ä–∞–≤ –≤ –≥—Ä—É–ø–ø–∞—Ö
**–°—Ü–µ–Ω–∞—Ä–∏–π:**
1. –°–æ–∑–¥–∞—Ç—å org –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è A
2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å A –ù–ï –∞–¥–º–∏–Ω –Ω–∏ –≤ –æ–¥–Ω–æ–π –≥—Ä—É–ø–ø–µ

**–û–∂–∏–¥–∞–µ—Ç—Å—è:**
- –†–∞–∑–¥–µ–ª "–î–æ—Å—Ç—É–ø–Ω—ã–µ –≥—Ä—É–ø–ø—ã": –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫
- –°–æ–æ–±—â–µ–Ω–∏–µ: "You are not an admin in any Telegram groups"

---

### –¢–µ—Å—Ç 2: –í–ª–∞–¥–µ–ª–µ—Ü —Å –∞–¥–º–∏–Ω-–ø—Ä–∞–≤–∞–º–∏ –≤ 2 –≥—Ä—É–ø–ø–∞—Ö
**–°—Ü–µ–Ω–∞—Ä–∏–π:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å A –∞–¥–º–∏–Ω –≤ –≥—Ä—É–ø–ø–∞—Ö X –∏ Y
2. –ì—Ä—É–ø–ø–∞ X —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ org
3. –ì—Ä—É–ø–ø–∞ Y –µ—â—ë –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω–∞

**–û–∂–∏–¥–∞–µ—Ç—Å—è:**
- "–ü–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–µ –≥—Ä—É–ø–ø—ã": —Ç–æ–ª—å–∫–æ –≥—Ä—É–ø–ø–∞ X
- "–î–æ—Å—Ç—É–ø–Ω—ã–µ –≥—Ä—É–ø–ø—ã": —Ç–æ–ª—å–∫–æ –≥—Ä—É–ø–ø–∞ Y

---

### –¢–µ—Å—Ç 3: –í–ª–∞–¥–µ–ª–µ—Ü –≤–∏–¥–∏—Ç —á—É–∂–∏–µ –≥—Ä—É–ø–ø—ã
**–°—Ü–µ–Ω–∞—Ä–∏–π:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å A –∞–¥–º–∏–Ω –≤ –≥—Ä—É–ø–ø–µ X
2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å B –∞–¥–º–∏–Ω –≤ –≥—Ä—É–ø–ø–µ Z (A –Ω–µ –∞–¥–º–∏–Ω —Ç–∞–º)
3. –û–±–∞ –±–æ—Ç–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã

**–û–∂–∏–¥–∞–µ—Ç—Å—è:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å A –≤–∏–¥–∏—Ç: —Ç–æ–ª—å–∫–æ –≥—Ä—É–ø–ø—É X
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å A –ù–ï –≤–∏–¥–∏—Ç: –≥—Ä—É–ø–ø—É Z ‚úÖ

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –≤–∞—à–µ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏

**Org ID:** `a3e8bc8f-8171-472c-a955-2f7878aed6f1`  
**–í–ª–∞–¥–µ–ª–µ—Ü:** –¢–∏–º—É—Ä –ì–æ–ª–∏—Ü—ã–Ω (tg_user_id: 5484900079)

### SQL –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:
```sql
-- –ì—Ä—É–ø–ø—ã, –≥–¥–µ –¢–∏–º—É—Ä –∞–¥–º–∏–Ω
SELECT 
  tga.tg_chat_id,
  tg.title,
  tga.is_owner,
  tga.is_admin,
  otg.org_id as linked_to_org
FROM telegram_group_admins tga
INNER JOIN telegram_groups tg ON tg.tg_chat_id = tga.tg_chat_id
LEFT JOIN org_telegram_groups otg 
  ON otg.tg_chat_id = tga.tg_chat_id 
  AND otg.org_id = 'a3e8bc8f-8171-472c-a955-2f7878aed6f1'
WHERE tga.tg_user_id = 5484900079
  AND tga.is_admin = true
  AND tga.expires_at > NOW()
ORDER BY tg.title;
```

**–û–∂–∏–¥–∞–µ—Ç—Å—è:**
- –¢–æ–ª—å–∫–æ –≥—Ä—É–ø–ø—ã, –≥–¥–µ –¢–∏–º—É—Ä —Ä–µ–∞–ª—å–Ω–æ –∞–¥–º–∏–Ω
- `linked_to_org`: null (–¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è) –∏–ª–∏ org_id (—É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–∞)

---

## ‚ùì –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –≤–æ–ø—Ä–æ—Å

–í—ã —É–ø–æ–º—è–Ω—É–ª–∏: **"—Å–∫—Ä—ã—Ç—å –≤–∫–ª–∞–¥–∫—É Telegram - –ù–∞—Å—Ç—Ä–æ–π–∫–∏"**

–í —Ä–∞–∑–¥–µ–ª–µ Telegram –µ—Å—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –≤–∫–ª–∞–¥–∫–∏:
1. **–ì–ª–∞–≤–Ω–∞—è** (`/telegram`) - –¥–æ—Å—Ç—É–ø–Ω–∞ –≤—Å–µ–º
2. **–î–æ—Å—Ç—É–ø–Ω—ã–µ –≥—Ä—É–ø–ø—ã** (`/telegram/available-groups`) - —Å–µ–π—á–∞—Å –¥–æ—Å—Ç—É–ø–Ω–∞ –≤—Å–µ–º
3. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å Telegram-–∞–∫–∫–∞—É–Ω—Ç** (`/telegram/account`) - —É–∂–µ —Å–∫—Ä—ã—Ç–∞ –æ—Ç –Ω–µ-–≤–ª–∞–¥–µ–ª—å—Ü–µ–≤

**–ß—Ç–æ –∏–º–µ–Ω–Ω–æ –Ω—É–∂–Ω–æ —Å–∫—Ä—ã—Ç—å?**
- –í–∫–ª–∞–¥–∫—É "–î–æ—Å—Ç—É–ø–Ω—ã–µ –≥—Ä—É–ø–ø—ã" –¥–ª—è –Ω–µ-–≤–ª–∞–¥–µ–ª—å—Ü–µ–≤?
- –ö–∞–∫—É—é-—Ç–æ –¥—Ä—É–≥—É—é –≤–∫–ª–∞–¥–∫—É "–ù–∞—Å—Ç—Ä–æ–π–∫–∏"?

–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É—Ç–æ—á–Ω–∏—Ç–µ, –∏ —è –∏—Å–ø—Ä–∞–≤–ª—é!

---

## üéØ –ò—Ç–æ–≥

‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≥—Ä—É–ø–ø** - –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≥—Ä—É–ø–ø—ã, –≥–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–¥–º–∏–Ω  
‚úÖ **–£–±—Ä–∞–Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞** - –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —á—É–∂–∏–µ –≥—Ä—É–ø–ø—ã  
‚úÖ **–õ–æ–≥–∏–∫–∞ —É–ø—Ä–æ—â–µ–Ω–∞** - –Ω–µ—Ç –∏–∑–±—ã—Ç–æ—á–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫  

---

**–ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- `app/api/telegram/groups/for-user/route.ts`

**–ì–æ—Ç–æ–≤–æ –∫ –¥–µ–ø–ª–æ—é!** üöÄ

