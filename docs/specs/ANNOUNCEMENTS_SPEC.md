# –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è: –ê–Ω–æ–Ω—Å—ã (–ú–∞—Å—Å–æ–≤—ã–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤ –≥—Ä—É–ø–ø—ã)

## –û–±–∑–æ—Ä

–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –¥–ª—è –º–∞—Å—Å–æ–≤–æ–π —Ä–∞—Å—Å—ã–ª–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–µ Telegram-–≥—Ä—É–ø–ø—ã –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏:
- –†—É—á–Ω—ã–µ –∞–Ω–æ–Ω—Å—ã –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–≤–∞–µ–º—ã–µ –∞–Ω–æ–Ω—Å—ã –¥–ª—è —Å–æ–±—ã—Ç–∏–π (–∑–∞ 24—á –∏ 1—á)
- –ö–∞–ª–µ–Ω–¥–∞—Ä—å –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø—É–±–ª–∏–∫–∞—Ü–∏–π
- –ê—Ä—Ö–∏–≤ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ `announcements`

```sql
CREATE TABLE announcements (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  org_id UUID NOT NULL REFERENCES organizations(id) ON DELETE CASCADE,
  
  -- –ö–æ–Ω—Ç–µ–Ω—Ç
  title VARCHAR(255) NOT NULL,           -- –ó–∞–≥–æ–ª–æ–≤–æ–∫ (–¥–ª—è UI, –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è)
  content TEXT NOT NULL,                  -- –¢–µ–∫—Å—Ç —Å Telegram Markdown
  
  -- –°–≤—è–∑—å —Å —Å–æ–±—ã—Ç–∏–µ–º (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  event_id UUID REFERENCES events(id) ON DELETE SET NULL,
  reminder_type VARCHAR(50),              -- '24h', '1h', NULL –¥–ª—è —Ä—É—á–Ω—ã—Ö
  
  -- –¶–µ–ª–µ–≤—ã–µ –≥—Ä—É–ø–ø—ã
  target_groups UUID[] NOT NULL,          -- –ú–∞—Å—Å–∏–≤ ID –≥—Ä—É–ø–ø
  
  -- –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ
  scheduled_at TIMESTAMPTZ NOT NULL,      -- –ö–æ–≥–¥–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å
  sent_at TIMESTAMPTZ,                    -- –ö–æ–≥–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ
  
  -- –°—Ç–∞—Ç—É—Å
  status VARCHAR(20) DEFAULT 'scheduled', -- scheduled, sending, sent, failed, cancelled
  
  -- –ê–≤—Ç–æ—Ä—Å—Ç–≤–æ
  created_by UUID REFERENCES auth.users(id),
  created_by_name VARCHAR(255),           -- –ò–º—è –∞–≤—Ç–æ—Ä–∞ –∏–ª–∏ "–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏"
  updated_by UUID REFERENCES auth.users(id),
  updated_by_name VARCHAR(255),           -- –ò–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
  
  -- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  
  -- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—Ç–ø—Ä–∞–≤–∫–∏
  send_results JSONB                      -- {group_id: {success: bool, message_id, error}}
);

CREATE INDEX idx_announcements_org ON announcements(org_id);
CREATE INDEX idx_announcements_scheduled ON announcements(scheduled_at) WHERE status = 'scheduled';
CREATE INDEX idx_announcements_event ON announcements(event_id) WHERE event_id IS NOT NULL;
```

## API Endpoints

### GET /api/announcements?org_id=...&status=...&from=...&to=...
–°–ø–∏—Å–æ–∫ –∞–Ω–æ–Ω—Å–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π

### POST /api/announcements
–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∞–Ω–æ–Ω—Å

### GET /api/announcements/[id]
–ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –∞–Ω–æ–Ω—Å–∞

### PATCH /api/announcements/[id]
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–Ω–æ–Ω—Å (–æ–±–Ω–æ–≤–ª—è–µ—Ç updated_by_name)

### DELETE /api/announcements/[id]
–£–¥–∞–ª–∏—Ç—å –∞–Ω–æ–Ω—Å (—Ç–æ–ª—å–∫–æ scheduled)

### POST /api/announcements/[id]/send
–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∞–Ω–æ–Ω—Å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ

## Cron Job

`/api/cron/send-announcements` - –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞–Ω–æ–Ω—Å—ã

## UI –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### –°—Ç—Ä–∞–Ω–∏—Ü–∞ /p/[org]/announcements

1. **–í–∫–ª–∞–¥–∫–∏:**
   - –ö–∞–ª–µ–Ω–¥–∞—Ä—å (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
   - –°–ø–∏—Å–æ–∫ (—Ç–∞–±–ª–∏—Ü–∞ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏)
   - –ê—Ä—Ö–∏–≤ (–æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ)

2. **–ö–∞–ª–µ–Ω–¥–∞—Ä—å:**
   - –ú–µ—Å—è—á–Ω—ã–π –≤–∏–¥
   - –î–Ω–∏ —Å –∞–Ω–æ–Ω—Å–∞–º–∏ –≤—ã–¥–µ–ª–µ–Ω—ã
   - –ö–ª–∏–∫ –Ω–∞ –¥–µ–Ω—å ‚Üí —Å–ø–∏—Å–æ–∫ –∞–Ω–æ–Ω—Å–æ–≤ –¥–Ω—è

3. **–§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
   - –ó–∞–≥–æ–ª–æ–≤–æ–∫ (–¥–ª—è UI)
   - –ö–æ–Ω—Ç–µ–Ω—Ç —Å Telegram Markdown preview
   - –í—ã–±–æ—Ä –≥—Ä—É–ø–ø (–º—É–ª—å—Ç–∏—Å–µ–ª–µ–∫—Ç)
   - –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏
   - –°–≤—è–∑—å —Å —Å–æ–±—ã—Ç–∏–µ–º (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

4. **–ö–∞—Ä—Ç–æ—á–∫–∞ –∞–Ω–æ–Ω—Å–∞:**
   - –°—Ç–∞—Ç—É—Å (—Ü–≤–µ—Ç–Ω–æ–π –±–µ–π–¥–∂)
   - –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –ø—Ä–µ–≤—å—é —Ç–µ–∫—Å—Ç–∞
   - –¶–µ–ª–µ–≤—ã–µ –≥—Ä—É–ø–ø—ã
   - –ê–≤—Ç–æ—Ä / –ü–æ—Å–ª–µ–¥–Ω–∏–π —Ä–µ–¥–∞–∫—Ç–æ—Ä
   - –î–µ–π—Å—Ç–≤–∏—è: —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å, –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–µ–π—á–∞—Å, —É–¥–∞–ª–∏—Ç—å

## –ê–≤—Ç–æ—Å–æ–∑–¥–∞–Ω–∏–µ –∞–Ω–æ–Ω—Å–æ–≤ –¥–ª—è —Å–æ–±—ã—Ç–∏–π

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–æ–±—ã—Ç–∏—è:
1. –ï—Å–ª–∏ –¥–∞—Ç–∞ —Å–æ–±—ã—Ç–∏—è > —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è + 24—á ‚Üí —Å–æ–∑–¥–∞—Ç—å –∞–Ω–æ–Ω—Å –∑–∞ 24—á
2. –ï—Å–ª–∏ –¥–∞—Ç–∞ —Å–æ–±—ã—Ç–∏—è > —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è + 1—á ‚Üí —Å–æ–∑–¥–∞—Ç—å –∞–Ω–æ–Ω—Å –∑–∞ 1—á
3. `created_by_name = "–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏"`
4. `reminder_type = "24h"` –∏–ª–∏ `"1h"`
5. `event_id = id —Å–æ–±—ã—Ç–∏—è`

–®–∞–±–ª–æ–Ω —Ç–µ–∫—Å—Ç–∞:
```
üóì –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ: {–Ω–∞–∑–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è}

üìÖ {–¥–∞—Ç–∞ –∏ –≤—Ä–µ–º—è}
üìç {–º–µ—Å—Ç–æ, –µ—Å–ª–∏ –µ—Å—Ç—å}

{–æ–ø–∏—Å–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è}
```

## Telegram Markdown

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
- **–∂–∏—Ä–Ω—ã–π** ‚Üí `*–∂–∏—Ä–Ω—ã–π*`
- _–∫—É—Ä—Å–∏–≤_ ‚Üí `_–∫—É—Ä—Å–∏–≤_`
- ~~–∑–∞—á—ë—Ä–∫–Ω—É—Ç—ã–π~~ ‚Üí `~–∑–∞—á—ë—Ä–∫–Ω—É—Ç—ã–π~`
- `–∫–æ–¥` ‚Üí `` `–∫–æ–¥` ``
- [—Å—Å—ã–ª–∫–∞](url) ‚Üí `[—Å—Å—ã–ª–∫–∞](url)`
- Emoji: —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ Unicode

## –ê–≤—Ç–æ—Ä—Å—Ç–≤–æ

- –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏: `created_by_name` = –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ "–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏"
- –ü—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏: `updated_by_name` = –∏–º—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ UI: "–ê–≤—Ç–æ—Ä: {created_by_name}" –∏ –µ—Å–ª–∏ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è "–ò–∑–º–µ–Ω–∏–ª: {updated_by_name}"

