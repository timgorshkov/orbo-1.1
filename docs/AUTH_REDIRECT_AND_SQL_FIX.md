# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è: —Ä–µ–¥–∏—Ä–µ–∫—Ç –ø–æ—Å–ª–µ –ª–æ–≥–∏–Ω–∞ –∏ SQL –æ—à–∏–±–∫–∞

## ‚úÖ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. üìã –°–ø–∏—Å–æ–∫ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π –ø–æ—Å–ª–µ –ª–æ–≥–∏–Ω–∞

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ü—Ä–∏ –≤—Ö–æ–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–¥–∏—Ä–µ–∫—Ç –≤ –ø–µ—Ä–≤—É—é –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é, –Ω–µ –¥–∞–≤–∞—è –≤—ã–±—Ä–∞—Ç—å –Ω—É–∂–Ω—É—é.

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ `app/auth-callback/page.tsx`: –ò–∑–º–µ–Ω—ë–Ω —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/orgs` (—Å–ø–∏—Å–æ–∫ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π) –≤–º–µ—Å—Ç–æ `/app/{firstOrg}/dashboard`
- ‚úÖ `app/orgs/page.tsx`: –£–±—Ä–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–¥–∏—Ä–µ–∫—Ç –ø—Ä–∏ –æ–¥–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ (—Å—Ç—Ä–æ–∫–∏ 99-101)

**–¢–µ–ø–µ—Ä—å:**
- –ü–æ—Å–ª–µ –ª–æ–≥–∏–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Å–µ–≥–¥–∞ –≤–∏–¥–∏—Ç —Å–ø–∏—Å–æ–∫ —Å–≤–æ–∏—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π
- –ú–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å –Ω—É–∂–Ω—É—é –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é
- –ö—Ä–∞—Å–∏–≤—ã–π UI —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –Ω–∞ "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ" (owner/admin) –∏ "–£—á–∞—Å—Ç–∏–µ" (member)

---

### 2. üêõ SQL –æ—à–∏–±–∫–∞ –≤ `sync_telegram_admins`

**–ü—Ä–æ–±–ª–µ–º–∞ –≤ –ª–æ–≥–∞—Ö:**
```
Error syncing org admins: {
  code: '42703',
  message: 'column otg.telegram_group_id does not exist'
}
```

**–ü—Ä–∏—á–∏–Ω–∞:**
–í –º–∏–≥—Ä–∞—Ü–∏–∏ `37_fix_sync_telegram_admins_ambiguous.sql` –Ω–∞ —Å—Ç—Ä–æ–∫–µ 21 –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–æ—Å—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏–º—è –∫–æ–ª–æ–Ω–∫–∏:
```sql
INNER JOIN org_telegram_groups otg ON otg.telegram_group_id = tg.id
```

–ù–æ –≤ —Ç–∞–±–ª–∏—Ü–µ `org_telegram_groups` (–º–∏–≥—Ä–∞—Ü–∏—è 05) –∫–æ–ª–æ–Ω–∫–∞ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è `tg_chat_id`:
```sql
create table org_telegram_groups (
  org_id uuid,
  tg_chat_id bigint,  -- ‚Üê –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏–º—è
  ...
)
```

**–†–µ—à–µ–Ω–∏–µ:**
–°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è `40_fix_sync_telegram_admins_column.sql`:
```sql
INNER JOIN org_telegram_groups otg ON otg.tg_chat_id = tg.tg_chat_id
```

---

## üìù –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é

### –í—Ä—É—á–Ω—É—é –≤ Supabase Dashboard:

1. –û—Ç–∫—Ä–æ–π—Ç–µ [Supabase Dashboard](https://supabase.com/dashboard) ‚Üí –≤–∞—à –ø—Ä–æ–µ–∫—Ç
2. **SQL Editor** ‚Üí **New query**
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `db/migrations/40_fix_sync_telegram_admins_column.sql`
4. –ù–∞–∂–º–∏—Ç–µ **Run**

### –ò–ª–∏ —á–µ—Ä–µ–∑ psql:

```bash
psql "postgresql://postgres.lyijgcnrwnwusvxzeiwv:[YOUR_PASSWORD]@aws-0-eu-central-1.pooler.supabase.com:6543/postgres" -f db/migrations/40_fix_sync_telegram_admins_column.sql
```

---

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–¥–∏—Ä–µ–∫—Ç:
1. –í—ã–π–¥–∏—Ç–µ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞ (–µ—Å–ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã)
2. –í–æ–π–¥–∏—Ç–µ —Å–Ω–æ–≤–∞ —á–µ—Ä–µ–∑ `/signin`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞ –≤—ã –≤–∏–¥–∏—Ç–µ **—Å–ø–∏—Å–æ–∫ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π** –Ω–∞ `/orgs`
4. –í—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—É—é –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å SQL –æ—à–∏–±–∫—É:
–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏ 40 –≤ –ª–æ–≥–∞—Ö Vercel –±–æ–ª—å—à–µ –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—à–∏–±–∫–∏:
```
Error syncing org admins: column otg.telegram_group_id does not exist
```

---

## üì¶ –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

```
üîß app/auth-callback/page.tsx       (—Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ /orgs)
üîß app/orgs/page.tsx                 (—É–±—Ä–∞–Ω –∞–≤—Ç–æ-—Ä–µ–¥–∏—Ä–µ–∫—Ç –¥–ª—è 1 –æ—Ä–≥)
‚ú® db/migrations/40_fix_sync_telegram_admins_column.sql
üìù docs/AUTH_REDIRECT_AND_SQL_FIX.md
```

---

## ‚úÖ –ò—Ç–æ–≥–æ

| –ü—Ä–æ–±–ª–µ–º–∞ | –†–µ—à–µ–Ω–∏–µ | –°—Ç–∞—Ç—É—Å |
|----------|---------|--------|
| –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–¥–∏—Ä–µ–∫—Ç –≤ –ø–µ—Ä–≤—É—é –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é | –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/orgs` –¥–ª—è –≤—ã–±–æ—Ä–∞ | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |
| –ê–≤—Ç–æ-—Ä–µ–¥–∏—Ä–µ–∫—Ç –ø—Ä–∏ 1 –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ | –£–±—Ä–∞–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å–ø–∏—Å–æ–∫ | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |
| SQL –æ—à–∏–±–∫–∞ `column otg.telegram_group_id does not exist` | –ú–∏–≥—Ä–∞—Ü–∏—è 40: `tg_chat_id` | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ (–Ω—É–∂–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å) |

---

**–ì–æ—Ç–æ–≤–æ!** üéâ –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏ –æ–±–µ –ø—Ä–æ–±–ª–µ–º—ã –±—É–¥—É—Ç —Ä–µ—à–µ–Ω—ã.

