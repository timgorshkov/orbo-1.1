# Orbo - Comprehensive Product Requirements Document

> **–í–µ—Ä—Å–∏—è:** 2.0  
> **–î–∞—Ç–∞:** 20 —è–Ω–≤–∞—Ä—è 2025  
> **–°—Ç–∞—Ç—É—Å:** –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ  
> **–ê–≤—Ç–æ—Ä:** Orbo Development Team

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞](#–æ–±–∑–æ—Ä-–ø—Ä–æ–µ–∫—Ç–∞)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-—Å–∏—Å—Ç–µ–º—ã)
3. [–ú–æ–¥—É–ª–∏ –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å](#–º–æ–¥—É–ª–∏-–∏-—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å)
4. [–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ä–æ–ª–∏ –∏ –ø—Ä–∞–≤–∞](#–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ-—Ä–æ–ª–∏-–∏-–ø—Ä–∞–≤–∞)
5. [–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö](#–±–∞–∑–∞-–¥–∞–Ω–Ω—ã—Ö)
6. [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏](#–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏)
7. [UI/UX](#uiux)
8. [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å](#–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
9. [–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ](#—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ)
10. [Roadmap](#roadmap)

---

## –û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞

### –¶–µ–ª—å

**Orbo** - –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–º–∏ –∏ –∫–æ–º–º—å—é–Ω–∏—Ç–∏-–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞–º–∏ —Å –≥–ª—É–±–æ–∫–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π —Å Telegram.

### –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üè¢ **–ú—É–ª—å—Ç–∏–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å** - –æ–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–æ—Å—Ç–æ—è—Ç—å –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è—Ö
- üí¨ **Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞, –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- üìö **–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π** - —Å–æ–∑–¥–∞–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—á–µ–±–Ω—ã–º–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏
- üìÖ **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è–º–∏** - —Å–æ–∑–¥–∞–Ω–∏–µ, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, ICS —Ñ–∞–π–ª—ã
- üë• **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏** - —É–º–Ω–æ–µ —Å–ª–∏—è–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤, —Ç–µ–Ω–µ–≤—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏
- üìä **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞** - –¥–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏ –≤–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç–∏
- üîê **–ì–∏–±–∫–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** - email, magic links, Telegram –∫–æ–¥—ã

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

**Frontend:**
- Next.js 14 (App Router)
- React 18
- TypeScript
- TailwindCSS
- Lucide Icons

**Backend:**
- Next.js API Routes
- Supabase (PostgreSQL + Auth + Storage)
- Vercel (Hosting + Edge Functions)

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:**
- Telegram Bot API (2 –±–æ—Ç–∞: main + notifications)
- Mailgun (Email service)

**–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
- Domain: `app.orbo.ru`
- Database: Supabase PostgreSQL
- Storage: Supabase Storage
- Deployment: Vercel (–∞–≤—Ç–æ–¥–µ–ø–ª–æ–π –∏–∑ Git)

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### –í—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        User Browser                          ‚îÇ
‚îÇ                    (app.orbo.ru)                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚îÇ
             ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     Next.js Frontend                         ‚îÇ
‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê        ‚îÇ
‚îÇ   ‚îÇ Public Pages‚îÇ  ‚îÇ Auth Pages  ‚îÇ  ‚îÇ App Shell   ‚îÇ        ‚îÇ
‚îÇ   ‚îÇ (/p/...)    ‚îÇ  ‚îÇ (/signin)   ‚îÇ  ‚îÇ (/app/...)  ‚îÇ        ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚îÇ
             ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   Next.js API Routes                         ‚îÇ
‚îÇ   /api/auth/...        /api/telegram/...                    ‚îÇ
‚îÇ   /api/events/...      /api/participants/...                ‚îÇ
‚îÇ   /api/organizations/...                                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚îÇ             ‚îÇ             ‚îÇ               ‚îÇ
    ‚ñº             ‚ñº             ‚ñº               ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Supabase ‚îÇ ‚îÇ Telegram ‚îÇ ‚îÇ Mailgun  ‚îÇ ‚îÇ Supabase     ‚îÇ
‚îÇ Auth     ‚îÇ ‚îÇ Bot API  ‚îÇ ‚îÇ API      ‚îÇ ‚îÇ Storage      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚îÇ
    ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  Supabase PostgreSQL                         ‚îÇ
‚îÇ   Organizations | Participants | Events | Materials          ‚îÇ
‚îÇ   Memberships | Telegram Groups | Analytics                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**Core Tables:**
- `organizations` - –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
- `memberships` - –ß–ª–µ–Ω—Å—Ç–≤–æ –≤ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è—Ö (roles)
- `participants` - –£—á–∞—Å—Ç–Ω–∏–∫–∏ (–∏–º–ø–æ—Ä—Ç –∏–∑ Telegram)

**Telegram:**
- `telegram_groups` - –ü–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–µ Telegram –≥—Ä—É–ø–ø—ã
- `org_telegram_groups` - Many-to-many —Å–≤—è–∑—å
- `user_telegram_accounts` - Telegram –∞–∫–∫–∞—É–Ω—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `telegram_group_admins` - –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –≥—Ä—É–ø–ø
- `telegram_auth_codes` - –ö–æ–¥—ã –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

**Content:**
- `events` - –°–æ–±—ã—Ç–∏—è
- `event_registrations` - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∞ —Å–æ–±—ã—Ç–∏—è
- `material_pages` - –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π (–∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∞—è)

**Analytics:**
- `activity_events` - –°–æ–±—ã—Ç–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- `group_metrics` - –ú–µ—Ç—Ä–∏–∫–∏ –≥—Ä—É–ø–ø (daily aggregates)
- `participant_groups` - –ü—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç—å –∫ –≥—Ä—É–ø–ø–∞–º

**Other:**
- `invitations` - –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
- `participant_merge_history` - –ò—Å—Ç–æ—Ä–∏—è —Å–ª–∏—è–Ω–∏–π

---

## –ú–æ–¥—É–ª–∏ –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### 1. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è

#### 1.1. Email –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

**–°—Ç—Ä–∞–Ω–∏—Ü—ã:**
- `/signin` - –í—Ö–æ–¥
- `/signup` - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è

**–ú–µ—Ç–æ–¥—ã:**
- Magic Link (passwordless)
- Email + Password

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç email
2. Supabase –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç magic link
3. –ö–ª–∏–∫ –ø–æ —Å—Å—ã–ª–∫–µ ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥
4. Redirect –Ω–∞ `/orgs` (–≤—ã–±–æ—Ä –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏)

**–ö–æ–¥:** `app/(auth)/signin/page.tsx`, `app/(auth)/signup/page.tsx`

#### 1.2. Telegram –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

**–î–ª—è –∫–æ–≥–æ:** –£—á–∞—Å—Ç–Ω–∏–∫–∏ Telegram –≥—Ä—É–ø–ø –±–µ–∑ email

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –£—á–∞—Å—Ç–Ω–∏–∫ –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É "–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Telegram"
2. –°–∏—Å—Ç–µ–º–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç Telegram User ID
3. –£—á–∞—Å—Ç–Ω–∏–∫ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `/start` –±–æ—Ç—É `@orbo_assistant_bot`
4. –ë–æ—Ç –ø—Ä–∏—Å—ã–ª–∞–µ—Ç –∫–æ–¥ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
5. –£—á–∞—Å—Ç–Ω–∏–∫ –≤–≤–æ–¥–∏—Ç –∫–æ–¥ ‚Üí –≤—Ö–æ–¥

**–ö–æ–¥:** `app/login/telegram/`, `lib/services/telegramAuthService.ts`

#### 1.3. –¢–µ–Ω–µ–≤—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏ (Shadow Profiles)

**–ß—Ç–æ —ç—Ç–æ:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –∏–∑ Telegram –∞–¥–º–∏–Ω–æ–≤ –±–µ–∑ email.

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
- ‚ùå –ù–µ—Ç email
- ‚úÖ –ï—Å—Ç—å Telegram –∞–∫–∫–∞—É–Ω—Ç
- ‚úÖ –ú–æ–≥—É—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç
- ‚ùå –ù–ï –º–æ–≥—É—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å (read-only)

**–ê–∫—Ç–∏–≤–∞—Ü–∏—è:**
- –î–æ–±–∞–≤–∏—Ç—å email –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø—Ä–æ—Ñ–∏–ª—è
- –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å email –∫–æ–¥–æ–º
- –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª–Ω—ã–µ –ø—Ä–∞–≤–∞

**–ö–æ–¥:** `db/migrations/46_sync_telegram_admins_with_shadow_profiles.sql`

### 2. –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏

#### 2.1. –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏

**–°—Ç—Ä–∞–Ω–∏—Ü–∞:** `/app/create-organization`

**–ü–æ–ª—è:**
- –ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- –õ–æ–≥–æ—Ç–∏–ø (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –∑–∞–≥—Ä—É–∑–∫–∞ –≤ Storage)

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø–æ–ª–Ω—è–µ—Ç —Ñ–æ—Ä–º—É
2. –°–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ `organizations`
3. –°–æ–∑–¥–∞–µ—Ç—Å—è `membership` —Å `role=owner`
4. Redirect –Ω–∞ `/app/[org]/dashboard`

**–ö–æ–¥:** `app/app/create-organization/page.tsx`

#### 2.2. –í—ã–±–æ—Ä –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏

**–°—Ç—Ä–∞–Ω–∏—Ü–∞:** `/orgs`

**–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ:**
- –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –†–æ–ª—å –≤ –∫–∞–∂–¥–æ–π (Owner/Admin/Member)
- –õ–æ–≥–æ—Ç–∏–ø –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏

**–ö–æ–¥:** `app/orgs/page.tsx`

#### 2.3. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏

**–°—Ç—Ä–∞–Ω–∏—Ü–∞:** `/app/[org]/settings`

**–î–æ—Å—Ç—É–ø–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**
- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–Ω–∞–∑–≤–∞–Ω–∏–µ, –ª–æ–≥–æ—Ç–∏–ø)
- –ö–æ–º–∞–Ω–¥–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ (–≤–ª–∞–¥–µ–ª–µ—Ü + –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã)
- –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è (–¥–ª—è –±—É–¥—É—â–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π)

**–ö–æ–¥:** `app/app/[org]/settings/page.tsx`

### 3. Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

#### 3.1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Telegram –≥—Ä—É–ø–ø

**–°—Ç—Ä–∞–Ω–∏—Ü–∞:** `/app/[org]/telegram`

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram –∞–∫–∫–∞—É–Ω—Ç–∞** (`/app/[org]/telegram/account`):
   - –í–≤–µ—Å—Ç–∏ Telegram User ID
   - –í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ –∫–æ–¥ –æ—Ç –±–æ—Ç–∞
   
2. **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≥—Ä—É–ø–ø:**
   - –í–∞—Ä–∏–∞–Ω—Ç A: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≥—Ä—É–ø–ø
   - –í–∞—Ä–∏–∞–Ω—Ç B: –†—É—á–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ Chat ID

3. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
   - –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ `org_telegram_groups`

**–ö–æ–¥:**
- `app/app/[org]/telegram/page.tsx`
- `app/app/[org]/telegram/account/page.tsx`
- `app/app/[org]/telegram/available-groups/page.tsx`

#### 3.2. Telegram –±–æ—Ç—ã

**–î–≤–∞ –±–æ—Ç–∞:**

**1. `orbo_community_bot` (Main Bot)**
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –≥—Ä—É–ø–ø–∞—Ö
- –ò–º–ø–æ—Ä—Ç —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- Webhook: `/api/telegram/webhook`

**2. `orbo_assistant_bot` (Notifications Bot)**
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (–æ—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–¥–æ–≤)
- –ü–æ–ª—É—á–µ–Ω–∏–µ User ID (`/start`)
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
- Webhook: `/api/telegram/notifications/webhook`

**–ö–æ–¥:**
- `lib/services/telegramService.ts`
- `lib/services/eventProcessingService.ts`

#### 3.3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –ë–æ—Ç –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –≥—Ä—É–ø–ø–µ (webhook)
2. `EventProcessingService` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ
3. –°–æ–∑–¥–∞–µ—Ç—Å—è/–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è `participant`
4. –°–æ–∑–¥–∞–µ—Ç—Å—è `activity_event`
5. –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è `participant_groups`

**–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è:**
- UPSERT –ø–æ `(org_id, tg_user_id)`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ `merged_into` (–¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã—Ö)
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `last_activity_at`

**–ö–æ–¥:**
- `lib/services/eventProcessingService.ts`
- `app/api/telegram/webhook/route.ts`

#### 3.4. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:**

**–¢—Ä–∏–≥–≥–µ—Ä—ã:**
1. –ö–Ω–æ–ø–∫–∞ "–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤" (`/app/[org]/telegram/account`)
2. –ö–Ω–æ–ø–∫–∞ "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å Telegram" (`/app/[org]/settings` ‚Üí –ö–æ–º–∞–Ω–¥–∞)

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. API –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —É Telegram Bot API —Å–ø–∏—Å–æ–∫ –∞–¥–º–∏–Ω–æ–≤ –≥—Ä—É–ø–ø—ã
2. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ `telegram_group_admins`
3. –í—ã–∑—ã–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é `sync_telegram_admins(org_id)`
4. –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–µ—Ç/–æ–±–Ω–æ–≤–ª—è–µ—Ç `memberships` —Å `role_source=telegram_admin`

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–µ–Ω–µ–≤—ã—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π (–µ—Å–ª–∏ –Ω–µ—Ç email)
- –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è 7 –¥–Ω–µ–π (`expires_at`)
- –ù–µ –ø–æ–Ω–∏–∂–∞–µ—Ç –≤–ª–∞–¥–µ–ª—å—Ü–∞ –¥–æ –∞–¥–º–∏–Ω–∞

**–ö–æ–¥:**
- `app/api/telegram/groups/update-admins/route.ts`
- `db/migrations/46_sync_telegram_admins_with_shadow_profiles.sql`

### 4. –£—á–∞—Å—Ç–Ω–∏–∫–∏ (Participants)

#### 4.1. –ò–º–ø–æ—Ä—Ç –∏–∑ Telegram

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π:**
- –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –≥—Ä—É–ø–ø–µ
- –°–æ–∑–¥–∞–µ—Ç—Å—è `participant` —Å –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ Telegram
- `source = 'telegram'`
- `tg_user_id`, `username`, `first_name`, `last_name`

**–†—É—á–Ω–æ–π:**
- –°–æ–∑–¥–∞–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞ —á–µ—Ä–µ–∑ UI (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)

#### 4.2. –ü—Ä–æ—Ñ–∏–ª–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤

**–°—Ç—Ä–∞–Ω–∏—Ü–∞:** `/app/[org]/members` ‚Üí –∫–ª–∏–∫ –Ω–∞ —É—á–∞—Å—Ç–Ω–∏–∫–∞

**–ü–æ–ª—è:**
- –§–æ—Ç–æ (–∑–∞–≥—Ä—É–∑–∫–∞ –∏–ª–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å Telegram)
- –ü–æ–ª–Ω–æ–µ –∏–º—è
- –ò–º—è, –§–∞–º–∏–ª–∏—è
- Email (–µ—Å–ª–∏ –µ—Å—Ç—å)
- –¢–µ–ª–µ—Ñ–æ–Ω (–µ—Å–ª–∏ –µ—Å—Ç—å)
- Username (Telegram)
- –ë–∏–æ (–æ–ø–∏—Å–∞–Ω–∏–µ)
- Custom attributes (–ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–µ –ø–æ–ª—è JSON)
- –°—Ç–∞—Ç—É—Å (active/inactive)
- –ò—Å—Ç–æ—á–Ω–∏–∫ (telegram/manual)
- –ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

**–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∞–º –∏ –≤–ª–∞–¥–µ–ª—å—Ü—É
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `PATCH /api/participants/[id]`

**–ö–æ–¥:**
- `app/app/[org]/members/page.tsx`
- `components/members/member-card.tsx`
- `components/members/members-table.tsx`

#### 4.3. –£–º–Ω–æ–µ —Å–ª–∏—è–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:** –û–¥–∏–Ω —á–µ–ª–æ–≤–µ–∫ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ (—Ä–∞–∑–Ω—ã–µ Telegram ID, email, —Ç–µ–ª–µ—Ñ–æ–Ω).

**–†–µ—à–µ–Ω–∏–µ:**

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
1. **–¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ:**
   - –û–¥–∏–Ω–∞–∫–æ–≤—ã–π `email`
   - –û–¥–∏–Ω–∞–∫–æ–≤—ã–π `phone`
   - –û–¥–∏–Ω–∞–∫–æ–≤—ã–π `tg_user_id`

2. **Fuzzy matching:**
   - –ü–æ—Ö–æ–∂–∏–µ –∏–º–µ–Ω–∞ (Levenshtein distance)
   - –°—Ö–æ–∂–∏–µ username

**UI:**
- –°—Ç—Ä–∞–Ω–∏—Ü–∞ `/app/[org]/members/duplicates`
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –¥—É–±–ª–∏–∫–∞—Ç—ã
- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö –æ–±–æ–∏—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
- –í—ã–±–æ—Ä –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è
- –ö–Ω–æ–ø–∫–∞ "–û–±—ä–µ–¥–∏–Ω–∏—Ç—å"

**–ü—Ä–æ—Ü–µ—Å—Å —Å–ª–∏—è–Ω–∏—è:**
1. –ü–µ—Ä–µ–Ω–æ—Å—è—Ç—Å—è –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –≤—Ç–æ—Ä–∏—á–Ω–æ–≥–æ –≤ –æ—Å–Ω–æ–≤–Ω–æ–π
2. –û–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤—Å–µ —Å–≤—è–∑–∏ (event_registrations, activity_events)
3. –í—Ç–æ—Ä–∏—á–Ω—ã–π –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ `merged_into = primary_id`
4. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `participant_merge_history`

**–ö–æ–¥:**
- `app/app/[org]/members/duplicates/page.tsx`
- `lib/services/participants/matcher.ts`
- `lib/services/participants/merger.ts`

#### 4.4. –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤

**–ò—Å—Ç–æ—á–Ω–∏–∫–∏:**
1. **Telegram:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Bot API
2. **–†—É—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞:** –ß–µ—Ä–µ–∑ UI (Storage bucket)

**–ü—Ä–æ—Ü–µ—Å—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å Telegram:**
1. API –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç `getUserProfilePhotos(tg_user_id)`
2. –°–∫–∞—á–∏–≤–∞–µ—Ç —Ñ–∞–π–ª —á–µ—Ä–µ–∑ `getFile()` + `downloadFile()`
3. –ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤ Supabase Storage (`participant-photos/`)
4. –û–±–Ω–æ–≤–ª—è–µ—Ç `photo_url` –≤ `participants`

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:**
- –†—É—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ > Telegram —Ñ–æ—Ç–æ
- –ù–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Ä—É—á–Ω—ã–µ —Ñ–æ—Ç–æ

**–ö–æ–¥:**
- `app/api/participants/[participantId]/sync-telegram-photo/route.ts`
- `lib/hooks/useTelegramPhoto.ts`
- `components/members/participant-avatar.tsx`

### 5. –°–æ–±—ã—Ç–∏—è (Events)

#### 5.1. –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π

**–°—Ç—Ä–∞–Ω–∏—Ü–∞:** `/app/[org]/events` ‚Üí "–°–æ–∑–¥–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ"

**–ü–æ–ª—è:**
- –ù–∞–∑–≤–∞–Ω–∏–µ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- –û–ø–∏—Å–∞–Ω–∏–µ (Markdown + HTML –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä)
- –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞
- –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –õ–æ–∫–∞—Ü–∏—è (—Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ)
- –ú–∞–∫—Å–∏–º—É–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- Visibility (–ø—É–±–ª–∏—á–Ω–æ–µ/–¥–ª—è —á–ª–µ–Ω–æ–≤ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏)

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã
2. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ `events`
3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ `share_token`
4. Redirect –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–æ–±—ã—Ç–∏—è

**–ö–æ–¥:** `app/app/[org]/events/create/page.tsx`

#### 5.2. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ —Å–æ–±—ã—Ç–∏—è

**–î–ª—è —á–ª–µ–Ω–æ–≤ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏:**
- –°—Ç—Ä–∞–Ω–∏—Ü–∞: `/app/[org]/events/[id]`
- –ö–Ω–æ–ø–∫–∞ "–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è"
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–∏–≤—è–∑–∫–∞ –∫ `participant` (–µ—Å–ª–∏ –µ—Å—Ç—å Telegram)

**–î–ª—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞:**
- –°—Ç—Ä–∞–Ω–∏—Ü–∞: `/p/[org]/events/[id]`
- Share token –≤ URL
- –§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (email, –∏–º—è, —Ç–µ–ª–µ—Ñ–æ–Ω)
- –°–æ–∑–¥–∞–µ—Ç—Å—è `participant` –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –ü—Ä–æ–≤–µ—Ä–∫–∞, –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –ª–∏ —É–∂–µ
2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
3. –°–æ–∑–¥–∞–Ω–∏–µ `event_registration`
4. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è ICS —Ñ–∞–π–ª–∞
5. –û—Ç–ø—Ä–∞–≤–∫–∞ email —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–ö–æ–¥:**
- `app/app/[org]/events/[id]/page.tsx`
- `app/p/[org]/events/[id]/page.tsx`
- `components/events/event-detail.tsx`
- `components/events/public-event-detail.tsx`

#### 5.3. ICS —Ñ–∞–π–ª—ã (–∫–∞–ª–µ–Ω–¥–∞—Ä—å)

**–ì–µ–Ω–µ—Ä–∞—Ü–∏—è:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- –ö–Ω–æ–ø–∫–∞ "–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä—å"

**–§–æ—Ä–º–∞—Ç:** RFC 5545 (iCalendar)

**–ü–æ–ª—è:**
- VEVENT
- SUMMARY (–Ω–∞–∑–≤–∞–Ω–∏–µ)
- DESCRIPTION (–æ–ø–∏—Å–∞–Ω–∏–µ)
- DTSTART/DTEND (–≤—Ä–µ–º—è)
- LOCATION (–ª–æ–∫–∞—Ü–∏—è)
- UID (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID)

**–ö–æ–¥:** `app/api/events/[id]/ics/route.ts`

### 6. –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π (Materials)

#### 6.1. –ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

**–ú–æ–¥–µ–ª—å:**
- –î—Ä–µ–≤–æ–≤–∏–¥–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (parent_id)
- Unlimited nesting
- Position –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
- Slug –¥–ª—è URL

**–ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:**
```
üìÅ –ö—É—Ä—Å React
  üìÑ –í–≤–µ–¥–µ–Ω–∏–µ
  üìÅ –û—Å–Ω–æ–≤—ã
    üìÑ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
    üìÑ Props –∏ State
  üìÅ –•—É–∫–∏
    üìÑ useState
    üìÑ useEffect
```

**–ö–æ–¥:** `db/schema` - —Ç–∞–±–ª–∏—Ü–∞ `material_pages`

#### 6.2. –†–µ–¥–∞–∫—Ç–æ—Ä –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤

**–°—Ç—Ä–∞–Ω–∏—Ü–∞:** `/app/[org]/materials/[slug]/edit`

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- **Markdown —Ä–µ–¥–∞–∫—Ç–æ—Ä** —Å –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–æ–º
- **HTML —Ä–µ–∂–∏–º** (–¥–ª—è –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö)
- **–í—Å—Ç–∞–≤–∫–∞ –º–µ–¥–∏–∞:**
  - YouTube –≤–∏–¥–µ–æ (embed)
  - VK –≤–∏–¥–µ–æ (embed)
  - –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
- **–î–µ—Ä–µ–≤–æ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤** —Å–ª–µ–≤–∞ (navigation tree)
- **Autosave** (–∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥)

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Markdown
2. –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ HTML (–¥–ª—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞)
3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ–±–æ–∏—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ (`content_md`, `content_html`)
4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `updated_at`

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ï—Å–ª–∏ –≤–∏–¥–µ–æ –≤—Å—Ç–∞–≤–ª–µ–Ω–æ –±–µ–∑ title ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π placeholder
- –ü–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è title –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ –¥–µ—Ä–µ–≤–µ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏

**–ö–æ–¥:**
- `components/materials/materials-page-editor.tsx`
- `components/materials/materials-page-viewer.tsx`

#### 6.3. –ü—Ä–æ—Å–º–æ—Ç—Ä –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤

**–î–ª—è —á–ª–µ–Ω–æ–≤:** `/app/[org]/materials/[slug]`

**–î–ª—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞:** `/p/[org]/materials/[slug]` (–µ—Å–ª–∏ `visibility=public`)

**–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ:**
- Rendered HTML
- Navigation tree —Å–ª–µ–≤–∞
- Breadcrumbs
- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (–∞–≤—Ç–æ—Ä, –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è)

**–ö–æ–¥:**
- `app/app/[org]/materials/[slug]/page.tsx`
- `app/p/[org]/materials/[slug]/page.tsx`

### 7. –ê–Ω–∞–ª–∏—Ç–∏–∫–∞

#### 7.1. Dashboard

**–°—Ç—Ä–∞–Ω–∏—Ü–∞:** `/app/[org]/dashboard`

**–í–∏–¥–∂–µ—Ç—ã:**

**1. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤:**
- –í—Å–µ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
- –ù–æ–≤—ã–µ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π
- –£—à–µ–¥—à–∏–µ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π

**2. Activity –∑–∞ 14 –¥–Ω–µ–π:**
- –ì—Ä–∞—Ñ–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ –¥–Ω—è–º
- –î–∞–Ω–Ω—ã–µ –∏–∑ `group_metrics` (aggregated)

**3. –ó–æ–Ω—ã –≤–Ω–∏–º–∞–Ω–∏—è:**
- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–±—ã—Ç–∏—è (< 5 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤)
- –£—Ö–æ–¥—è—â–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ (–Ω–µ–∞–∫—Ç–∏–≤–Ω—ã > 30 –¥–Ω–µ–π)
- –ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –Ω–æ–≤–∏—á–∫–∏ (–ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª–∏—Å—å –Ω–µ–¥–∞–≤–Ω–æ, –Ω–æ —Ç–∏—Ö–∏–µ)

**4. –ü—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ —Å–æ–±—ã—Ç–∏—è:**
- –°–ø–∏—Å–æ–∫ –±–ª–∏–∂–∞–π—à–∏—Ö —Å–æ–±—ã—Ç–∏–π
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö

**–ö–æ–¥:**
- `app/app/[org]/dashboard/page.tsx`
- `app/api/dashboard/[orgId]/route.ts`
- `components/dashboard/activity-chart.tsx`
- `components/dashboard/attention-zones.tsx`

#### 7.2. –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –≥—Ä—É–ø–ø—ã

**–°—Ç—Ä–∞–Ω–∏—Ü–∞:** `/app/[org]/telegram/groups/[groupId]`

**–í–∫–ª–∞–¥–∫–∏:**

**1. –û–±–∑–æ—Ä:**
- –ù–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã
- –¢–∏–ø (–≥—Ä—É–ø–ø–∞/—Å—É–ø–µ—Ä–≥—Ä—É–ø–ø–∞/–∫–∞–Ω–∞–ª)
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
- –°—Ç–∞—Ç—É—Å –±–æ—Ç–∞

**2. –ê–Ω–∞–ª–∏—Ç–∏–∫–∞:**
- –ì—Ä–∞—Ñ–∏–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (—Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ –¥–Ω—è–º)
- Top —É—á–∞—Å—Ç–Ω–∏–∫–∏ –ø–æ —Å–æ–æ–±—â–µ–Ω–∏—è–º
- –î–∏–Ω–∞–º–∏–∫–∞ —Ä–æ—Å—Ç–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤

**3. –£—á–∞—Å—Ç–Ω–∏–∫–∏ –≥—Ä—É–ø–ø—ã:**
- –¢–∞–±–ª–∏—Ü–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
- –§–∏–ª—å—Ç—Ä—ã (–∞–∫—Ç–∏–≤–Ω—ã–µ/–Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ)
- –°—Ç–∞—Ç—É—Å –∞–¥–º–∏–Ω–∞ (–∏–∫–æ–Ω–∫–∞)
- –ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

**4. –ù–∞—Å—Ç—Ä–æ–π–∫–∏:**
- –û—Ç–∫–ª—é—á–∏—Ç—å/–ø–æ–¥–∫–ª—é—á–∏—Ç—å –≥—Ä—É–ø–ø—É
- –£–¥–∞–ª–∏—Ç—å –≥—Ä—É–ø–ø—É –∏–∑ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏

**–ö–æ–¥:**
- `app/app/[org]/telegram/groups/[groupId]/page.tsx`
- `app/api/telegram/analytics/data/route.ts`

#### 7.3. –ú–µ—Ç—Ä–∏–∫–∏ –≥—Ä—É–ø–ø

**–¢–∞–±–ª–∏—Ü–∞:** `group_metrics`

**Aggregation:** Daily (–∫–∞–∂–¥—ã–π –¥–µ–Ω—å = 1 –∑–∞–ø–∏—Å—å –Ω–∞ –≥—Ä—É–ø–ø—É)

**–ü–æ–ª—è:**
- `date` (–¥–∞—Ç–∞)
- `tg_chat_id` (ID –≥—Ä—É–ø–ø—ã)
- `org_id` (–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è)
- `message_count` (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π)
- `active_users` (—É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª–∏)
- `new_members` (–Ω–æ–≤—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏)
- `left_members` (—É—à–µ–¥—à–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏)

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. Webhook –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ
2. `EventProcessingService` —Å–æ–∑–¥–∞–µ—Ç `activity_event`
3. –¢—Ä–∏–≥–≥–µ—Ä –∏–ª–∏ Cron Job –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç –≤ `group_metrics`

**–ö–æ–¥:** `db/schema`, —Ç—Ä–∏–≥–≥–µ—Ä—ã PostgreSQL

### 8. –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### 8.1. –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ—Ñ–∏–ª—è

**–°—Ç—Ä–∞–Ω–∏—Ü–∞:** `/app/[org]/profile`

**–°–µ–∫—Ü–∏–∏:**

**1. –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:**
- –ê–≤–∞—Ç–∞—Ä–∫–∞ (–∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ Telegram)
- –ò–º—è, email, —Ä–æ–ª—å
- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–º–µ–Ω–∏ –∏ –±–∏–æ
- –°–ø–∏—Å–æ–∫ –≥—Ä—É–ø–ø –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è (–µ—Å–ª–∏ –∞–¥–º–∏–Ω)

**2. Email –∞–∫–∫–∞—É–Ω—Ç:**
- –°—Ç–∞—Ç—É—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- –î–ª—è —Ç–µ–Ω–µ–≤—ã—Ö: —Ñ–æ—Ä–º–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ (–¥–æ–±–∞–≤–∏—Ç—å email)

**3. Telegram –∞–∫–∫–∞—É–Ω—Ç:**
- Username, User ID
- –°—Ç–∞—Ç—É—Å –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –ü—Ä–∏–≤—è–∑–∫–∞/–æ—Ç–≤—è–∑–∫–∞ Telegram

**4. –ö–Ω–æ–ø–∫–∞ "–í—ã–π—Ç–∏":**
- –í —Ö–µ–¥–µ—Ä–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (—Å–ø—Ä–∞–≤–∞ –æ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞)

**–ö–æ–¥:**
- `app/app/[org]/profile/page.tsx`
- `app/api/user/profile/route.ts`

#### 8.2. –ü—Ä–æ—Ñ–∏–ª—å –≤ –º–µ–Ω—é

**–ó–∞–º–µ–Ω–∞ –∫–Ω–æ–ø–∫–∏ "–í—ã–π—Ç–∏":**
- –í–º–µ—Å—Ç–æ –∫–Ω–æ–ø–∫–∏ "–í—ã–π—Ç–∏" ‚Üí –∞–≤–∞—Ç–∞—Ä–∫–∞ + –∏–º—è
- –ö–ª–∏–∫ ‚Üí –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ `/app/[org]/profile`

**–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ:**
- **Collapsed:** –ö—Ä—É–≥–ª–∞—è –∞–≤–∞—Ç–∞—Ä–∫–∞
- **Expanded:** –ê–≤–∞—Ç–∞—Ä–∫–∞ + –∏–º—è + email

**–ö–æ–¥:**
- `components/navigation/collapsible-sidebar.tsx`
- `app/app/[org]/layout.tsx`

### 9. –ö–æ–º–∞–Ω–¥–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏

#### 9.1. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥–æ–π

**–°—Ç—Ä–∞–Ω–∏—Ü–∞:** `/app/[org]/settings` ‚Üí –ö–æ–º–∞–Ω–¥–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏

**–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ:**

**–í–ª–∞–¥–µ–ª–µ—Ü:**
- üëë –ò–∫–æ–Ω–∫–∞ –∫–æ—Ä–æ–Ω—ã
- –§–∏–æ–ª–µ—Ç–æ–≤—ã–π —Ñ–æ–Ω
- Email –∏ —Å—Ç–∞—Ç—É—Å
- Telegram –¥–∞–Ω–Ω—ã–µ (–µ—Å–ª–∏ –ø—Ä–∏–≤—è–∑–∞–Ω)

**–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã:**
- üë®‚Äçüíº –ë–µ–π–¥–∂ "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä"
- üëª –ë–µ–π–¥–∂ "–¢–µ–Ω–µ–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å" (–µ—Å–ª–∏ –Ω–µ—Ç email)
- üîó –ë–µ–π–¥–∂ "–ò–∑ Telegram" (–∞–≤—Ç–æ–¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ)
- Email –∏ —Å—Ç–∞—Ç—É—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- Telegram username –∏ —Å—Ç–∞—Ç—É—Å –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –°–ø–∏—Å–æ–∫ –≥—Ä—É–ø–ø, –≥–¥–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
- –î–∞—Ç–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

**–ö–æ–¥:** `components/settings/organization-team.tsx`

#### 9.2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

**–î–≤–∞ —Å–ø–æ—Å–æ–±–∞:**

**1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑ Telegram:**
- –ù–∞–∑–Ω–∞—á–∏—Ç—å –∞–¥–º–∏–Ω–æ–º –≤ Telegram –≥—Ä—É–ø–ø–µ
- –ù–∞–∂–∞—Ç—å "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å Telegram"
- –ê–¥–º–∏–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è

**2. –í—Ä—É—á–Ω—É—é –ø–æ email:**
- –ö–Ω–æ–ø–∫–∞ "–î–æ–±–∞–≤–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞"
- –í–≤–µ—Å—Ç–∏ email
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ
- –°–æ–∑–¥–∞–µ—Ç—Å—è `invitation`

**–ö–æ–¥:**
- `components/settings/add-admin-dialog.tsx`
- `app/api/organizations/[id]/team/add/route.ts`

#### 9.3. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å Telegram

**–ö–Ω–æ–ø–∫–∞:** "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å Telegram"

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –í—ã–∑—ã–≤–∞–µ—Ç `POST /api/organizations/[id]/team`
2. API –≤—ã–∑—ã–≤–∞–µ—Ç RPC `sync_telegram_admins(org_id)`
3. –§—É–Ω–∫—Ü–∏—è –∏—â–µ—Ç –≤—Å–µ—Ö –∞–¥–º–∏–Ω–æ–≤ –≤ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö –≥—Ä—É–ø–ø–∞—Ö
4. –°–æ–∑–¥–∞–µ—Ç/–æ–±–Ω–æ–≤–ª—è–µ—Ç `memberships`
5. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π

**–ö–æ–¥:**
- `app/api/organizations/[id]/team/route.ts`
- `db/migrations/46_sync_telegram_admins_with_shadow_profiles.sql`

---

## –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ä–æ–ª–∏ –∏ –ø—Ä–∞–≤–∞

### –†–æ–ª–∏

#### 1. Owner (–í–ª–∞–¥–µ–ª–µ—Ü)

**–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏

**–ü—Ä–∞–≤–∞:**
- ‚úÖ –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –∏ —Å–æ–±—ã—Ç–∏–π
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- –û–¥–∏–Ω –≤–ª–∞–¥–µ–ª–µ—Ü –Ω–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é
- –ù–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–Ω–∏–∂–µ–Ω –¥–æ –∞–¥–º–∏–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

#### 2. Admin (–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)

**–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å:**
- –î–æ–±–∞–≤–ª–µ–Ω –≤–ª–∞–¥–µ–ª—å—Ü–µ–º –≤—Ä—É—á–Ω—É—é (–ø–æ email)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑ Telegram (role_source=telegram_admin)

**–ü—Ä–∞–≤–∞:**
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –∏ —Å–æ–±—ã—Ç–∏–π
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏
- ‚ùå –ù–ï –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
- ‚ùå –ù–ï –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å/—É–¥–∞–ª—è—Ç—å –¥—Ä—É–≥–∏—Ö –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

**–¢–µ–Ω–µ–≤–æ–π –∞–¥–º–∏–Ω (–±–µ–∑ email):**
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- ‚ùå –ù–ï –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å (read-only)
- –ú–æ–∂–µ—Ç –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å, –¥–æ–±–∞–≤–∏–≤ email

#### 3. Member (–£—á–∞—Å—Ç–Ω–∏–∫)

**–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –∏–∑ Telegram –≥—Ä—É–ø–ø—ã
- –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –Ω–∞ —Å–æ–±—ã—Ç–∏–µ

**–ü—Ä–∞–≤–∞:**
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ (public + org_members)
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–æ–±—ã—Ç–∏–π
- ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ —Å–æ–±—ã—Ç–∏—è
- ‚ùå –ù–ï –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç
- ‚ùå –ù–ï –º–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É

#### 4. Guest (–ì–æ—Å—Ç—å)

**–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å:**
- –û—Ç–∫—Ä—ã–ª –ø—É–±–ª–∏—á–Ω—É—é —Å—Å—ã–ª–∫—É (`/p/[org]/...`)

**–ü—Ä–∞–≤–∞:**
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä –ø—É–±–ª–∏—á–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ (visibility=public)
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä –ø—É–±–ª–∏—á–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π
- ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ –ø—É–±–ª–∏—á–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
- ‚ùå –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –∑–∞–∫—Ä—ã—Ç—ã–º —Ä–∞–∑–¥–µ–ª–∞–º

### –ú–∞—Ç—Ä–∏—Ü–∞ –ø—Ä–∞–≤

| –§—É–Ω–∫—Ü–∏—è | Owner | Admin | Shadow Admin | Member | Guest |
|---------|-------|-------|--------------|--------|-------|
| –ü—Ä–æ—Å–º–æ—Ç—Ä –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ (public) | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |
| –ü—Ä–æ—Å–º–æ—Ç—Ä –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ (org) | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå |
| –°–æ–∑–¥–∞–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå | ‚ùå |
| –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå | ‚ùå |
| –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–æ–±—ã—Ç–∏–π | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ* |
| –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå | ‚ùå |
| –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ —Å–æ–±—ã—Ç–∏—è | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ* |
| –ü—Ä–æ—Å–º–æ—Ç—Ä —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå |
| –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå | ‚ùå |
| –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå |
| –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ | ‚úÖ | ‚ùå | ‚ùå | ‚ùå | ‚ùå |
| –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥–æ–π | ‚úÖ | ‚ùå | ‚ùå | ‚ùå | ‚ùå |
| Telegram –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ | ‚úÖ | ‚ùå | ‚ùå | ‚ùå | ‚ùå |

*–¢–æ–ª—å–∫–æ –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π

---

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –°—Ö–µ–º–∞ –ë–î

#### Core Tables

**`organizations`**
```sql
id UUID PRIMARY KEY
name TEXT NOT NULL
logo_url TEXT
created_at TIMESTAMPTZ
updated_at TIMESTAMPTZ
```

**`memberships`**
```sql
org_id UUID REFERENCES organizations
user_id UUID REFERENCES auth.users
role TEXT (owner/admin/member)
role_source TEXT (manual/telegram_admin/invitation)
metadata JSONB (telegram_groups, shadow_profile, etc)
created_at TIMESTAMPTZ
PRIMARY KEY (org_id, user_id)
```

**`participants`**
```sql
id UUID PRIMARY KEY
org_id UUID REFERENCES organizations
tg_user_id BIGINT (Telegram User ID)
username TEXT
first_name TEXT
last_name TEXT
full_name TEXT
email TEXT
phone TEXT
photo_url TEXT
bio TEXT
custom_attributes JSONB
status TEXT (active/inactive)
source TEXT (telegram/manual)
merged_into UUID REFERENCES participants
last_activity_at TIMESTAMPTZ
created_at TIMESTAMPTZ
updated_at TIMESTAMPTZ
UNIQUE (org_id, tg_user_id)
UNIQUE (org_id, email) WHERE email IS NOT NULL
```

#### Telegram Tables

**`telegram_groups`**
```sql
id SERIAL PRIMARY KEY
tg_chat_id BIGINT UNIQUE NOT NULL
title TEXT
type TEXT (group/supergroup/channel)
bot_status TEXT
verified_by_user_id UUID
created_at TIMESTAMPTZ
```

**`org_telegram_groups`** (Many-to-Many)
```sql
org_id UUID REFERENCES organizations
tg_chat_id BIGINT REFERENCES telegram_groups
added_by_user_id UUID REFERENCES auth.users
created_at TIMESTAMPTZ
PRIMARY KEY (org_id, tg_chat_id)
```

**`user_telegram_accounts`**
```sql
id UUID PRIMARY KEY
user_id UUID REFERENCES auth.users
org_id UUID REFERENCES organizations
telegram_user_id BIGINT NOT NULL
telegram_username TEXT
telegram_first_name TEXT
telegram_last_name TEXT
is_verified BOOLEAN DEFAULT FALSE
verified_at TIMESTAMPTZ
created_at TIMESTAMPTZ
UNIQUE (user_id, org_id)
UNIQUE (telegram_user_id, org_id)
```

**`telegram_group_admins`**
```sql
tg_chat_id BIGINT NOT NULL
tg_user_id BIGINT NOT NULL
user_telegram_account_id UUID REFERENCES user_telegram_accounts
is_owner BOOLEAN DEFAULT FALSE
is_admin BOOLEAN DEFAULT TRUE
custom_title TEXT
can_manage_chat BOOLEAN
can_delete_messages BOOLEAN
can_manage_video_chats BOOLEAN
can_restrict_members BOOLEAN
can_promote_members BOOLEAN
can_change_info BOOLEAN
can_invite_users BOOLEAN
can_pin_messages BOOLEAN
can_post_messages BOOLEAN
can_edit_messages BOOLEAN
verified_at TIMESTAMPTZ
expires_at TIMESTAMPTZ (7 days from verified_at)
created_at TIMESTAMPTZ
updated_at TIMESTAMPTZ
PRIMARY KEY (tg_chat_id, tg_user_id)
```

**`telegram_auth_codes`**
```sql
id SERIAL PRIMARY KEY
code TEXT UNIQUE NOT NULL
telegram_user_id BIGINT NOT NULL
user_id UUID REFERENCES auth.users
org_id UUID REFERENCES organizations
is_used BOOLEAN DEFAULT FALSE
used_at TIMESTAMPTZ
expires_at TIMESTAMPTZ
created_at TIMESTAMPTZ
```

#### Content Tables

**`events`**
```sql
id UUID PRIMARY KEY
org_id UUID REFERENCES organizations
title TEXT NOT NULL
description TEXT
start_at TIMESTAMPTZ NOT NULL
duration_minutes INTEGER
location TEXT
max_participants INTEGER
visibility TEXT (public/org_members)
share_token TEXT UNIQUE
created_by UUID REFERENCES auth.users
created_at TIMESTAMPTZ
updated_at TIMESTAMPTZ
```

**`event_registrations`**
```sql
id UUID PRIMARY KEY
event_id UUID REFERENCES events
participant_id UUID REFERENCES participants
registered_at TIMESTAMPTZ
UNIQUE (event_id, participant_id)
```

**`material_pages`**
```sql
id UUID PRIMARY KEY
org_id UUID REFERENCES organizations
parent_id UUID REFERENCES material_pages
title TEXT NOT NULL
slug TEXT NOT NULL
content_md TEXT (Markdown)
content_html TEXT (HTML)
visibility TEXT (public/org_members/admins)
is_published BOOLEAN DEFAULT TRUE
position INTEGER
created_by UUID REFERENCES auth.users
created_at TIMESTAMPTZ
updated_at TIMESTAMPTZ
UNIQUE (org_id, slug)
```

#### Analytics Tables

**`activity_events`**
```sql
id UUID PRIMARY KEY
org_id UUID REFERENCES organizations
participant_id UUID REFERENCES participants
tg_chat_id BIGINT
event_type TEXT (message/join/leave/etc)
metadata JSONB
created_at TIMESTAMPTZ
```

**`group_metrics`**
```sql
id SERIAL PRIMARY KEY
date DATE NOT NULL
tg_chat_id BIGINT NOT NULL
org_id UUID REFERENCES organizations
message_count INTEGER DEFAULT 0
active_users INTEGER DEFAULT 0
new_members INTEGER DEFAULT 0
left_members INTEGER DEFAULT 0
created_at TIMESTAMPTZ
UNIQUE (date, tg_chat_id, org_id)
```

**`participant_groups`**
```sql
participant_id UUID REFERENCES participants
tg_chat_id BIGINT
org_id UUID REFERENCES organizations
joined_at TIMESTAMPTZ
left_at TIMESTAMPTZ
is_active BOOLEAN DEFAULT TRUE
last_activity_at TIMESTAMPTZ
PRIMARY KEY (participant_id, tg_chat_id, org_id)
```

#### Other Tables

**`invitations`**
```sql
id UUID PRIMARY KEY
org_id UUID REFERENCES organizations
email TEXT NOT NULL
role TEXT (admin)
invited_by UUID REFERENCES auth.users
status TEXT (pending/accepted/expired)
token TEXT UNIQUE
expires_at TIMESTAMPTZ
created_at TIMESTAMPTZ
```

**`participant_merge_history`**
```sql
id UUID PRIMARY KEY
org_id UUID REFERENCES organizations
primary_participant_id UUID REFERENCES participants
secondary_participant_id UUID
merged_by UUID REFERENCES auth.users
merged_at TIMESTAMPTZ
merged_data JSONB (snapshot of secondary)
```

### RLS Policies

**Row Level Security** –≤–∫–ª—é—á–µ–Ω –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü.

**–ü—Ä–∏–º–µ—Ä—ã –ø–æ–ª–∏—Ç–∏–∫:**

**organizations:**
- SELECT: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç membership
- INSERT: authenticated users
- UPDATE: owner –∏–ª–∏ admin
- DELETE: —Ç–æ–ª—å–∫–æ owner

**participants:**
- SELECT: —á–ª–µ–Ω –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
- INSERT: admin –∏–ª–∏ owner
- UPDATE: admin –∏–ª–∏ owner
- DELETE: —Ç–æ–ª—å–∫–æ owner

**events:**
- SELECT: public –∏–ª–∏ —á–ª–µ–Ω –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
- INSERT: admin –∏–ª–∏ owner
- UPDATE: admin –∏–ª–∏ owner (–∏–ª–∏ —Å–æ–∑–¥–∞—Ç–µ–ª—å)
- DELETE: admin –∏–ª–∏ owner (–∏–ª–∏ —Å–æ–∑–¥–∞—Ç–µ–ª—å)

**material_pages:**
- SELECT: public –∏–ª–∏ —á–ª–µ–Ω –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
- INSERT: admin –∏–ª–∏ owner
- UPDATE: admin –∏–ª–∏ owner (–∏–ª–∏ —Å–æ–∑–¥–∞—Ç–µ–ª—å)
- DELETE: admin –∏–ª–∏ owner (–∏–ª–∏ —Å–æ–∑–¥–∞—Ç–µ–ª—å)

### –ò–Ω–¥–µ–∫—Å—ã

**Performance indexes:**
```sql
CREATE INDEX idx_participants_org_tg ON participants(org_id, tg_user_id);
CREATE INDEX idx_participants_org_email ON participants(org_id, email) WHERE email IS NOT NULL;
CREATE INDEX idx_memberships_user ON memberships(user_id);
CREATE INDEX idx_activity_events_org_date ON activity_events(org_id, created_at);
CREATE INDEX idx_group_metrics_chat_date ON group_metrics(tg_chat_id, date);
CREATE INDEX idx_telegram_group_admins_expires ON telegram_group_admins(expires_at) WHERE is_admin = true;
```

### –§—É–Ω–∫—Ü–∏–∏ –∏ —Ç—Ä–∏–≥–≥–µ—Ä—ã

**–§—É–Ω–∫—Ü–∏–∏:**
- `sync_telegram_admins(org_id)` - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∞–¥–º–∏–Ω–æ–≤ –∏–∑ Telegram
- `update_updated_at()` - –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ updated_at
- `calculate_group_metrics()` - –∞–≥—Ä–µ–≥–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫ (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)

**–¢—Ä–∏–≥–≥–µ—Ä—ã:**
- `BEFORE UPDATE` –Ω–∞ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö ‚Üí `update_updated_at()`
- `AFTER INSERT` –Ω–∞ `activity_events` ‚Üí –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `last_activity_at`

---

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### Telegram Bot API

**–î–≤–∞ –±–æ—Ç–∞:**

**1. Main Bot (`orbo_community_bot`)**
- Token: `TELEGRAM_BOT_TOKEN`
- Webhook: `https://app.orbo.ru/api/telegram/webhook`
- Secret: `TELEGRAM_WEBHOOK_SECRET`

**–§—É–Ω–∫—Ü–∏–∏:**
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –≥—Ä—É–ø–ø–∞—Ö
- –ò–º–ø–æ—Ä—Ç —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
- Tracking –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- Commands: `/start`, `/help` (redirect to assistant bot)

**2. Notifications Bot (`orbo_assistant_bot`)**
- Token: `TELEGRAM_NOTIFICATIONS_BOT_TOKEN`
- Webhook: `https://app.orbo.ru/api/telegram/notifications/webhook`

**–§—É–Ω–∫—Ü–∏–∏:**
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (–æ—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–¥–æ–≤)
- –ü–æ–ª—É—á–µ–Ω–∏–µ User ID (`/start`)
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)

**API –º–µ—Ç–æ–¥—ã:**
- `getMe()` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–æ—Ç–µ
- `getChat(chat_id)` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —á–∞—Ç–µ
- `getChatMember(chat_id, user_id)` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—á–∞—Å—Ç–Ω–∏–∫–µ
- `getUserProfilePhotos(user_id)` - —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `getFile(file_id)` - –ø–æ–ª—É—á–∏—Ç—å —Ñ–∞–π–ª
- `sendMessage(chat_id, text)` - –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ

**–ö–æ–¥:** `lib/services/telegramService.ts`

### Supabase Auth

**–ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã:**
- Email (magic link)
- Email + Password

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
- URL: `NEXT_PUBLIC_SUPABASE_URL`
- Anon Key: `NEXT_PUBLIC_SUPABASE_ANON_KEY`
- Service Role Key: `SUPABASE_SERVICE_ROLE_KEY`

**Email templates:**
- Confirmation (—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è)
- Invite (–ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ)
- Magic Link (–≤—Ö–æ–¥)
- Change Email
- Reset Password

**Redirect URLs:**
- `https://app.orbo.ru/auth-callback`

**–ö–æ–¥:** `lib/server/supabaseServer.ts`, `lib/client/supabaseClient.ts`

### Supabase Storage

**Buckets:**

**1. `participant-photos`**
- Public: Yes
- Allowed MIME types: `image/*`
- Max file size: 5MB
- Path: `participant_photos/{participant_id}.{ext}`

**RLS:**
- SELECT: Public
- INSERT: Authenticated
- UPDATE: Authenticated (owner or admin)
- DELETE: Admin only

**–ö–æ–¥:** Supabase Dashboard ‚Üí Storage

### Mailgun

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
- API Key: `MAILGUN_API_KEY`
- Domain: `MAILGUN_DOMAIN`
- From: `Orbo <noreply@orbo.ru>`

**Email —Ç–∏–ø—ã:**
- Verification codes (–¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è)
- Admin invitations
- Event notifications (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)

**–ö–æ–¥:** `lib/services/emailService.ts`

---

## UI/UX

### –î–∏–∑–∞–π–Ω —Å–∏—Å—Ç–µ–º–∞

**–¶–≤–µ—Ç–æ–≤–∞—è –ø–∞–ª–∏—Ç—Ä–∞:**
- Primary: Blue (#3B82F6)
- Secondary: Purple (#8B5CF6)
- Success: Green (#10B981)
- Warning: Amber (#F59E0B)
- Error: Red (#EF4444)
- Neutral: Gray (#6B7280)

**Typography:**
- Font Family: Inter (system font fallback)
- Headings: Font weight 700 (Bold)
- Body: Font weight 400 (Regular)
- Small: Font size 0.875rem (14px)

**Spacing:**
- Base unit: 0.25rem (4px)
- Common: 0.5rem, 1rem, 1.5rem, 2rem

**Shadows:**
- sm: `0 1px 2px 0 rgb(0 0 0 / 0.05)`
- md: `0 4px 6px -1px rgb(0 0 0 / 0.1)`
- lg: `0 10px 15px -3px rgb(0 0 0 / 0.1)`

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

**–ë–∞–∑–æ–≤—ã–µ:**
- Button
- Input
- Card
- Badge
- Avatar
- Dialog/Modal
- Dropdown
- Tabs

**–°–ª–æ–∂–Ω—ã–µ:**
- CollapsibleSidebar (–Ω–∞–≤–∏–≥–∞—Ü–∏—è)
- ParticipantAvatar (—Å –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–æ–π –∏–∑ Telegram)
- AdminBadge (–∏–∫–æ–Ω–∫–∏ —Ä–æ–ª–µ–π)
- MaterialsPageEditor (Markdown —Ä–µ–¥–∞–∫—Ç–æ—Ä)
- ActivityChart (–∞–Ω–∞–ª–∏—Ç–∏–∫–∞)
- AttentionZones (dashboard –≤–∏–¥–∂–µ—Ç—ã)

**–ö–æ–¥:** `components/ui/`, `components/`

### –ù–∞–≤–∏–≥–∞—Ü–∏—è

**–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é (CollapsibleSidebar):**
- Dashboard (üè†)
- –°–æ–±—ã—Ç–∏—è (üìÖ)
- –£—á–∞—Å—Ç–Ω–∏–∫–∏ (üë•)
- –ú–∞—Ç–µ—Ä–∏–∞–ª—ã (üìÅ)
- Telegram –≥—Ä—É–ø–ø—ã (expandable list)
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (‚öôÔ∏è)
- –ü—Ä–æ—Ñ–∏–ª—å (–∞–≤–∞—Ç–∞—Ä–∫–∞ + –∏–º—è)

**Breadcrumbs:**
- –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è ‚Üí –†–∞–∑–¥–µ–ª ‚Üí –ü–æ–¥—Ä–∞–∑–¥–µ–ª

**Organization Switcher:**
- Dropdown —Å –ª–æ–≥–æ—Ç–∏–ø–∞–º–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π
- –ë—ã—Å—Ç—Ä–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º–∏

### Responsive –¥–∏–∑–∞–π–Ω

**Breakpoints:**
- Mobile: < 640px
- Tablet: 640px - 1024px
- Desktop: > 1024px

**–ê–¥–∞–ø—Ç–∞—Ü–∏–∏:**
- Mobile: Collapsed sidebar (hamburger menu)
- Tablet: Collapsed sidebar (icons only)
- Desktop: Expanded sidebar (icons + text)

---

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

**–ú–µ—Ç–æ–¥—ã:**
- Supabase Auth (JWT tokens)
- HTTP-only cookies
- Secure session management

**Telegram webhook:**
- Secret token verification
- IP whitelisting (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

**Row Level Security (RLS):**
- –í–∫–ª—é—á–µ–Ω –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü
- –ü—Ä–æ–≤–µ—Ä–∫–∞ membership –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
- Service Role key —Ç–æ–ª—å–∫–æ –≤ API routes

**API Routes:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ `auth.getUser()` –≤ –∫–∞–∂–¥–æ–º endpoint
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ (role-based)
- Rate limiting (—á–µ—Ä–µ–∑ Vercel)

### –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

**Frontend:**
- TypeScript —Ç–∏–ø–∏–∑–∞—Ü–∏—è
- Zod schemas (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
- Form validation

**Backend:**
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –≤ API routes
- SQL injection –∑–∞—â–∏—Ç–∞ (—á–µ—Ä–µ–∑ Supabase client)
- XSS –∑–∞—â–∏—Ç–∞ (sanitization)

### Storage Security

**Bucket policies:**
- Public read –¥–ª—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
- Authenticated write
- Admin-only delete

**File validation:**
- MIME type –ø—Ä–æ–≤–µ—Ä–∫–∞
- File size limit
- Extension whitelist

---

## –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### Vercel

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
```json
{
  "buildCommand": "npm run build",
  "outputDirectory": ".next",
  "framework": "nextjs",
  "regions": ["arn1"]
}
```

**Environment Variables:**
```
NEXT_PUBLIC_SUPABASE_URL
NEXT_PUBLIC_SUPABASE_ANON_KEY
SUPABASE_SERVICE_ROLE_KEY
DATABASE_URL
TELEGRAM_BOT_TOKEN
TELEGRAM_NOTIFICATIONS_BOT_TOKEN
TELEGRAM_WEBHOOK_SECRET
MAILGUN_API_KEY
MAILGUN_DOMAIN
```

**Domain:**
- Production: `app.orbo.ru`
- Auto-deploy: `main` branch

### Supabase

**Project:**
- Region: Frankfurt (EU Central)
- Plan: Free (upgrade as needed)

**Database:**
- PostgreSQL 15
- Extensions: pgcrypto, uuid-ossp

**Migrations:**
- Applied sequentially (01-51)
- Tracked in `db/migrations/`

### Telegram Webhooks

**Setup:**
```bash
curl -X POST \
  https://api.telegram.org/bot<TOKEN>/setWebhook \
  -d url=https://app.orbo.ru/api/telegram/webhook \
  -d secret_token=<SECRET>
```

**Reset:**
```bash
curl -X POST \
  https://api.telegram.org/bot<TOKEN>/deleteWebhook
```

### Monitoring

**Logs:**
- Vercel Dashboard ‚Üí Functions ‚Üí Logs
- Supabase Dashboard ‚Üí Logs

**Metrics:**
- Vercel Analytics
- Supabase Metrics

**Alerts:**
- Vercel Integration Webhooks
- Uptime monitoring (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)

---

## Roadmap

### Phase 1: MVP ‚úÖ (Completed)

- [x] –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (email + Telegram)
- [x] –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ (—Å–æ–∑–¥–∞–Ω–∏–µ, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
- [x] Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≥—Ä—É–ø–ø, –∏–º–ø–æ—Ä—Ç)
- [x] –£—á–∞—Å—Ç–Ω–∏–∫–∏ (–ø—Ä–æ—Ñ–∏–ª–∏, –¥—É–±–ª–∏–∫–∞—Ç—ã)
- [x] –°–æ–±—ã—Ç–∏—è (—Å–æ–∑–¥–∞–Ω–∏–µ, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, ICS)
- [x] –ú–∞—Ç–µ—Ä–∏–∞–ª—ã (–±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π, Markdown —Ä–µ–¥–∞–∫—Ç–æ—Ä)
- [x] –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ (dashboard, –≥—Ä—É–ø–ø—ã)
- [x] –†–æ–ª–∏ –∏ –ø—Ä–∞–≤–∞ (owner/admin/member/shadow)

### Phase 2: Enhancement üöß (In Progress)

- [x] –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–µ–¥–∏–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞)
- [x] –¢–µ–Ω–µ–≤—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏ (shadow admins)
- [x] –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∞–¥–º–∏–Ω–æ–≤ –∏–∑ Telegram
- [x] –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –∏–∑ Telegram
- [ ] Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (—Å–æ–±—ã—Ç–∏—è, –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è)
- [ ] –£–ª—É—á—à–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ (retention, engagement)
- [ ] –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö (CSV, Excel)

### Phase 3: Advanced Features üìù (Planned)

- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è (welcome messages, reminders)
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∫–∞–ª–µ–Ω–¥–∞—Ä—è–º–∏ (Google Calendar, Outlook)
- [ ] –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –∏ –±–µ–π–¥–∂–∏ (gamification)
- [ ] –û–ø—Ä–æ—Å—ã –∏ –∫–≤–∏–∑—ã
- [ ] –û–±—Å—É–∂–¥–µ–Ω–∏—è (–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º)
- [ ] –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (DM)
- [ ] Mobile app (React Native)

### Phase 4: Enterprise üéØ (Future)

- [ ] SSO (Single Sign-On)
- [ ] Advanced permissions (custom roles)
- [ ] White-label (–±—Ä–µ–Ω–¥–∏—Ä–æ–≤–∞–Ω–∏–µ)
- [ ] API –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- [ ] Webhooks –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π
- [ ] Audit logs (–ø–æ–ª–Ω—ã–π —Ç—Ä–µ–∫–∏–Ω–≥ –¥–µ–π—Å—Ç–≤–∏–π)
- [ ] GDPR compliance tools

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**Orbo** - —ç—Ç–æ –∫–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–º–∏ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞–º–∏ —Å –º–æ—â–Ω–æ–π Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π, –≥–∏–±–∫–æ–π —Å–∏—Å—Ç–µ–º–æ–π —Ä–æ–ª–µ–π, –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–µ–π.

**–ö–ª—é—á–µ–≤—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è:**
- ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–∞—é—â–∏–π MVP
- ‚úÖ 51 –º–∏–≥—Ä–∞—Ü–∏—è –ë–î
- ‚úÖ 2 Telegram –±–æ—Ç–∞
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
- ‚úÖ –£–º–Ω–æ–µ —Å–ª–∏—è–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- ‚úÖ –ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∞—è –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
- ‚úÖ –¢–µ–Ω–µ–≤—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**
- Next.js 14, React 18, TypeScript
- Supabase (PostgreSQL + Auth + Storage)
- Telegram Bot API, Mailgun
- TailwindCSS, Vercel

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
- Serverless (Vercel Edge Functions)
- Row Level Security (RLS)
- Real-time updates (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
- Scalable and secure

---

**–ö–æ–Ω—Ç–∞–∫—Ç—ã:**
- GitHub: [repository]
- Email: support@orbo.ru
- Telegram: @orbo_support

**–õ–∏—Ü–µ–Ω–∑–∏—è:** Proprietary

**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 2.0  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 20 —è–Ω–≤–∞—Ä—è 2025

