# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã —Å –¥—É–±–ª–∏–∫–∞—Ç–∞–º–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤

## –ü—Ä–æ–±–ª–µ–º—ã

### 1. –°–ø–∏—Å–æ–∫ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
–ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É "–î—É–±–ª–∏–∫–∞—Ç—ã" —Å–ø–∏—Å–æ–∫ –Ω–µ –æ–±–Ω–æ–≤–ª—è–ª—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø—Ä–∏—Ö–æ–¥–∏–ª–æ—Å—å –≤—Ä—É—á–Ω—É—é –Ω–∞–∂–∏–º–∞—Ç—å –∫–Ω–æ–ø–∫—É "–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫".

### 2. –¢–µ–∫—É—â–∏–π –ø—Ä–æ—Ñ–∏–ª—å –≤ —Å–ø–∏—Å–∫–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
–ü–µ—Ä–≤—ã–º –≤ —Å–ø–∏—Å–∫–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –æ—Ç–æ–±—Ä–∞–∂–∞–ª—Å—è —Ç–µ–∫—É—â–∏–π –ø—Ä–æ—Ñ–∏–ª—å —É—á–∞—Å—Ç–Ω–∏–∫–∞. –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –≤—ã–¥–∞–≤–∞–ª–∞—Å—å –æ—à–∏–±–∫–∞ "Cannot merge participant into itself".

### 3. –û—à–∏–±–∫–∞ "Participants already share canonical record"
–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞ —Å –ª—é–±—ã–º –¥—É–±–ª–∏–∫–∞—Ç–æ–º –≤—ã–¥–∞–≤–∞–ª–∞—Å—å –æ—à–∏–±–∫–∞:
```
PATCH /api/participants/5741f10e-8323-4418-9f93-049f603da7a6 400 (Bad Request)
Error: Participants already share canonical record
```

## –ü—Ä–∏—á–∏–Ω—ã

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
–ö–æ–º–ø–æ–Ω–µ–Ω—Ç `ParticipantDuplicatesCard` –Ω–µ –≤—ã–∑—ã–≤–∞–ª `handleFreshCheck()` –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏, –ø–æ–ª–∞–≥–∞—è—Å—å —Ç–æ–ª—å–∫–æ –Ω–∞ –Ω–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ `detail.duplicates`.

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –¢–µ–∫—É—â–∏–π —É—á–∞—Å—Ç–Ω–∏–∫ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö
API `/api/participants/check-duplicates` –≤–æ–∑–≤—Ä–∞—â–∞–ª –≤—Å–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è, –≤–∫–ª—é—á–∞—è —Å–∞–º–æ–≥–æ —Ç–µ–∫—É—â–µ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –≤—ã–±–∏—Ä–∞–ª –ø–µ—Ä–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–∞–∫ –¥—É–±–ª–∏–∫–∞—Ç –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è.

**–ö–æ–¥ –¥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```typescript
const [selectedId, setSelectedId] = useState<string | null>(initialDuplicates[0]?.id ?? null);
```

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ API
API `/api/participants/[participantId]/route.ts` –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–ª:
```typescript
if (targetCanonical === canonicalId) {
  return NextResponse.json({ error: 'Participants already share canonical record' }, { status: 400 });
}
```

–ù–æ –ø—Ä–æ–±–ª–µ–º–∞ –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –∏–∑-–∑–∞ —Ç–æ–≥–æ, —á—Ç–æ `check-duplicates` –≤–æ–∑–≤—Ä–∞—â–∞–ª —Ç–µ–∫—É—â–µ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞, –∏ –ø—Ä–∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–∏ —Å –Ω–∏–º —Å—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∞ —ç—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞.

## –†–µ—à–µ–Ω–∏—è

### 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞

**–î–æ–±–∞–≤–ª–µ–Ω `useEffect` –≤ `ParticipantDuplicatesCard`:**

```typescript
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
useEffect(() => {
  handleFreshCheck();
}, [handleFreshCheck]);
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É "–î—É–±–ª–∏–∫–∞—Ç—ã" –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ–∏—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.

### 2. –ò—Å–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞ –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

**A. –í API `check-duplicates`:**

```typescript
export async function POST(request: Request) {
  const payload = await request.json();
  const currentParticipantId = payload?.currentParticipantId as string | undefined;
  
  // ... –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π ...
  
  // –ò—Å–∫–ª—é—á–∞–µ–º —Ç–µ–∫—É—â–µ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞ –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
  const filteredMatches = currentParticipantId 
    ? matches.filter(match => match.id !== currentParticipantId)
    : matches;

  return NextResponse.json({ matches: filteredMatches });
}
```

**B. –í –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ `ParticipantDuplicatesCard`:**

```typescript
// –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–µ–∫—É—â–µ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞ –∏–∑ –Ω–∞—á–∞–ª—å–Ω—ã—Ö –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
const currentParticipantId = detail.requestedParticipantId;
const initialDuplicates = (detail.duplicates || []).filter(dup => dup.id !== currentParticipantId);
```

**C. –ü–µ—Ä–µ–¥–∞—á–∞ `currentParticipantId` –≤ API:**

```typescript
const handleFreshCheck = useCallback(async () => {
  const response = await fetch('/api/participants/check-duplicates', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      orgId,
      currentParticipantId, // ‚Üê –î–æ–±–∞–≤–ª–µ–Ω–æ
      email: detail.participant.email,
      // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
    })
  });
  // ...
}, [detail.participant, orgId, currentParticipantId]);
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: 
- ‚úÖ –¢–µ–∫—É—â–∏–π —É—á–∞—Å—Ç–Ω–∏–∫ –∏—Å–∫–ª—é—á–∞–µ—Ç—Å—è –∏–∑ —Å–ø–∏—Å–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- ‚úÖ –ü–µ—Ä–≤—ã–π –≤—ã–±—Ä–∞–Ω–Ω—ã–π –¥—É–±–ª–∏–∫–∞—Ç –≤—Å–µ–≥–¥–∞ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ
- ‚úÖ –û—à–∏–±–∫–∞ "Cannot merge participant into itself" –Ω–µ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç

### 3. –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è

API —É–∂–µ —Å–æ–¥–µ—Ä–∂–∞–ª –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –ª–æ–≥–∏–∫—É –ø—Ä–æ–≤–µ—Ä–∫–∏:
```typescript
if (canonicalId === targetId) {
  return NextResponse.json({ error: 'Cannot merge participant into itself' }, { status: 400 });
}

if (targetCanonical === canonicalId) {
  return NextResponse.json({ error: 'Participants already share canonical record' }, { status: 400 });
}
```

–ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º —Ç–µ–∫—É—â–µ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞ –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞.

## –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### 1. `app/api/participants/check-duplicates/route.ts`
- –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `currentParticipantId`
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞

### 2. `components/members/participant-duplicates-card.tsx`
- –î–æ–±–∞–≤–ª–µ–Ω `import { useEffect }` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è `initialDuplicates` –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞
- –î–æ–±–∞–≤–ª–µ–Ω `currentParticipantId` –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ `handleFreshCheck`
- –î–æ–±–∞–≤–ª–µ–Ω `useEffect` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—ã–∑–æ–≤–∞ `handleFreshCheck` –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
- –ü–µ—Ä–µ–¥–∞—á–∞ `currentParticipantId` –≤ API –∑–∞–ø—Ä–æ—Å

## Workflow —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–∞–∫

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –≤–∫–ª–∞–¥–∫—É "–î—É–±–ª–∏–∫–∞—Ç—ã"
```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å —É—á–∞—Å—Ç–Ω–∏–∫–∞
   ‚Üì
2. –ü–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ –≤–∫–ª–∞–¥–∫—É "–î—É–±–ª–∏–∫–∞—Ç—ã"
   ‚Üì
3. useEffect ‚Üí handleFreshCheck() ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
   ‚Üì
4. API –ø–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
   ‚Üì
5. API —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç —Ç–µ–∫—É—â–µ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞ ‚úÖ –ò—Å–∫–ª—é—á–µ–Ω
   ‚Üì
6. –°–ø–∏—Å–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–∞
```
1. –°–ø–∏—Å–æ–∫ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –∑–∞–≥—Ä—É–∂–µ–Ω (–±–µ–∑ —Ç–µ–∫—É—â–µ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞)
   ‚Üì
2. –ü–µ—Ä–≤—ã–π –¥—É–±–ª–∏–∫–∞—Ç –≤—ã–±—Ä–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ ‚úÖ –ù–ï —Ç–µ–∫—É—â–∏–π
   ‚Üì
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–∞–µ—Ç "–û–±—ä–µ–¥–∏–Ω–∏—Ç—å"
   ‚Üì
4. API –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
   - canonicalId !== targetId ‚úÖ –†–∞–∑–Ω—ã–µ
   - targetCanonical !== canonicalId ‚úÖ –ù–µ —Å–≤—è–∑–∞–Ω—ã
   ‚Üì
5. –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ ‚úÖ
   ‚Üì
6. –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ñ–∏–ª—å
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –†—É—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞
```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–∑–º–µ–Ω–∏–ª –¥–∞–Ω–Ω—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞
   ‚Üì
2. –ö–ª–∏–∫–∞–µ—Ç "–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫"
   ‚Üì
3. handleFreshCheck() –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é
   ‚Üì
4. –ü–æ–ª—É—á–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
   ‚Üì
5. –°–ø–∏—Å–æ–∫ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
```
‚úÖ –®–∞–≥ 1: –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–æ—Ñ–∏–ª—å —É—á–∞—Å—Ç–Ω–∏–∫–∞
‚úÖ –®–∞–≥ 2: –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –≤–∫–ª–∞–¥–∫—É "–î—É–±–ª–∏–∫–∞—Ç—ã"
‚úÖ –û–∂–∏–¥–∞–Ω–∏–µ: –°–ø–∏—Å–æ–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç: –°–ø–∏—Å–æ–∫ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –±–µ–∑ —Ä—É—á–Ω–æ–≥–æ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏
```

### –¢–µ—Å—Ç 2: –ò—Å–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞
```
‚úÖ –®–∞–≥ 1: –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–æ—Ñ–∏–ª—å —É—á–∞—Å—Ç–Ω–∏–∫–∞ —Å –∏–∑–≤–µ—Å—Ç–Ω—ã–º–∏ –¥—É–±–ª–∏–∫–∞—Ç–∞–º–∏
‚úÖ –®–∞–≥ 2: –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –≤–∫–ª–∞–¥–∫—É "–î—É–±–ª–∏–∫–∞—Ç—ã"
‚úÖ –û–∂–∏–¥–∞–Ω–∏–µ: –¢–µ–∫—É—â–∏–π —É—á–∞—Å—Ç–Ω–∏–∫ –ù–ï –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ
‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç: –¢–æ–ª—å–∫–æ —Ä–µ–∞–ª—å–Ω—ã–µ –¥—É–±–ª–∏–∫–∞—Ç—ã –≤ —Å–ø–∏—Å–∫–µ
```

### –¢–µ—Å—Ç 3: –£—Å–ø–µ—à–Ω–æ–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ
```
‚úÖ –®–∞–≥ 1: –û—Ç–∫—Ä—ã—Ç—å –≤–∫–ª–∞–¥–∫—É "–î—É–±–ª–∏–∫–∞—Ç—ã"
‚úÖ –®–∞–≥ 2: –í—ã–±—Ä–∞—Ç—å –¥—É–±–ª–∏–∫–∞—Ç–∞ –∏–∑ —Å–ø–∏—Å–∫–∞
‚úÖ –®–∞–≥ 3: –ö–ª–∏–∫–Ω—É—Ç—å "–û–±—ä–µ–¥–∏–Ω–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞"
‚úÖ –û–∂–∏–¥–∞–Ω–∏–µ: –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç —É—Å–ø–µ—à–Ω–æ
‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç: –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ñ–∏–ª—å, –Ω–µ—Ç –æ—à–∏–±–æ–∫
```

### –¢–µ—Å—Ç 4: –†—É—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
```
‚úÖ –®–∞–≥ 1: –û—Ç–∫—Ä—ã—Ç—å –≤–∫–ª–∞–¥–∫—É "–î—É–±–ª–∏–∫–∞—Ç—ã"
‚úÖ –®–∞–≥ 2: –û—á–∏—Å—Ç–∏—Ç—å –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞ (–µ—Å–ª–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ)
‚úÖ –®–∞–≥ 3: –ö–ª–∏–∫–Ω—É—Ç—å "–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫"
‚úÖ –û–∂–∏–¥–∞–Ω–∏–µ: –°–ø–∏—Å–æ–∫ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç: –ü–æ–ª—É—á–µ–Ω—ã –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥—É–±–ª–∏–∫–∞—Ç—ã
```

## –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è

API –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–¥ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ–º:

```typescript
// 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ targetId
if (!targetId || typeof targetId !== 'string') {
  return { error: 'Invalid merge target' };
}

// 2. –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏—Ö ID
const canonicalId = participantRecord.merged_into || participantRecord.id;
const targetCanonical = targetRecord.merged_into || targetRecord.id;

// 3. –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –Ω–µ –æ–±—ä–µ–¥–∏–Ω—è–µ–º —Å —Å–∞–º–∏–º —Å–æ–±–æ–π
if (canonicalId === targetId) {
  return { error: 'Cannot merge participant into itself' };
}

// 4. –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –Ω–µ —Å–≤—è–∑–∞–Ω—ã –æ–¥–Ω–æ–π –∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–æ–π –∑–∞–ø–∏—Å—å—é
if (targetCanonical === canonicalId) {
  return { error: 'Participants already share canonical record' };
}

// 5. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ RPC
await supabase.rpc('merge_participants_extended', {
  p_target: targetCanonical,
  p_duplicates: [canonicalId],
  p_actor: actorId
});
```

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–í—Å–µ —Ç—Ä–∏ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã:
1. ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** - —Å–ø–∏—Å–æ–∫ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –≤–∫–ª–∞–¥–∫–∏
2. ‚úÖ **–ò—Å–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞** - –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
3. ‚úÖ **–£—Å–ø–µ—à–Ω–æ–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ** - –æ—à–∏–±–∫–∞ "Participants already share canonical record" –Ω–µ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç

–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ! üéâ

