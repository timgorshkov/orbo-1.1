# Migration 080 - –£–¥–∞–ª–µ–Ω–∏–µ Legacy Verification Columns (Nov 4, 2025)

## üéØ –¶–µ–ª—å

–£–¥–∞–ª–∏—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ —Å—Ç–æ–ª–±—Ü—ã –∏–∑ `telegram_groups`, –∫–æ—Ç–æ—Ä—ã–µ –¥—É–±–ª–∏—Ä—É—é—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å `bot_status` –∏ –≤–≤–æ–¥—è—Ç –≤ –∑–∞–±–ª—É–∂–¥–µ–Ω–∏–µ.

---

## ‚ùå –£–¥–∞–ª—ë–Ω–Ω—ã–µ —Å—Ç–æ–ª–±—Ü—ã

### 1. `analytics_enabled` (BOOLEAN)
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –í–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –ø–æ –≥—Ä—É–ø–ø–µ
- **–ü—Ä–æ–±–ª–µ–º–∞:** –ù–∏–≥–¥–µ –Ω–µ —á–∏—Ç–∞–µ—Ç—Å—è! –¢–æ–ª—å–∫–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
- **–†–µ–∞–ª—å–Ω–æ—Å—Ç—å:** –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤—Å–µ—Ö –≥—Ä—É–ø–ø –æ–¥–∏–Ω–∞–∫–æ–≤–æ, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –∑–Ω–∞—á–µ–Ω–∏—è

### 2. `verification_status` (TEXT)
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°—Ç–∞—Ç—É—Å –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≥—Ä—É–ø–ø—ã (`'pending'`, `'verified'`)
- **–ü—Ä–æ–±–ª–µ–º–∞:** 
  - –î—É–±–ª–∏—Ä—É–µ—Ç `bot_status`
  - **–ù–ï –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** (–æ—Ç—Å—Ç–∞—ë—Ç –æ—Ç —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏)
  - –í–≤–æ–¥–∏–ª –≤ –∑–∞–±–ª—É–∂–¥–µ–Ω–∏–µ –≤ —Å—É–ø–µ—Ä–∞–¥–º–∏–Ω–∫–µ (–∫—Ä–∞—Å–Ω—ã–µ –∫—Ä–µ—Å—Ç–∏–∫–∏ —É —Ä–∞–±–æ—Ç–∞—é—â–∏—Ö –≥—Ä—É–ø–ø)

### 3. `verified_by_user_id` (UUID)
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ö—Ç–æ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–ª –≥—Ä—É–ø–ø—É
- **–ü—Ä–æ–±–ª–µ–º–∞:** –°–≤—è–∑–∞–Ω —Å `verification_status`, –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

### 4. `last_verification_at` (TIMESTAMPTZ)
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ö–æ–≥–¥–∞ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞ –≥—Ä—É–ø–ø–∞
- **–ü—Ä–æ–±–ª–µ–º–∞:** –°–≤—è–∑–∞–Ω —Å `verification_status`, –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

---

## ‚úÖ –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã: `bot_status`

**`bot_status`** (TEXT) - –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ webhook `my_chat_member`:

| –ó–Ω–∞—á–µ–Ω–∏–µ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|---------|
| `'connected'` | ‚úÖ –ë–æ—Ç –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∞ –≤ –≥—Ä—É–ø–ø–µ |
| `'pending'` | ‚è≥ –ë–æ—Ç –ù–ï –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∞ (–∏–ª–∏ –µ—â—ë –Ω–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ) |
| `'inactive'` | ‚ùå –ë–æ—Ç –±—ã–ª —É–¥–∞–ª—ë–Ω –∏–∑ –≥—Ä—É–ø–ø—ã |

---

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### 1. –°—É–ø–µ—Ä–∞–¥–º–∏–Ω–∫–∞
**`app/superadmin/groups/page.tsx:91`**
```typescript
// –î–æ:
has_admin_rights: group.verification_status === 'verified',

// –ü–æ—Å–ª–µ:
has_admin_rights: group.bot_status === 'connected',
```

### 2. –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã (—É–¥–∞–ª–µ–Ω—ã —É—Å—Ç–∞–Ω–æ–≤–∫–∏ legacy –ø–æ–ª–µ–π)
- `app/api/telegram/groups/update-admins/route.ts`
- `app/api/telegram/groups/sync/route.ts`
- `app/api/telegram/groups/verify-admin/route.ts`
- `app/api/telegram/webhook/route.ts`
- `app/app/[org]/telegram/actions.ts`

---

## üöÄ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ

### –®–∞–≥ 1: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é 080
```sql
-- –í Supabase SQL Editor
-- –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ db/migrations/080_remove_legacy_verification_columns.sql
```

### –®–∞–≥ 2: –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å –∫–æ–¥
```bash
git add .
git commit -m "fix: remove legacy verification columns, use bot_status as source of truth"
git push
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É–ø–µ—Ä–∞–¥–º–∏–Ω–∫—É
- –û—Ç–∫—Ä—ã—Ç—å `/superadmin/groups`
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≥–∞–ª–æ—á–∫–∏ –≤ —Å—Ç–æ–ª–±—Ü–µ "–ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∞" —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ä–µ–∞–ª—å–Ω—ã–º –ø—Ä–∞–≤–∞–º –±–æ—Ç–∞
- –ù–æ–≤—ã–µ –≥—Ä—É–ø–ø—ã (—Å `bot_status='connected'`) —Ç–µ–ø–µ—Ä—å –¥–æ–ª–∂–Ω—ã –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∑–µ–ª—ë–Ω—É—é –≥–∞–ª–æ—á–∫—É

---

## üìä –ü—Ä–∏–º–µ—Ä –¥–æ/–ø–æ—Å–ª–µ

### –î–æ (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
```json
{
  "tg_chat_id": -5020240850,
  "bot_status": "connected",          // ‚úÖ –ë–æ—Ç - –∞–¥–º–∏–Ω
  "verification_status": "pending",   // ‚ùå "–ù–µ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞" (—É—Å—Ç–∞—Ä–µ–ª–æ!)
  "has_admin_rights": false           // ‚ùå –í —Å—É–ø–µ—Ä–∞–¥–º–∏–Ω–∫–µ –∫—Ä–∞—Å–Ω—ã–π –∫—Ä–µ—Å—Ç–∏–∫
}
```

### –ü–æ—Å–ª–µ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
```json
{
  "tg_chat_id": -5020240850,
  "bot_status": "connected",          // ‚úÖ –ë–æ—Ç - –∞–¥–º–∏–Ω
  // verification_status - —É–¥–∞–ª—ë–Ω
  "has_admin_rights": true            // ‚úÖ –í —Å—É–ø–µ—Ä–∞–¥–º–∏–Ω–∫–µ –∑–µ–ª—ë–Ω–∞—è –≥–∞–ª–æ—á–∫–∞
}
```

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- **[TELEGRAM_GROUPS_VERIFICATION_COLUMNS_ANALYSIS.md](./TELEGRAM_GROUPS_VERIFICATION_COLUMNS_ANALYSIS.md)** - –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑
- **[TELEGRAM_OWNERSHIP_ARCHITECTURE.md](./TELEGRAM_OWNERSHIP_ARCHITECTURE.md)** - –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≤–ª–∞–¥–µ–Ω–∏—è –≥—Ä—É–ø–ø–∞–º–∏

---

## ‚úÖ –ò—Ç–æ–≥

- ‚úÖ –£–¥–∞–ª–µ–Ω—ã 4 —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö —Å—Ç–æ–ª–±—Ü–∞
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Å—É–ø–µ—Ä–∞–¥–º–∏–Ω–∫–∞ (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –≥–∞–ª–æ—á–∫–∏)
- ‚úÖ `bot_status` - –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã
- ‚úÖ –ö–æ–¥ –æ—á–∏—â–µ–Ω –æ—Ç —É—Å—Ç–∞–Ω–æ–≤–æ–∫ legacy –ø–æ–ª–µ–π
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°—É–ø–µ—Ä–∞–¥–º–∏–Ω–∫–∞ —Ç–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ –±–æ—Ç–∞.

