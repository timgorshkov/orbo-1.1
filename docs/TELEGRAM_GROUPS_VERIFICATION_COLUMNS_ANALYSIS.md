# Telegram Groups Verification Columns - –ê–Ω–∞–ª–∏–∑ (Nov 4, 2025)

## üîç –ü—Ä–æ–±–ª–µ–º–∞

–í —Ç–∞–±–ª–∏—Ü–µ `telegram_groups` –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç–æ–ª–±—Ü–æ–≤:
1. **`bot_status`** - —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø–µ (`'pending'`, `'connected'`, `'inactive'`)
2. **`verification_status`** - legacy —Å—Ç–∞—Ç—É—Å –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ (`'pending'`, `'verified'`)
3. **`verified_by_user_id`** - –∫—Ç–æ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–ª –≥—Ä—É–ø–ø—É
4. **`last_verification_at`** - –∫–æ–≥–¥–∞ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞
5. **`analytics_enabled`** - –≤–∫–ª—é—á–µ–Ω–∞ –ª–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ (bool)

**–°–∏–º–ø—Ç–æ–º—ã:**
- –í —Å—É–ø–µ—Ä–∞–¥–º–∏–Ω–∫–µ –∫—Ä–∞—Å–Ω—ã–µ –∫—Ä–µ—Å—Ç–∏–∫–∏ –≤ —Å—Ç–æ–ª–±—Ü–µ "–ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∞" —Å–æ–≤–ø–∞–¥–∞—é—Ç —Å `verification_status`, –∞ –Ω–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏ –±–æ—Ç–∞
- –£ –Ω–æ–≤—ã—Ö –≥—Ä—É–ø–ø (–¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –∑–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–¥–µ–ª—é) `verification_status='pending'`, —Ö–æ—Ç—è `bot_status='connected'`
- –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –æ–¥–∏–Ω–∞–∫–æ–≤–æ

---

## üìä –ü—Ä–∏–º–µ—Ä—ã –∏–∑ –±–∞–∑—ã

```json
// –ì—Ä—É–ø–ø–∞ 1: —Å—Ç–∞—Ä–∞—è, —Å –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–µ–π
{
  "tg_chat_id": -1003082332279,
  "bot_status": "connected",          // ‚úÖ –ë–æ—Ç –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∞
  "verification_status": "verified",   // ‚úÖ –í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞
  "verified_by_user_id": "d6495527-fda7-45f5-a113-ff43ee6a8145",
  "last_verification_at": "2025-10-28 17:06:10.317+00",
  "analytics_enabled": false
}

// –ì—Ä—É–ø–ø–∞ 2: —Å—Ç–∞—Ä–∞—è, —Å –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–µ–π –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π
{
  "tg_chat_id": -4987441578,
  "bot_status": "connected",          // ‚úÖ –ë–æ—Ç –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∞
  "verification_status": "verified",   // ‚úÖ –í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞
  "verified_by_user_id": "d6495527-fda7-45f5-a113-ff43ee6a8145",
  "last_verification_at": "2025-10-28 17:06:10.571+00",
  "analytics_enabled": true
}

// –ì—Ä—É–ø–ø–∞ 3: –Ω–æ–≤–∞—è, –±–µ–∑ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
{
  "tg_chat_id": -5020240850,
  "bot_status": "connected",          // ‚úÖ –ë–æ—Ç –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∞
  "verification_status": "pending",    // ‚ùå –ù–µ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞ (—É—Å—Ç–∞—Ä–µ–ª–æ!)
  "verified_by_user_id": null,
  "last_verification_at": null,
  "analytics_enabled": false
}
```

---

## üîç –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —ç—Ç–∏ —Å—Ç–æ–ª–±—Ü—ã –≤ –∫–æ–¥–µ

### 1. `analytics_enabled`

**–î–æ–±–∞–≤–ª–µ–Ω:** Migration 04 (`db/migrations/04_telegram_analytics.sql`)
```sql
ALTER TABLE telegram_groups 
ADD COLUMN IF NOT EXISTS analytics_enabled BOOLEAN DEFAULT TRUE;
```

**–ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**

#### a) `app/api/telegram/webhook/route.ts:163`
–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–π –≥—Ä—É–ø–ø—ã —á–µ—Ä–µ–∑ webhook:
```typescript
analytics_enabled: false, // –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –±—É–¥–µ—Ç –≤–∫–ª—é—á–µ–Ω–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é
```

#### b) `app/app/[org]/telegram/actions.ts:191`
–ü—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å—Ç–∞—Ç—É—Å–∞ –≥—Ä—É–ø–ø—ã (–∫–Ω–æ–ø–∫–∞ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å"):
```typescript
analytics_enabled: true // –í–∫–ª—é—á–∞–µ–º –∞–Ω–∞–ª–∏—Ç–∏–∫—É
```

**–í—ã–≤–æ–¥:** 
- `analytics_enabled` –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ –±—ã–ª –∑–∞–¥—É–º–∞–Ω –¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –ø–æ –≥—Ä—É–ø–ø–µ
- **–ù–∏–≥–¥–µ –Ω–µ —á–∏—Ç–∞–µ—Ç—Å—è!** –¢–æ–ª—å–∫–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
- **–ù–ï –í–õ–ò–Ø–ï–¢** –Ω–∞ —Ä–∞–±–æ—Ç—É –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ (–≤—Å–µ –≥—Ä—É–ø–ø—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –æ–¥–∏–Ω–∞–∫–æ–≤–æ)
- **LEGACY COLUMN** - –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å

---

### 2. `verification_status`, `verified_by_user_id`, `last_verification_at`

**–ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è:**

#### a) `app/superadmin/groups/page.tsx:91`
**–ü–†–û–ë–õ–ï–ú–ù–û–ï –ú–ï–°–¢–û!**
```typescript
has_admin_rights: group.verification_status === 'verified',
```
‚ùå **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ!** –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: `group.bot_status === 'connected'`

#### b) `app/api/telegram/groups/for-user/route.ts:376`
–ü–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ UI (–Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è):
```typescript
verification_status: groupAny.verification_status
```

#### c) `app/api/telegram/groups/update-admins/route.ts:212`
–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∞–¥–º–∏–Ω–æ–≤:
```typescript
verification_status: 'verified',
verified_by_user_id: accounts[0].user_id,
last_verification_at: new Date().toISOString()
```

#### d) `app/api/telegram/groups/sync/route.ts:295`
–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Ä—É—á–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:
```typescript
verification_status: 'verified',
verified_by_user_id: user.id,
last_verification_at: new Date().toISOString()
```

#### e) `app/api/telegram/groups/verify-admin/route.ts:127`
–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∞–¥–º–∏–Ω-–ø—Ä–∞–≤:
```typescript
verification_status: 'verified',
verified_by_user_id: user.id,
last_verification_at: new Date().toISOString()
```

**–í—ã–≤–æ–¥:**
- `verification_status` - —ç—Ç–æ **–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ** `bot_status`
- –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ –ø–æ—è–≤–∏–ª—Å—è `bot_status`
- –°–µ–π—á–∞—Å `bot_status` –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ `my_chat_member` webhook
- `verification_status` –ù–ï –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ ‚Üí **–æ—Ç—Å—Ç–∞—ë—Ç –æ—Ç —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏**
- **LEGACY COLUMNS** - –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å

---

## üéØ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞

### –¢–µ–∫—É—â–∞—è (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–ê–Ø):
```typescript
// –°—É–ø–µ—Ä–∞–¥–º–∏–Ω–∫–∞ (app/superadmin/groups/page.tsx:91)
has_admin_rights: group.verification_status === 'verified',
```

### –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è (–î–û–õ–ñ–ù–ê –ë–´–¢–¨):
```typescript
// –ò—Å–ø–æ–ª—å–∑—É–µ–º bot_status, –∫–æ—Ç–æ—Ä—ã–π –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
has_admin_rights: group.bot_status === 'connected',
```

---

## üìã –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Å—É–ø–µ—Ä–∞–¥–º–∏–Ω–∫—É (–±—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ)
–ó–∞–º–µ–Ω–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É `verification_status` –Ω–∞ `bot_status` –≤ —Å—É–ø–µ—Ä–∞–¥–º–∏–Ω–∫–µ.

### –í–∞—Ä–∏–∞–Ω—Ç 2: –£–¥–∞–ª–∏—Ç—å legacy —Å—Ç–æ–ª–±—Ü—ã (–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ)
1. –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã, —á—Ç–æ–±—ã –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª–∏ `verification_status`
2. –£–¥–∞–ª–∏—Ç—å —Å—Ç–æ–ª–±—Ü—ã —á–µ—Ä–µ–∑ –º–∏–≥—Ä–∞—Ü–∏—é:
   - `analytics_enabled`
   - `verification_status`
   - `verified_by_user_id`
   - `last_verification_at`

3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ `bot_status` –¥–ª—è –≤—Å–µ—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫

---

## üöÄ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

**Migration 080:** –£–¥–∞–ª–∏—Ç—å legacy —Å—Ç–æ–ª–±—Ü—ã
**Fix:** –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Å—É–ø–µ—Ä–∞–¥–º–∏–Ω–∫—É (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `bot_status`)

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `app/superadmin/groups/page.tsx` - —Å—É–ø–µ—Ä–∞–¥–º–∏–Ω–∫–∞ (–ü–†–û–ë–õ–ï–ú–ù–û–ï –ú–ï–°–¢–û)
- `app/api/telegram/groups/update-admins/route.ts` - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∞–¥–º–∏–Ω–æ–≤
- `app/api/telegram/groups/sync/route.ts` - —Ä—É—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
- `app/api/telegram/groups/verify-admin/route.ts` - –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –∞–¥–º–∏–Ω-–ø—Ä–∞–≤
- `app/api/telegram/webhook/route.ts` - webhook (–æ–±–Ω–æ–≤–ª—è–µ—Ç `bot_status`)
- `db/migrations/04_telegram_analytics.sql` - —Å–æ–∑–¥–∞–Ω–∏–µ `analytics_enabled`

---

## ‚úÖ –ò—Ç–æ–≥

**–°—Ç–æ–ª–±—Ü—ã `verification_status`, `verified_by_user_id`, `last_verification_at`, `analytics_enabled`:**
- ‚ùå Legacy –∫–æ–¥
- ‚ùå –ù–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- ‚ùå –û—Ç—Å—Ç–∞—é—Ç –æ—Ç —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ (–Ω–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
- ‚ùå –í–≤–æ–¥—è—Ç –≤ –∑–∞–±–ª—É–∂–¥–µ–Ω–∏–µ –≤ —Å—É–ø–µ—Ä–∞–¥–º–∏–Ω–∫–µ
- ‚úÖ –ú–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ —É–¥–∞–ª–∏—Ç—å

**–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã:**
- ‚úÖ `bot_status` - –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ webhook `my_chat_member`
- ‚úÖ `bot_status='connected'` ‚Üí –±–æ—Ç –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∞
- ‚úÖ `bot_status='pending'` ‚Üí –±–æ—Ç –ù–ï –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∞ (–∏–ª–∏ –µ—â—ë –Ω–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ)
- ‚úÖ `bot_status='inactive'` ‚Üí –±–æ—Ç –±—ã–ª —É–¥–∞–ª—ë–Ω –∏–∑ –≥—Ä—É–ø–ø—ã

