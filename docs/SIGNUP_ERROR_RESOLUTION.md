# –†–µ—à–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ "Database error finding user"

**–°—Ç–∞—Ç—É—Å:** üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≥–æ—Ç–æ–≤–∞  
**–î–∞—Ç–∞:** 2025-01-20

---

## üìã –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

### 1Ô∏è‚É£ –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (3 –º–∏–Ω—É—Ç—ã)

–°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –≤ **[`SIGNUP_QUICK_FIX.md`](./SIGNUP_QUICK_FIX.md)**

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ Supabase Dashboard:
- ‚úÖ Email Provider –≤–∫–ª—é—á–µ–Ω
- ‚úÖ Site URL –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π (`https://app.orbo.ru`)
- ‚úÖ Redirect URLs –¥–æ–±–∞–≤–ª–µ–Ω—ã
- ‚úÖ Email Auth –≤–∫–ª—é—á–µ–Ω

### 2Ô∏è‚É£ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ (5 –º–∏–Ω—É—Ç)

–ï—Å–ª–∏ –±—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ –Ω–µ –ø–æ–º–æ–≥–ª–æ:

1. **–í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL —Å–∫—Ä–∏–ø—Ç:**
   - –û—Ç–∫—Ä–æ–π—Ç–µ Supabase SQL Editor
   - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ `db/DIAGNOSE_SIGNUP_ISSUE.sql`
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ Notice/Info –ª–æ–≥–∞—Ö

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ Supabase Auth Logs:**
   - Dashboard ‚Üí Logs ‚Üí Auth Logs
   - –ù–∞–π–¥–∏—Ç–µ –ø–æ—Å–ª–µ–¥–Ω—é—é –ø–æ–ø—ã—Ç–∫—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
   - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ Browser Network:**
   - DevTools ‚Üí Network
   - –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
   - –ù–∞–π–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å `/auth/v1/otp` —Å 500 –æ—à–∏–±–∫–æ–π
   - –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ Response body

### 3Ô∏è‚É£ –î–µ—Ç–∞–ª—å–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (10-30 –º–∏–Ω—É—Ç)

–ï—Å–ª–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–æ–∫–∞–∑–∞–ª–∞ –ø—Ä–æ–±–ª–µ–º—ã:

–°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –≤ **[`SIGNUP_ERROR_FIX.md`](./SIGNUP_ERROR_FIX.md)**

---

## üéØ –ù–∞–∏–±–æ–ª–µ–µ –≤–µ—Ä–æ—è—Ç–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã

### –ü—Ä–∏—á–∏–Ω–∞ 1: Supabase URL Configuration (90%)

**–ü—Ä–æ–±–ª–µ–º–∞:** Site URL –∏–ª–∏ Redirect URLs –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç —Å –≤–∞—à–∏–º –¥–æ–º–µ–Ω–æ–º

**–†–µ—à–µ–Ω–∏–µ:**
```
Supabase Dashboard ‚Üí Settings ‚Üí Auth ‚Üí URL Configuration

Site URL: https://app.orbo.ru
Redirect URLs: https://app.orbo.ru/**
```

### –ü—Ä–∏—á–∏–Ω–∞ 2: Email Provider –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω (5%)

**–ü—Ä–æ–±–ª–µ–º–∞:** Supabase –Ω–µ –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å Magic Link

**–†–µ—à–µ–Ω–∏–µ:**
- –î–ª—è dev: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π Supabase Email
- –î–ª—è prod: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Custom SMTP (Mailgun)

### –ü—Ä–∏—á–∏–Ω–∞ 3: Auth Template –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π (3%)

**–ü—Ä–æ–±–ª–µ–º–∞:** –°—Å—ã–ª–∫–∞ –≤ email –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:**
```
Dashboard ‚Üí Authentication ‚Üí Email Templates ‚Üí Magic Link

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å—Å—ã–ª–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è:
{{ .SiteURL }}/auth/confirm?token_hash={{ .TokenHash }}&type=magiclink
```

### –ü—Ä–∏—á–∏–Ω–∞ 4: RLS –∏–ª–∏ Triggers (2%)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–∞–∫–æ–π-—Ç–æ —Ç—Ä–∏–≥–≥–µ—Ä –∏–ª–∏ RLS –ø–æ–ª–∏—Ç–∏–∫–∞ –±–ª–æ–∫–∏—Ä—É–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–†–µ—à–µ–Ω–∏–µ:**
- –í—ã–ø–æ–ª–Ω–∏—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –µ—Å—Ç—å –ª–∏ —Ç—Ä–∏–≥–≥–µ—Ä—ã –Ω–∞ `auth.users`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –Ω–µ –≤–∫–ª—é—á–µ–Ω –ª–∏ RLS –Ω–∞ `auth.users` (–Ω–µ –¥–æ–ª–∂–µ–Ω!)

---

## üöÄ –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

–ü–æ–∫–∞ –≤—ã —Ä–∞–∑–±–∏—Ä–∞–µ—Ç–µ—Å—å —Å –ø—Ä–æ–±–ª–µ–º–æ–π, –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é —Å –ø–∞—Ä–æ–ª–µ–º –≤–º–µ—Å—Ç–æ Magic Link.

–°–º. –∫–æ–¥ –≤ **[`SIGNUP_QUICK_FIX.md`](./SIGNUP_QUICK_FIX.md)** ‚Üí —Ä–∞–∑–¥–µ–ª "–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ"

---

## üìä –ß—Ç–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –¥–ª—è –ø–æ–º–æ—â–∏

–ï—Å–ª–∏ –Ω–µ –º–æ–∂–µ—Ç–µ —Ä–µ—à–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ:

1. **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞** (`db/DIAGNOSE_SIGNUP_ISSUE.sql`)
2. **–õ–æ–≥–∏ –∏–∑ Supabase Auth Logs** (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –∑–∞–ø–∏—Å–µ–π —Å –æ—à–∏–±–∫–æ–π)
3. **Network Response** (–∏–∑ Browser DevTools)
4. **–°–∫—Ä–∏–Ω—à–æ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫:**
   - Settings ‚Üí Auth ‚Üí URL Configuration
   - Authentication ‚Üí Providers (Email)
   - Settings ‚Üí Auth ‚Üí SMTP Settings (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

---

## ‚úÖ –ü–æ—Å–ª–µ —Ä–µ—à–µ–Ω–∏—è

1. **–û—á–∏—Å—Ç–∏—Ç–µ cookies** –≤ –±—Ä–∞—É–∑–µ—Ä–µ
2. **–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è:**
   - –í–≤–µ–¥–∏—Ç–µ email
   - –ù–∞–∂–º–∏—Ç–µ "–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è"
   - –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å: "‚úâÔ∏è –û—Ç–ª–∏—á–Ω–æ! –ú—ã –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ —Å—Å—ã–ª–∫—É..."
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ email:**
   - –î–æ–ª–∂–Ω–æ –ø—Ä–∏–π—Ç–∏ –ø–∏—Å—å–º–æ —Å —Ç–µ–º–æ–π "Magic Link"
   - –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ —Å—Å—ã–ª–∫—É
4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–¥–∏—Ä–µ–∫—Ç:**
   - –î–æ–ª–∂–µ–Ω –ø—Ä–æ–∏–∑–æ–π—Ç–∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/auth-callback`
   - –ó–∞—Ç–µ–º –Ω–∞ `/orgs/new` (–¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
5. **–°–æ–∑–¥–∞–π—Ç–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é** –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

**–ì–æ—Ç–æ–≤–æ!** üéâ

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- **[SIGNUP_QUICK_FIX.md](./SIGNUP_QUICK_FIX.md)** - –ë—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ (3 –º–∏–Ω—É—Ç—ã)
- **[SIGNUP_ERROR_FIX.md](./SIGNUP_ERROR_FIX.md)** - –î–µ—Ç–∞–ª—å–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
- **[db/DIAGNOSE_SIGNUP_ISSUE.sql](../db/DIAGNOSE_SIGNUP_ISSUE.sql)** - –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç
- **[Supabase Auth Docs](https://supabase.com/docs/guides/auth)** - –û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- **[Magic Link Setup](https://supabase.com/docs/guides/auth/auth-magic-link)** - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Magic Link

---

## üîÑ –°—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

- [x] –°–æ–∑–¥–∞–Ω –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç
- [x] –°–æ–∑–¥–∞–Ω–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –±—ã—Å—Ç—Ä–æ–º—É –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é
- [x] –°–æ–∑–¥–∞–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Supabase
- [ ] –í—ã–ø–æ–ª–Ω–µ–Ω–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
- [ ] –ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞

---

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –û—Ç–∫—Ä–æ–π—Ç–µ [`SIGNUP_QUICK_FIX.md`](./SIGNUP_QUICK_FIX.md) –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ 3-–º–∏–Ω—É—Ç–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É

