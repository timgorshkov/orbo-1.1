# –î–∏–∑–∞–π–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–ª—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤

## –ü—Ä–æ–±–ª–µ–º—ã —Ç–µ–∫—É—â–µ–π —Å–∏—Å—Ç–µ–º—ã

### ‚ùå –ß—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. **–£—á–∞—Å—Ç–Ω–∏–∫–∏ Telegram-–≥—Ä—É–ø–ø** –µ—Å—Ç—å –≤ –±–∞–∑–µ (`participants`), –Ω–æ **–Ω–µ –º–æ–≥—É—Ç –≤–æ–π—Ç–∏ –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å**
2. –ù–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –≤–Ω–µ—à–Ω–∏—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
3. –ù–µ—Ç –ø—É–±–ª–∏—á–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ –Ω–∞ –º–∞—Ç–µ—Ä–∏–∞–ª—ã/—Å–æ–±—ã—Ç–∏—è
4. Owner/Admin –¥–æ–ª–∂–Ω—ã –≤—Ä—É—á–Ω—É—é –ø—Ä–∏–≤—è–∑—ã–≤–∞—Ç—å Telegram —á–µ—Ä–µ–∑ —Å–ª–æ–∂–Ω—ã–π flow —Å –∫–æ–¥–∞–º–∏

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
- Telegram-–±–æ—Ç —Å–æ–±–∏—Ä–∞–µ—Ç —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∏–∑ –≥—Ä—É–ø–ø
- –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–¥—ã –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –¥–ª—è owner/admin
- RLS –ø–æ–ª–∏—Ç–∏–∫–∏ —Ä–∞–∑–≥—Ä–∞–Ω–∏—á–∏–≤–∞—é—Ç –¥–æ—Å—Ç—É–ø –ø–æ —Ä–æ–ª—è–º

## –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ

### 1. Telegram Login Widget (–≥–ª–∞–≤–Ω—ã–π –≤—Ö–æ–¥)

–ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π [Telegram Login Widget](https://core.telegram.org/widgets/login) –¥–ª—è –±—ã—Å—Ç—Ä–æ–π OAuth-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º Telegram
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç –±–æ—Ç–∞
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑—É–µ—Ç—Å—è –∑–∞ 1 –∫–ª–∏–∫
- ‚úÖ –ü–æ–ª—É—á–∞–µ–º: `id`, `first_name`, `last_name`, `username`, `photo_url`
- ‚úÖ –í—ã—Å–æ–∫–∞—è –∫–æ–Ω–≤–µ—Ä—Å–∏—è

**Flow:**
```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –∫–Ω–æ–ø–∫–∞ "–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Telegram"
2. Telegram Widget ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ telegram.org
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç ‚Üí callback –Ω–∞ –Ω–∞—à —Å–∞–π—Ç
4. –ú—ã –ø–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ + —Ö–µ—à –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
5. –°–æ–∑–¥–∞—ë–º/–æ–±–Ω–æ–≤–ª—è–µ–º auth.users + —Å–≤—è–∑—ã–≤–∞–µ–º —Å participants
```

### 2. –¢–∏–ø—ã –¥–æ—Å—Ç—É–ø–∞

#### A. –ß–µ—Ä–µ–∑ Telegram-–≥—Ä—É–ø–ø—É (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
```
–£—á–∞—Å—Ç–Ω–∏–∫ –≥—Ä—É–ø–ø—ã ‚Üí –ø–æ–ø–∞–¥–∞–µ—Ç –≤ participants ‚Üí 
‚Üí –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ —á–µ—Ä–µ–∑ Login Widget ‚Üí 
‚Üí —Å–æ–∑–¥–∞—ë—Ç—Å—è auth.users + —Å–≤—è–∑–∫–∞
‚Üí –¥–æ—Å—Ç—É–ø –∫ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º/—Å–æ–±—ã—Ç–∏—è–º –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
```

#### B. –ß–µ—Ä–µ–∑ –ø—É–±–ª–∏—á–Ω—É—é —Å—Å—ã–ª–∫—É (–ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ)
```
/join/[org]/[inviteToken]
‚Üí Login —á–µ—Ä–µ–∑ Telegram Widget
‚Üí —Å–æ–∑–¥–∞—ë—Ç—Å—è auth.users
‚Üí —Å–æ–∑–¥–∞—ë—Ç—Å—è participants —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º 'event_attendee' –∏–ª–∏ 'candidate'
‚Üí –¥–æ—Å—Ç—É–ø –∫ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º (–µ—Å–ª–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ –≤ —Å—Å—ã–ª–∫–µ)
```

#### C. –ß–µ—Ä–µ–∑ –ø—É–±–ª–∏—á–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ
```
/p/[org]/events/[eventId]
‚Üí –º–æ–∂–µ—Ç –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
‚Üí –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ ‚Üí Login —á–µ—Ä–µ–∑ Telegram Widget
‚Üí —Å–æ–∑–¥–∞—ë—Ç—Å—è participants —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º 'event_attendee'
```

### 3. –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è (Invite Links)

#### –¢–∏–ø—ã –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π:
1. **–ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø**: –º–∞—Ç–µ—Ä–∏–∞–ª—ã + —Å–æ–±—ã—Ç–∏—è + —É—á–∞—Å—Ç–Ω–∏–∫–∏
2. **–¢–æ–ª—å–∫–æ —Å–æ–±—ã—Ç–∏—è**: —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ —Å–æ–±—ã—Ç–∏—è
3. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π**: –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã/—Å–æ–±—ã—Ç–∏—è

#### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:
```sql
CREATE TABLE organization_invites (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  org_id UUID NOT NULL REFERENCES organizations(id) ON DELETE CASCADE,
  token TEXT UNIQUE NOT NULL, -- –∫–æ—Ä–æ—Ç–∫–∏–π —Ç–æ–∫–µ–Ω –¥–ª—è —Å—Å—ã–ª–∫–∏
  created_by UUID NOT NULL REFERENCES auth.users(id),
  
  -- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ—Å—Ç—É–ø–∞
  access_type TEXT NOT NULL CHECK (access_type IN ('full', 'events_only', 'materials_only', 'limited')),
  allowed_materials UUID[], -- –º–∞—Å—Å–∏–≤ ID –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ (–µ—Å–ª–∏ limited)
  allowed_events UUID[], -- –º–∞—Å—Å–∏–≤ ID —Å–æ–±—ã—Ç–∏–π (–µ—Å–ª–∏ limited)
  
  -- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
  max_uses INTEGER, -- –º–∞–∫—Å–∏–º—É–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π (NULL = –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ)
  current_uses INTEGER DEFAULT 0,
  expires_at TIMESTAMPTZ, -- –¥–∞—Ç–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è (NULL = –±–µ—Å—Å—Ä–æ—á–Ω–æ)
  
  -- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
  is_active BOOLEAN DEFAULT TRUE,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_invites_token ON organization_invites(token);
CREATE INDEX idx_invites_org ON organization_invites(org_id);

-- –¢–∞–±–ª–∏—Ü–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π (–∞—É–¥–∏—Ç)
CREATE TABLE organization_invite_uses (
  id BIGSERIAL PRIMARY KEY,
  invite_id UUID NOT NULL REFERENCES organization_invites(id) ON DELETE CASCADE,
  user_id UUID REFERENCES auth.users(id),
  telegram_user_id BIGINT,
  used_at TIMESTAMPTZ DEFAULT NOW()
);
```

### 4. Telegram Login Widget - –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

#### –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç:
```typescript
// components/auth/telegram-login.tsx
'use client'

import { useEffect, useRef } from 'react'

interface TelegramLoginProps {
  botUsername: string // @your_bot_username
  onAuth: (user: TelegramUser) => void
  buttonSize?: 'large' | 'medium' | 'small'
  cornerRadius?: number
  requestAccess?: boolean
}

interface TelegramUser {
  id: number
  first_name: string
  last_name?: string
  username?: string
  photo_url?: string
  auth_date: number
  hash: string
}

export default function TelegramLogin({
  botUsername,
  onAuth,
  buttonSize = 'large',
  cornerRadius = 5,
  requestAccess = true
}: TelegramLoginProps) {
  const containerRef = useRef<HTMLDivElement>(null)

  useEffect(() => {
    // –°–æ–∑–¥–∞—ë–º callback —Ñ—É–Ω–∫—Ü–∏—é –≥–ª–æ–±–∞–ª—å–Ω–æ
    ;(window as any).telegramLoginCallback = (user: TelegramUser) => {
      onAuth(user)
    }

    // –ó–∞–≥—Ä—É–∂–∞–µ–º Telegram Widget —Å–∫—Ä–∏–ø—Ç
    if (containerRef.current && !containerRef.current.hasChildNodes()) {
      const script = document.createElement('script')
      script.src = 'https://telegram.org/js/telegram-widget.js?22'
      script.setAttribute('data-telegram-login', botUsername)
      script.setAttribute('data-size', buttonSize)
      script.setAttribute('data-radius', cornerRadius.toString())
      script.setAttribute('data-onauth', 'telegramLoginCallback(user)')
      script.setAttribute('data-request-access', requestAccess ? 'write' : '')
      script.async = true
      
      containerRef.current.appendChild(script)
    }

    return () => {
      delete (window as any).telegramLoginCallback
    }
  }, [botUsername, buttonSize, cornerRadius, requestAccess, onAuth])

  return <div ref={containerRef} />
}
```

#### API endpoint –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏:
```typescript
// app/api/auth/telegram/route.ts
import { NextRequest, NextResponse } from 'next/server'
import crypto from 'crypto'
import { createClient } from '@supabase/supabase-js'

const supabaseAdmin = createClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL!,
  process.env.SUPABASE_SERVICE_ROLE_KEY!
)

// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ö–µ—à–∞ –æ—Ç Telegram
function verifyTelegramAuth(data: any, botToken: string): boolean {
  const { hash, ...fields } = data
  const dataCheckString = Object.keys(fields)
    .sort()
    .map(key => `${key}=${fields[key]}`)
    .join('\n')
  
  const secretKey = crypto.createHash('sha256').update(botToken).digest()
  const computedHash = crypto
    .createHmac('sha256', secretKey)
    .update(dataCheckString)
    .digest('hex')
  
  return computedHash === hash
}

export async function POST(req: NextRequest) {
  try {
    const body = await req.json()
    const { telegramData, orgId, inviteToken } = body
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –æ—Ç Telegram
    const botToken = process.env.TELEGRAM_BOT_TOKEN!
    if (!verifyTelegramAuth(telegramData, botToken)) {
      return NextResponse.json({ error: 'Invalid Telegram authentication' }, { status: 400 })
    }
    
    const { id: tgUserId, first_name, last_name, username, photo_url } = telegramData
    
    // 1. –ò—â–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ Telegram ID
    const { data: existingUser } = await supabaseAdmin
      .from('user_telegram_accounts')
      .select('user_id, auth.users(email)')
      .eq('telegram_user_id', tgUserId)
      .eq('is_verified', true)
      .maybeSingle()
    
    let userId: string
    
    if (existingUser?.user_id) {
      // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
      userId = existingUser.user_id
    } else {
      // –°–æ–∑–¥–∞—ë–º –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      // –ò—Å–ø–æ–ª—å–∑—É–µ–º Telegram ID –∫–∞–∫ –æ—Å–Ω–æ–≤—É –¥–ª—è email (–º–æ–∂–Ω–æ –ø–æ–∑–∂–µ –∏–∑–º–µ–Ω–∏—Ç—å)
      const email = `tg${tgUserId}@telegram.user`
      const password = crypto.randomBytes(32).toString('hex')
      
      const { data: newUser, error: signUpError } = await supabaseAdmin.auth.admin.createUser({
        email,
        password,
        email_confirm: true, // –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º
        user_metadata: {
          telegram_id: tgUserId,
          telegram_username: username,
          full_name: `${first_name}${last_name ? ' ' + last_name : ''}`
        }
      })
      
      if (signUpError || !newUser.user) {
        console.error('Error creating user:', signUpError)
        return NextResponse.json({ error: 'Failed to create user' }, { status: 500 })
      }
      
      userId = newUser.user.id
      
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–≤—è–∑–∫—É —Å Telegram
      await supabaseAdmin
        .from('user_telegram_accounts')
        .insert({
          user_id: userId,
          org_id: orgId,
          telegram_user_id: tgUserId,
          telegram_username: username,
          telegram_first_name: first_name,
          telegram_last_name: last_name,
          is_verified: true,
          verified_at: new Date().toISOString()
        })
    }
    
    // 2. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –¥–æ—Å—Ç—É–ø –∫ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
    if (inviteToken) {
      // –ò—Å–ø–æ–ª—å–∑—É–µ–º invite token
      const { data: invite } = await supabaseAdmin
        .from('organization_invites')
        .select('*')
        .eq('token', inviteToken)
        .eq('is_active', true)
        .maybeSingle()
      
      if (invite) {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
        if (invite.expires_at && new Date(invite.expires_at) < new Date()) {
          return NextResponse.json({ error: 'Invite expired' }, { status: 400 })
        }
        
        if (invite.max_uses && invite.current_uses >= invite.max_uses) {
          return NextResponse.json({ error: 'Invite limit reached' }, { status: 400 })
        }
        
        // –°–æ–∑–¥–∞—ë–º participant
        await supabaseAdmin
          .from('participants')
          .upsert({
            org_id: invite.org_id,
            tg_user_id: tgUserId,
            username: username,
            full_name: `${first_name}${last_name ? ' ' + last_name : ''}`,
            participant_status: invite.access_type === 'full' ? 'participant' : 'event_attendee',
            source: 'invite'
          }, {
            onConflict: 'org_id,tg_user_id'
          })
        
        // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á—ë—Ç—á–∏–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π
        await supabaseAdmin
          .from('organization_invites')
          .update({ current_uses: invite.current_uses + 1 })
          .eq('id', invite.id)
        
        // –õ–æ–≥–∏—Ä—É–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
        await supabaseAdmin
          .from('organization_invite_uses')
          .insert({
            invite_id: invite.id,
            user_id: userId,
            telegram_user_id: tgUserId
          })
      }
    } else {
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É—á–∞—Å—Ç–Ω–∏–∫ –≤ –±–∞–∑–µ (—á–µ—Ä–µ–∑ Telegram-–≥—Ä—É–ø–ø—ã)
      const { data: existingParticipant } = await supabaseAdmin
        .from('participants')
        .select('id')
        .eq('org_id', orgId)
        .eq('tg_user_id', tgUserId)
        .maybeSingle()
      
      if (!existingParticipant) {
        return NextResponse.json({ 
          error: 'No access to this organization. Please use an invite link.' 
        }, { status: 403 })
      }
    }
    
    // 3. –°–æ–∑–¥–∞—ë–º —Å–µ—Å—Å–∏—é –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const { data: session, error: sessionError } = await supabaseAdmin.auth.admin.createSession({
      user_id: userId,
      session_not_after: Math.floor(Date.now() / 1000) + 60 * 60 * 24 * 7 // 7 –¥–Ω–µ–π
    })
    
    if (sessionError || !session) {
      return NextResponse.json({ error: 'Failed to create session' }, { status: 500 })
    }
    
    return NextResponse.json({
      success: true,
      user: {
        id: userId,
        telegram_id: tgUserId,
        username,
        full_name: `${first_name}${last_name ? ' ' + last_name : ''}`
      },
      session: {
        access_token: session.access_token,
        refresh_token: session.refresh_token
      }
    })
    
  } catch (error) {
    console.error('Telegram auth error:', error)
    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })
  }
}
```

### 5. –°—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –≤—Ö–æ–¥–∞

#### A. –ü—É–±–ª–∏—á–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è
```typescript
// app/join/[org]/[token]/page.tsx
import TelegramLogin from '@/components/auth/telegram-login'

export default async function JoinPage({ 
  params 
}: { 
  params: Promise<{ org: string; token: string }> 
}) {
  const { org: orgId, token } = await params
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å invite
  // ... fetch invite info
  
  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-50">
      <div className="max-w-md w-full bg-white rounded-lg shadow-lg p-8">
        <h1 className="text-2xl font-bold mb-4">
          –ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ {orgName}
        </h1>
        
        <p className="text-gray-600 mb-6">
          –í–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ Telegram, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º –∏ —Å–æ–±—ã—Ç–∏—è–º –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏.
        </p>
        
        <TelegramLogin
          botUsername={process.env.NEXT_PUBLIC_TELEGRAM_BOT_USERNAME!}
          onAuth={async (user) => {
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            const res = await fetch('/api/auth/telegram', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                telegramData: user,
                orgId,
                inviteToken: token
              })
            })
            
            const data = await res.json()
            
            if (data.success) {
              // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–µ—Å—Å–∏—é
              // –†–µ–¥–∏—Ä–µ–∫—Ç–∏–º –≤ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é
              window.location.href = `/app/${orgId}`
            }
          }}
        />
      </div>
    </div>
  )
}
```

#### B. –õ–æ–≥–∏–Ω –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
```typescript
// app/login/page.tsx (–æ–±–Ω–æ–≤–∏—Ç—å)
'use client'

export default function LoginPage() {
  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-50">
      <div className="max-w-md w-full space-y-8">
        {/* Telegram Login */}
        <div className="bg-white rounded-lg shadow-lg p-8">
          <h2 className="text-2xl font-bold mb-4">–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Telegram</h2>
          <p className="text-gray-600 mb-6">
            –ë—ã—Å—Ç—Ä—ã–π –≤—Ö–æ–¥ –¥–ª—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π
          </p>
          
          <TelegramLogin
            botUsername={process.env.NEXT_PUBLIC_TELEGRAM_BOT_USERNAME!}
            onAuth={handleTelegramAuth}
          />
        </div>
        
        {/* –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å */}
        <div className="relative">
          <div className="absolute inset-0 flex items-center">
            <div className="w-full border-t border-gray-300" />
          </div>
          <div className="relative flex justify-center text-sm">
            <span className="px-2 bg-gray-50 text-gray-500">–∏–ª–∏</span>
          </div>
        </div>
        
        {/* Email/Password –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤ */}
        <div className="bg-white rounded-lg shadow-lg p-8">
          <h2 className="text-2xl font-bold mb-4">–í—Ö–æ–¥ –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤</h2>
          {/* –°—É—â–µ—Å—Ç–≤—É—é—â–∞—è —Ñ–æ—Ä–º–∞ email/password */}
        </div>
      </div>
    </div>
  )
}
```

### 6. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è–º–∏ (–¥–ª—è –∞–¥–º–∏–Ω–æ–≤)

```typescript
// app/app/[org]/settings/invites/page.tsx
// –°—Ç—Ä–∞–Ω–∏—Ü–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è invite links
// - –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π
// - –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
// - –î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è/—É–¥–∞–ª–µ–Ω–∏–µ
```

## –ò—Ç–æ–≥–æ–≤—ã–π Flow

### –ù–æ–≤—ã–π —É—á–∞—Å—Ç–Ω–∏–∫ (–Ω–µ –≤ Telegram-–≥—Ä—É–ø–ø–∞—Ö):
```
1. –ê–¥–º–∏–Ω ‚Üí —Å–æ–∑–¥–∞—ë—Ç invite link ‚Üí /join/[org]/abc123
2. –£—á–∞—Å—Ç–Ω–∏–∫ ‚Üí –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –ø–æ —Å—Å—ã–ª–∫–µ
3. –£—á–∞—Å—Ç–Ω–∏–∫ ‚Üí "–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Telegram" ‚Üí 1 –∫–ª–∏–∫
4. –°–∏—Å—Ç–µ–º–∞ ‚Üí —Å–æ–∑–¥–∞—ë—Ç auth.users + participants
5. –£—á–∞—Å—Ç–Ω–∏–∫ ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ /app/[org]
```

### –£—á–∞—Å—Ç–Ω–∏–∫ –∏–∑ Telegram-–≥—Ä—É–ø–ø—ã (—É–∂–µ –≤ participants):
```
1. –£—á–∞—Å—Ç–Ω–∏–∫ ‚Üí –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ orbo.app
2. –£—á–∞—Å—Ç–Ω–∏–∫ ‚Üí "–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Telegram" ‚Üí 1 –∫–ª–∏–∫
3. –°–∏—Å—Ç–µ–º–∞ ‚Üí –Ω–∞—Ö–æ–¥–∏—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π participants –ø–æ tg_user_id
4. –°–∏—Å—Ç–µ–º–∞ ‚Üí —Å–æ–∑–¥–∞—ë—Ç auth.users + —Å–≤—è–∑—ã–≤–∞–µ—Ç
5. –£—á–∞—Å—Ç–Ω–∏–∫ ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∏–¥–∏—Ç —Å–≤–æ–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
```

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ –ø—É–±–ª–∏—á–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ:
```
1. –£—á–∞—Å—Ç–Ω–∏–∫ ‚Üí /p/[org]/events/[eventId]
2. –£—á–∞—Å—Ç–Ω–∏–∫ ‚Üí –º–æ–∂–µ—Ç –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –±–µ–∑ –≤—Ö–æ–¥–∞
3. –£—á–∞—Å—Ç–Ω–∏–∫ ‚Üí "–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è" ‚Üí Login —á–µ—Ä–µ–∑ Telegram
4. –°–∏—Å—Ç–µ–º–∞ ‚Üí —Å–æ–∑–¥–∞—ë—Ç participants —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º 'event_attendee'
5. –£—á–∞—Å—Ç–Ω–∏–∫ ‚Üí –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –Ω–∞ —Å–æ–±—ã—Ç–∏–µ
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–µ—à–µ–Ω–∏—è

‚úÖ **–ü—Ä–æ—Å—Ç–æ—Ç–∞**: 1 –∫–ª–∏–∫ –¥–ª—è –≤—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ Telegram  
‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º + –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ö–µ—à–∞  
‚úÖ **–ì–∏–±–∫–æ—Å—Ç—å**: –ø–æ–¥–¥–µ—Ä–∂–∫–∞ invite links —Å —Ä–∞–∑–Ω—ã–º–∏ —É—Ä–æ–≤–Ω—è–º–∏ –¥–æ—Å—Ç—É–ø–∞  
‚úÖ **–ê–≤—Ç–æ—Å–≤—è–∑–∫–∞**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Telegram-–≥—Ä—É–ø–ø –∏ –≤–µ–±-–≤—Ö–æ–¥–∞  
‚úÖ **–í—ã—Å–æ–∫–∞—è –∫–æ–Ω–≤–µ—Ä—Å–∏—è**: –º–∏–Ω–∏–º—É–º —Ç—Ä–µ–Ω–∏—è –¥–ª—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤  
‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ç–∏–ø—ã –¥–æ—Å—Ç—É–ø–∞

## –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞

–î–ª—è —Ä–∞–±–æ—Ç—ã Telegram Login Widget –Ω—É–∂–Ω–æ:
1. –ü–æ–ª—É—á–∏—Ç—å –∏–º—è –±–æ—Ç–∞: `@YourBotName`
2. –í–∫–ª—é—á–∏—Ç—å Domain –≤ BotFather: `/setdomain` ‚Üí `yourapp.com`
3. –î–æ–±–∞–≤–∏—Ç—å –≤ `.env`:
```env
NEXT_PUBLIC_TELEGRAM_BOT_USERNAME=YourBotName
TELEGRAM_BOT_TOKEN=your_bot_token
```

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. ‚úÖ –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è `organization_invites`
2. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `TelegramLogin` –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
3. ‚úÖ –°–æ–∑–¥–∞—Ç—å `/api/auth/telegram` endpoint
4. ‚úÖ –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É `/join/[org]/[token]`
5. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å `/login` —Å—Ç—Ä–∞–Ω–∏—Ü—É
6. ‚úÖ –°–æ–∑–¥–∞—Ç—å UI –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è–º–∏
7. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å –ø—É–±–ª–∏—á–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å–æ–±—ã—Ç–∏–π
8. ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

---

**–ì–æ—Ç–æ–≤–æ –∫ –æ–±—Å—É–∂–¥–µ–Ω–∏—é –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏!** üöÄ

