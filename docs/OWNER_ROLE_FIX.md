# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–ª–µ–π: –í–ª–∞–¥–µ–ª–µ—Ü vs –ê–¥–º–∏–Ω

## –ü—Ä–æ–±–ª–µ–º–∞
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–≤–∞–ª –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é (—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è –≤–ª–∞–¥–µ–ª—å—Ü–µ–º), –Ω–æ –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è Telegram –≥—Ä—É–ø–ø—ã –≤–∏–¥–µ–ª:
1. –°–µ–±—è –∫–∞–∫ –∞–¥–º–∏–Ω–∞ –≤–º–µ—Å—Ç–æ –≤–ª–∞–¥–µ–ª—å—Ü–∞
2. –°–µ–±—è –¥–≤–∞–∂–¥—ã –≤ –∫–æ–º–∞–Ω–¥–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ (–∫–∞–∫ –≤–ª–∞–¥–µ–ª—å—Ü–∞ –∏ –∫–∞–∫ –¥—É–±–ª—å-–∞–¥–º–∏–Ω–∞)
3. –î—Ä—É–≥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫–∞–∫ –≤–ª–∞–¥–µ–ª—å—Ü–∞, —Ö–æ—Ç—è –æ–Ω —Å–∞–º —Å–æ–∑–¥–∞–ª –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é

## –ü—Ä–∏—á–∏–Ω–∞
–§—É–Ω–∫—Ü–∏—è `sync_telegram_admins` **–ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–ª–∞** —Ä–æ–ª—å –≤–ª–∞–¥–µ–ª—å—Ü–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–æ–ª–∏ –≤ Telegram –≥—Ä—É–ø–ø–µ:
- –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±—ã–ª `creator` –≤ Telegram –≥—Ä—É–ø–ø–µ ‚Üí —Å—Ç–∞–≤–∏–ª–∞ `owner` —Å `role_source='telegram_admin'`
- –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±—ã–ª `administrator` (–Ω–µ creator) ‚Üí **–ü–û–ù–ò–ñ–ê–õ–ê** owner –¥–æ admin!

–õ–æ–≥–∏–∫–∞ –±—ã–ª–∞:
```sql
role = CASE 
  WHEN m.role = 'owner' THEN 'owner'  -- –í—Ä–æ–¥–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç
  WHEN v_admin_record.is_owner THEN 'owner'  -- ‚ùå –ü–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∏–∑ Telegram
  ELSE 'admin'  -- ‚ùå –ü–û–ù–ò–ñ–ê–ï–¢ owner –¥–æ admin!
END
```

## –†–µ—à–µ–Ω–∏–µ

### 1. –ú–∏–≥—Ä–∞—Ü–∏—è `56_fix_owner_role_preservation.sql`

**–ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ**:
- ‚úÖ **–ù–ï –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ–º** —Ä–æ–ª—å owner –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Ä–æ–ª—è–º–∏ –∏–∑ Telegram
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ–º `role_source` –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º
- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ–º `role='owner'` –µ—Å–ª–∏ `role_source != 'telegram_admin'`
- ‚úÖ –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤—ã—Ö memberships –≤—Å–µ–≥–¥–∞ —Å—Ç–∞–≤–∏–º `admin` (owner —Å–æ–∑–¥–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ org)
- ‚úÖ –î–æ–±–∞–≤–ª—è–µ–º `is_owner_in_groups` –≤ metadata –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è

**–ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞**:
```sql
role = CASE 
  -- ‚úÖ –ï—Å–ª–∏ owner –ù–ï –∏–∑ Telegram - –°–û–•–†–ê–ù–Ø–ï–ú!
  WHEN m.role = 'owner' AND (m.role_source IS NULL OR m.role_source != 'telegram_admin') THEN 'owner'
  -- –ò–Ω–∞—á–µ –≤—Å–µ–≥–¥–∞ admin
  ELSE 'admin'
END
```

### 2. –û–±–Ω–æ–≤–ª–µ–Ω UI `components/settings/organization-team.tsx`

**–ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ**:
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç "üëë –í–ª–∞–¥–µ–ª–µ—Ü –≤ –≥—Ä—É–ø–ø–∞—Ö" –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç —Ä–æ–ª–∏ –≤ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
- ‚úÖ –í–ª–∞–¥–µ–ª–µ—Ü –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∞–¥–º–∏–Ω–æ–º/creator –≤ Telegram –≥—Ä—É–ø–ø–∞—Ö
- ‚úÖ –ù–µ—Ç –¥—É–±–ª–µ–π - –æ–¥–∏–Ω —á–µ–ª–æ–≤–µ–∫ = –æ–¥–Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∞ –≤ –∫–æ–º–∞–Ω–¥–µ
- ‚úÖ –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ:
  - **–í–ª–∞–¥–µ–ª–µ—Ü –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏** (—Ä–æ–ª—å –≤ Orbo) ‚Üí üëë –í–ª–∞–¥–µ–ª–µ—Ü
  - **Creator –≤ Telegram** ‚Üí "–í–ª–∞–¥–µ–ª–µ—Ü –≤ –≥—Ä—É–ø–ø–∞—Ö" (–æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤–Ω–∏–∑—É –∫–∞—Ä—Ç–æ—á–∫–∏)

## –ß—Ç–æ —Ç–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è

### –î–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏:
```
üëë –í–ª–∞–¥–µ–ª–µ—Ü
Email: owner@example.com ‚úì –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω
@telegram_username ‚úì –í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω

[–ï—Å–ª–∏ –µ—Å—Ç—å Telegram –≥—Ä—É–ø–ø—ã]
üëë –¢–∞–∫–∂–µ –≤–ª–∞–¥–µ–ª–µ—Ü –≤ –≥—Ä—É–ø–ø–∞—Ö (2):
  [–ì—Ä—É–ø–ø–∞ 1] [–ì—Ä—É–ø–ø–∞ 2]
```

### –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:
```
–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä [–ò–∑ Telegram]
Email: admin@example.com ‚úì –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω
@telegram_username ‚úì –í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω

üëë –í–ª–∞–¥–µ–ª–µ—Ü –≤ –≥—Ä—É–ø–ø–∞—Ö (1):
  [–ì—Ä—É–ø–ø–∞ 3]
üí° –°–æ–∑–¥–∞—Ç–µ–ª—å (creator) —Ö–æ—Ç—è –±—ã –≤ –æ–¥–Ω–æ–π –∏–∑ –≥—Ä—É–ø–ø
```

## üìã –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

### 1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –≤ Supabase

–í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –≤ Supabase SQL Editor:
```sql
-- –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é
\i db/migrations/56_fix_owner_role_preservation.sql
```

–ò–ª–∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ SQL Editor.

### 2. –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ä–æ–ª–∏

**–ü—Ä–æ–±–ª–µ–º–∞**: –£ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –º–æ–≥–ª–∞ –±—ã—Ç—å –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω–∞ —Ä–æ–ª—å owner –Ω–∞ admin.

**–ü—Ä–æ–≤–µ—Ä–∫–∞**:
```sql
-- –ù–∞–π—Ç–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –±–µ–∑ –≤–ª–∞–¥–µ–ª—å—Ü–∞
SELECT o.id, o.name, COUNT(m.user_id) as admin_count
FROM organizations o
LEFT JOIN memberships m ON m.org_id = o.id AND m.role = 'owner'
WHERE m.user_id IS NULL
GROUP BY o.id, o.name;
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ** (–¥–ª—è –∫–∞–∂–¥–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –±–µ–∑ –≤–ª–∞–¥–µ–ª—å—Ü–∞):
```sql
-- –ù–∞–π—Ç–∏ –ø–µ—Ä–≤–æ–≥–æ —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –∞–¥–º–∏–Ω–∞ (—Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ —Å–æ–∑–¥–∞—Ç–µ–ª—å org)
SELECT m.*, u.email
FROM memberships m
JOIN auth.users u ON u.id = m.user_id
WHERE m.org_id = 'YOUR_ORG_ID'
ORDER BY m.created_at ASC
LIMIT 1;

-- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–æ–ª—å owner
UPDATE memberships
SET 
  role = 'owner',
  role_source = NULL  -- –£–±–∏—Ä–∞–µ–º telegram_admin
WHERE org_id = 'YOUR_ORG_ID'
  AND user_id = 'USER_ID_FROM_ABOVE';
```

### 3. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É

1. –ó–∞–π–¥–∏—Ç–µ –≤ –∫–∞–∂–¥—É—é –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –ö–æ–º–∞–Ω–¥–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏**
3. –ù–∞–∂–º–∏—Ç–µ **"–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å Telegram"**

–≠—Ç–æ –æ–±–Ω–æ–≤–∏—Ç metadata —Å `is_owner_in_groups` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:

1. ‚úÖ **–í–ª–∞–¥–µ–ª–µ—Ü –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏** –≤—Å–µ–≥–¥–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –≤–ª–∞–¥–µ–ª—å—Ü–µ–º (–¥–∞–∂–µ –µ—Å–ª–∏ –Ω–µ creator –≤ –≥—Ä—É–ø–ø–∞—Ö)
2. ‚úÖ **–ù–µ—Ç –¥—É–±–ª–µ–π** - –∫–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑
3. ‚úÖ **–ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ**:
   - –†–æ–ª—å –≤ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏: owner, admin, member
   - –†–æ–ª—å –≤ –≥—Ä—É–ø–ø–∞—Ö: creator (–≤–ª–∞–¥–µ–ª–µ—Ü), administrator
4. ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –†–æ–ª—å –≤ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ > –†–æ–ª—å –≤ Telegram –≥—Ä—É–ø–ø–∞—Ö

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –°–æ–∑–¥–∞–π—Ç–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é (–≤—ã —Å—Ç–∞–Ω–µ—Ç–µ –≤–ª–∞–¥–µ–ª—å—Ü–µ–º)
2. –î–æ–±–∞–≤—å—Ç–µ Telegram –≥—Ä—É–ø–ø—É, –≥–¥–µ –≤—ã –ù–ï creator
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
   - ‚úÖ –í —Å–ø–∏—Å–∫–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π –≤—ã –≤–∏–¥–∏—Ç–µ —Å–µ–±—è –∫–∞–∫ "–í–ª–∞–¥–µ–ª–µ—Ü"
   - ‚úÖ –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –≤—ã –≤ —Å–µ–∫—Ü–∏–∏ "–í–ª–∞–¥–µ–ª–µ—Ü", –∞ –Ω–µ "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã"
   - ‚úÖ –ù–µ—Ç –¥—É–±–ª–µ–π –≤–∞—à–µ–π –∫–∞—Ä—Ç–æ—á–∫–∏
4. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
   - ‚úÖ –ï—Å–ª–∏ –≤—ã creator —Ö–æ—Ç—å –≤ –æ–¥–Ω–æ–π –≥—Ä—É–ø–ø–µ ‚Üí –≤–∏–¥–∏—Ç–µ "–í–ª–∞–¥–µ–ª–µ—Ü –≤ –≥—Ä—É–ø–ø–∞—Ö"
   - ‚úÖ –†–æ–ª—å –≤–ª–∞–¥–µ–ª—å—Ü–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å

## –í–∞–∂–Ω–æ

**–î–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**: –ï—Å–ª–∏ –≤—ã –≤–∏–¥–µ–ª–∏ –ø—Ä–æ–±–ª–µ–º—É —Å —Ä–æ–ª—è–º–∏, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —à–∞–≥ 2 ("–ò—Å–ø—Ä–∞–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ä–æ–ª–∏") –≤—Ä—É—á–Ω—É—é –¥–ª—è –∫–∞–∂–¥–æ–π –ø–æ—Å—Ç—Ä–∞–¥–∞–≤—à–µ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏.

**–ù–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏**: –ü—Ä–æ–±–ª–µ–º–∞ –±–æ–ª—å—à–µ –Ω–µ –≤–æ–∑–Ω–∏–∫–Ω–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏! üéâ

