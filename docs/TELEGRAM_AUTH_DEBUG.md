# üêõ Telegram Auth - Debugging & Fix v2

**–î–∞—Ç–∞:** 29 –æ–∫—Ç—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è:** 2.0 (—É–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ + fallback)

---

## üîç –ü—Ä–æ–±–ª–µ–º–∞ –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –¥–µ–ø–ª–æ—è

### –°–∏–º–ø—Ç–æ–º—ã:
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –∫–æ–¥, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ –±–æ—Ç
- –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç –ø–æ —Å—Å—ã–ª–∫–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- –í–∏–¥–∏—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É "–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è..." –Ω–æ –∑–∞—Ç–µ–º –ø–æ–ø–∞–¥–∞–µ—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞ –ø–æ email
- –õ–æ–≥–∏: `Session found: false`

### –ê–Ω–∞–ª–∏–∑:
Client-side —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Å—Å–∏–∏ —á–µ—Ä–µ–∑ Supabase SDK –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–ª—É—á–∞—è—Ö:
- Telegram WebView –±–ª–æ–∫–∏—Ä—É–µ—Ç third-party cookies
- CDN –¥–ª—è Supabase JS –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
- JavaScript –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å –æ—à–∏–±–∫–∞–º–∏

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ v2

### 1. –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–æ–±–∞–≤–ª–µ–Ω **debug –±–ª–æ–∫** –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â–∏–π —ç—Ç–∞–ø: "–ó–∞–≥—Ä—É–∑–∫–∞...", "SDK –∑–∞–≥—Ä—É–∂–µ–Ω...", "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Å—Å–∏–∏..."
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏: "–û—à–∏–±–∫–∞: <message>"
- –ü–æ–º–æ–≥–∞–µ—Ç –ø–æ–Ω—è—Ç—å –≥–¥–µ –∏–º–µ–Ω–Ω–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–±–æ–π

```html
<div class="debug" id="debug"></div>

<script>
  const log = (msg) => {
    console.log('[Client Auth]', msg);
    document.getElementById('debug').textContent = msg;
  };
  
  log('–ó–∞–≥—Ä—É–∑–∫–∞...');
  // ... –¥–∞–ª–µ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞
</script>
```

### 2. Fallback –º–µ—Ç–æ–¥ (server-side cookies)

–°–æ–∑–¥–∞–Ω **–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π endpoint** `/auth/telegram-fallback`:
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç cookies **–Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ** (–∞ –Ω–µ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç Supabase cookies
- –†–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –µ—Å–ª–∏ JavaScript –æ—Ç–∫–ª—é—á–µ–Ω –∏–ª–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
- –ï—Å–ª–∏ client-side —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –∫–Ω–æ–ø–∫—É "–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥"
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ fallback

### 3. –î–≤–µ –∫–Ω–æ–ø–∫–∏ –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏

–ï—Å–ª–∏ client-side —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –¥–≤–µ –∫–Ω–æ–ø–∫–∏:

```
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë        –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏              ‚ïë
‚ïë                                        ‚ïë
‚ïë  [–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥]   ‚ïë
‚ïë                                        ‚ïë
‚ïë  [–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏]         ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
```

1. **"–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥"** ‚Üí `/auth/telegram-fallback`
   - Server-side —É—Å—Ç–∞–Ω–æ–≤–∫–∞ cookies
   - –ë–æ–ª–µ–µ –Ω–∞–¥—ë–∂–Ω—ã–π –º–µ—Ç–æ–¥

2. **"–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏"** ‚Üí –ø—É–±–ª–∏—á–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
   - –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—á–µ—Ç –ø—Ä–æ—Å—Ç–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç
   - –ë–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏/–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

---

## üìù –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### 1. `app/auth/telegram/route.ts`
**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å: "–ó–∞–≥—Ä—É–∑–∫–∞...", "SDK –∑–∞–≥—Ä—É–∂–µ–Ω...", "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Å—Å–∏–∏..."
- –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –∫–Ω–æ–ø–∫–∏ fallback/skip
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ —Å–µ—Å—Å–∏—è —Å–æ—Ö—Ä–∞–Ω–∏–ª–∞—Å—å –ø–æ—Å–ª–µ `setSession()`

### 2. `app/auth/telegram-fallback/route.ts` (–ù–û–í–´–ô)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:**
- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ cookies –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç Supabase cookies –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ:
  - `sb-{project}-auth-token` - –ø–æ–ª–Ω–∞—è —Å–µ—Å—Å–∏—è (base64 JSON)
  - `sb-{project}-auth-token.0` - access_token
  - `sb-{project}-auth-token.1` - refresh_token
- –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞–¥—ë–∂–Ω–æ –¥–∞–∂–µ –≤ —Å—Ç—Ä–æ–≥–∏—Ö WebView

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –®–∞–≥ 1: –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ (client-side)

1. –û—Ç–∫—Ä—ã—Ç—å —Å—Å—ã–ª–∫—É —Å–æ–±—ã—Ç–∏—è –≤ Telegram WebView
2. –ü–æ–ª—É—á–∏—Ç—å –∫–æ–¥, –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ –±–æ—Ç
3. –ü–µ—Ä–µ–π—Ç–∏ –ø–æ —Å—Å—ã–ª–∫–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
4. **–ù–∞–±–ª—é–¥–∞—Ç—å debug –±–ª–æ–∫:**
   - –ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è? "–ó–∞–≥—Ä—É–∑–∫–∞...", "SDK –∑–∞–≥—Ä—É–∂–µ–Ω...", "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Å—Å–∏–∏..."?
   - –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ - –∫–∞–∫–∞—è? "–û—à–∏–±–∫–∞: <message>"

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (—É—Å–ø–µ—Ö):**
```
–ó–∞–≥—Ä—É–∑–∫–∞...
SDK –∑–∞–≥—Ä—É–∂–µ–Ω, —Å–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞...
–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Å—Å–∏–∏...
–°–µ—Å—Å–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞!
–ü—Ä–æ–≤–µ—Ä–∫–∞ OK, —Ä–µ–¥–∏—Ä–µ–∫—Ç...
```
‚Üí –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–æ–±—ã—Ç–∏—è ‚úÖ

**–í–æ–∑–º–æ–∂–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–æ—à–∏–±–∫–∞):**
```
–ó–∞–≥—Ä—É–∑–∫–∞...
SDK –∑–∞–≥—Ä—É–∂–µ–Ω, —Å–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞...
–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Å—Å–∏–∏...
–û—à–∏–±–∫–∞: <message>
```
‚Üí –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –¥–≤–µ –∫–Ω–æ–ø–∫–∏ ‚ö†Ô∏è

### –®–∞–≥ 2: –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å fallback –º–µ—Ç–æ–¥ (–µ—Å–ª–∏ —à–∞–≥ 1 –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª)

1. –ù–∞–∂–∞—Ç—å **"–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥"**
2. –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ `/auth/telegram-fallback?code=...&redirect=...`
3. Cookies —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
4. –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–æ–±—ã—Ç–∏—è

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ú–æ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π —Ä–µ–¥–∏—Ä–µ–∫—Ç (–±–µ–∑ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã)
- –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–æ–±—ã—Ç–∏—è –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π ‚úÖ

### –®–∞–≥ 3: –°–æ–æ–±—â–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

**–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–æ–æ–±—â–∏—Ç–µ:**
1. –ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–ª–æ—Å—å –≤ debug –±–ª–æ–∫–µ? (—Å–¥–µ–ª–∞—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç)
2. –°—Ä–∞–±–æ—Ç–∞–ª –ª–∏ –æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ (client-side)?
3. –°—Ä–∞–±–æ—Ç–∞–ª –ª–∏ fallback –º–µ—Ç–æ–¥ (server-side)?
4. –ö–∞–∫–æ–π –±—Ä–∞—É–∑–µ—Ä/WebView? (Telegram iOS, Telegram Android, –æ–±—ã—á–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä)

---

## üîç –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞: "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ SDK"
**–ü—Ä–∏—á–∏–Ω–∞:** CDN –¥–ª—è Supabase JS –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω  
**–†–µ—à–µ–Ω–∏–µ:** Fallback –º–µ—Ç–æ–¥ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### –ü—Ä–æ–±–ª–µ–º–∞: "–°–µ—Å—Å–∏—è –Ω–µ —Å–æ—Ö—Ä–∞–Ω–∏–ª–∞—Å—å"
**–ü—Ä–∏—á–∏–Ω–∞:** Third-party cookies –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä–æ–º/WebView  
**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å fallback –º–µ—Ç–æ–¥ (server-side cookies)

### –ü—Ä–æ–±–ª–µ–º–∞: –û–±–µ –∫–Ω–æ–ø–∫–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç
**–ü—Ä–∏—á–∏–Ω–∞:** –ü—Ä–æ–±–ª–µ–º–∞ —Å –∫–æ–¥–æ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (—É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω, –∏—Å—Ç—ë–∫)  
**–†–µ—à–µ–Ω–∏–µ:** –ó–∞–ø—Ä–æ—Å–∏—Ç—å –Ω–æ–≤—ã–π –∫–æ–¥

### –ü—Ä–æ–±–ª–µ–º–∞: Cookies –Ω–µ —á–∏—Ç–∞—é—Ç—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–æ–≤ cookies –º–µ–∂–¥—É Supabase versions  
**–†–µ—à–µ–Ω–∏–µ:** Fallback —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç cookies –≤ 3 —Ñ–æ—Ä–º–∞—Ç–∞—Ö –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

---

## üí° –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### Client-side setup (–æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥):
```javascript
// 1. –ó–∞–≥—Ä—É–∑–∫–∞ SDK —Å CDN
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

// 2. –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
const supabase = window.supabase.createClient(url, key);

// 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Å—Å–∏–∏
await supabase.auth.setSession({
  access_token: '...',
  refresh_token: '...'
});

// 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ —Å–µ—Å—Å–∏—è —Å–æ—Ö—Ä–∞–Ω–∏–ª–∞—Å—å
const { data: { session } } = await supabase.auth.getSession();

// 5. –†–µ–¥–∏—Ä–µ–∫—Ç
if (session) window.location.href = redirectUrl;
```

### Server-side setup (fallback –º–µ—Ç–æ–¥):
```typescript
// 1. –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏ —á–µ—Ä–µ–∑ admin
const { data: sessionData } = await supabaseAdmin.auth.signInWithPassword({
  email, password
});

// 2. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ cookies –≤—Ä—É—á–Ω—É—é
response.cookies.set('sb-{project}-auth-token', base64JSON, {
  httpOnly: false,
  secure: true,
  sameSite: 'lax'
});

// 3. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –¥—Ä—É–≥–∏—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö
response.cookies.set('sb-{project}-auth-token.0', access_token, ...);
response.cookies.set('sb-{project}-auth-token.1', refresh_token, ...);

// 4. –†–µ–¥–∏—Ä–µ–∫—Ç
return response;
```

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | Client-side | Server-side (Fallback) |
|----------------|-------------|------------------------|
| **–°–∫–æ—Ä–æ—Å—Ç—å** | –°—Ä–µ–¥–Ω—è—è (CDN) | –ë—ã—Å—Ç—Ä–æ |
| **–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å** | –ó–∞–≤–∏—Å–∏—Ç –æ—Ç WebView | –í—ã—Å–æ–∫–∞—è |
| **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** | –ü—Ä–æ–±–ª–µ–º—ã —Å cookies | –†–∞–±–æ—Ç–∞–µ—Ç –≤–µ–∑–¥–µ |
| **–í–∏–¥–∏–º–æ—Å—Ç—å** | Debug –±–ª–æ–∫ | –ë–µ–∑ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã |
| **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å** | –û—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ | –ü—Ä–∏ –æ—à–∏–±–∫–µ client-side |

---

## üöÄ –î–µ–ø–ª–æ–π

```bash
git add app/auth/telegram/route.ts app/auth/telegram-fallback/route.ts docs/TELEGRAM_AUTH_DEBUG.md
git commit -m "debug: improve telegram auth with logging and fallback method"
git push
```

---

## üìã Checklist –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:
- [ ] –û—Ç–∫—Ä—ã—Ç—å —Å—Å—ã–ª–∫—É —Å–æ–±—ã—Ç–∏—è –≤ Telegram WebView
- [ ] –ü–æ–ª—É—á–∏—Ç—å –∫–æ–¥, –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ –±–æ—Ç
- [ ] –ü–µ—Ä–µ–π—Ç–∏ –ø–æ —Å—Å—ã–ª–∫–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- [ ] –ó–∞–ø–∏—Å–∞—Ç—å —á—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ debug –±–ª–æ–∫–µ
- [ ] –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ - –Ω–∞–∂–∞—Ç—å "–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥"
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Å–æ–±—ã—Ç–∏–µ —Å –¥–æ—Å—Ç—É–ø–æ–º
- [ ] –°–æ–æ–±—â–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ —á–∞—Ç

---

**–í–µ—Ä—Å–∏—è:** 2.0  
**–ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é:** ‚úÖ  
**–°—Ç–∞—Ç—É—Å:** –ñ–¥—ë–º feedback –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

